[{"categories":["Java"],"contents":"ä¸€ã€æ¦‚è¿° å‡è®¾ä½ å¯¹ArrayDequeçš„æºç ä¸€æ— æ‰€çŸ¥ï¼Œé‚£ä¹ˆä»…å‡­ArrayDequeåå­—æ¥çœ‹çš„è¯ï¼Œå¤§æ¦‚å¯ä»¥çŒœåˆ°å®ƒçš„å®ç°å’ŒArrayæ•°ç»„æœ‰å…³ã€‚\nArrayDequeæ˜¯Java Collections Frameworkçš„ä¸€ä¸ªæˆå‘˜ï¼Œå®ƒçš„åº•å±‚æ˜¯åŸºäºå®šé•¿æ•°ç»„å®ç°çš„ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå¦‚æœæ•°ç»„å­˜æ”¾æ»¡äº†ï¼Œå°±ä¼šé€šè¿‡æ‰©å®¹æœºåˆ¶é‡æ–°ç”Ÿæˆä¸€ä¸ªæ›´å¤§çš„æ•°ç»„æ¥å­˜æ”¾æ•°æ®ï¼Œå¹¶ä¸”ç»´æŠ¤äº†åŒç«¯é˜Ÿåˆ—å¤´éƒ¨å…ƒç´ çš„ç´¢å¼•headå’Œå°¾éƒ¨å…ƒç´ çš„ç´¢å¼•tailï¼Œä½¿å¾—å®ƒæˆä¸ºäº†ä¸€ä¸ªé€»è¾‘ä¸Šçš„å¾ªç¯æ•°ç»„ï¼Œæ‰€è°“å¾ªç¯æ˜¯æŒ‡å…ƒç´ åˆ°æ•°ç»„å°¾ä¹‹åå¯ä»¥æ¥ç€ä»æ•°ç»„å¤´å¼€å§‹ã€‚\næˆ‘ä»¬çŸ¥é“ï¼Œæ•°ç»„éå°¾éƒ¨çš„æ’å…¥å’Œåˆ é™¤æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼Œç„¶è€Œï¼Œè¿™åœ¨ArrayDequeä¸Šçš„è¡¨ç°å´æ˜¯æ•ˆç‡é«˜ï¼Œè¿™æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ\næ¥ä¸‹æ¥ï¼Œæœ¬æ–‡ä¼šå™è¿°ArrayDequeæ˜¯å¦‚ä½•ç»´æŠ¤è¿™æ ·ä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼Œå®ƒçš„æ‰©å®¹æœºåˆ¶æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œè¿™äº›éƒ½æ˜¯ArrayDequeçš„æ ¸å¿ƒæ‰€åœ¨ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œæœ¬æ–‡è¿˜ä¼šå™è¿°ArrayDequeçš„åŸºæœ¬æ“ä½œæ˜¯æ€æ ·å®ç°çš„ï¼Œä»¥åŠå…¶å®ƒçš„ç»†èŠ‚ã€‚\nå¥½äº†ï¼Œè®©æˆ‘ä»¬ä¸€èµ·é€æ­¥æ­å¼€å®ƒçš„ç¥ç§˜é¢çº±ã€‚\näºŒã€ArrayDequeæºç è§£è¯» 2.1ã€ç»§æ‰¿å…³ç³» ä»UMLç±»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒArrayDequeç›´æ¥æˆ–é—´æ¥å®ç°äº†Iterableã€Collectionã€Dequeã€Queueã€Cloneableã€Serializableè¿™6ä¸ªæ¥å£ï¼›ArrayDequeç»§æ‰¿äº†AbstractCollectionè¿™ä¸ªæŠ½è±¡ç±»ã€‚\nArrayDequeå’ŒLinkedListåœ¨ç»§æ‰¿å…³ç³»ä¸Šæ˜¯æ¯”è¾ƒç›¸ä¼¼çš„ï¼Œæ‰€ä»¥é’ˆå¯¹ç›¸åŒç»§æ‰¿å…³ç³»å†…å®¹çš„å™è¿°ï¼Œæ¯”å¦‚è¯´Dequeæ¥å£ã€Queueæ¥å£çš„è§£è¯»ï¼Œæœ¬æ–‡ä¸å†æ¬¡å™è¿°ï¼Œæƒ³å»äº†è§£çš„è¯ï¼Œå¯å‚è€ƒä¹‹å‰çš„Javaé›†åˆç³»åˆ—ï¼šä¸€æ–‡è§£è¯»LinkedListæºç ã€ŒJDK11ã€ä¸€æ–‡ã€‚\n2.2ã€æˆå‘˜å˜é‡ 1 2 3 4 5 6 7 8 9 10 11 // å­˜å‚¨åŒç«¯é˜Ÿåˆ—å…ƒç´ çš„æ•°ç»„ã€‚æ‰€æœ‰ä¸åŒ…å«åŒç«¯é˜Ÿåˆ—å…ƒç´ çš„æ•°ç»„å•å…ƒæ ¼å§‹ç»ˆä¸ºç©ºã€‚è¯¥æ•°ç»„å§‹ç»ˆè‡³å°‘æœ‰ä¸€ä¸ªç©ºæ§½ï¼ˆåœ¨å°¾éƒ¨ï¼‰ã€‚ transient Object[] elements; // åŒç«¯é˜Ÿåˆ—å¤´éƒ¨å…ƒç´ çš„ç´¢å¼•ï¼ˆè¿™æ˜¯å°†è¢« remove() æˆ– pop() åˆ é™¤çš„å…ƒç´ ï¼‰ï¼›æˆ–è€…ä»»æ„æ•°å­— 0 \u0026lt;= head \u0026lt; elements.length ç­‰äº tail å¦‚æœåŒç«¯é˜Ÿåˆ—ä¸ºç©ºã€‚ transient int head; // å°†ä¸‹ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°åŒç«¯é˜Ÿåˆ—å°¾éƒ¨çš„ç´¢å¼•ï¼ˆé€šè¿‡ addLast(E)ã€add(E) æˆ– push(E)ï¼‰ï¼› elements[tail] å§‹ç»ˆä¸ºç©ºã€‚ transient int tail; // è¦åˆ†é…çš„æ•°ç»„çš„æœ€å¤§å¤§å°ã€‚ä¸€äº› VM åœ¨æ•°ç»„ä¸­ä¿ç•™ä¸€äº›æ ‡é¢˜å­—ã€‚å°è¯•åˆ†é…æ›´å¤§çš„æ•°ç»„å¯èƒ½ä¼šå¯¼è‡´ OutOfMemoryError: Requested array size exceeds VM limit private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; ä»æˆå‘˜å˜é‡headã€tailçš„æ³¨é‡Šå¯ä»¥çŸ¥é“ï¼Œæ•°ç»„çš„é•¿åº¦ã€å¤´éƒ¨å…ƒç´ ã€å°¾éƒ¨å…ƒç´ éƒ½å’Œè¿™ä¸¤ä¸ªå˜é‡æœ‰å…³ï¼Œé‚£ä¹ˆå½“æ•°ç»„åˆå§‹åŒ–åï¼Œè¿™æ ·çš„æ•°ç»„è¡¨ç°å½¢å¼æœ‰4ç§æƒ…å†µï¼š\nå¤´éƒ¨å…ƒç´ çš„ç´¢å¼•head == å°¾éƒ¨å…ƒç´ çš„ç´¢å¼•tailï¼Œé‚£ä¹ˆæ•°ç»„ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯æ•°ç»„å†…éƒ¨æ²¡æœ‰å…ƒç´ ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¤´éƒ¨å…ƒç´ çš„ç´¢å¼•head \u0026lt; å°¾éƒ¨å…ƒç´ çš„ç´¢å¼•tailï¼Œé‚£ä¹ˆå¤´éƒ¨å…ƒç´ ä¸ºelements[head]ï¼Œå°¾éƒ¨å…ƒç´ ä¸ºelements[tail-1]ï¼Œå…ƒç´ ç´¢å¼•ä»headåˆ°tail-1ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¤´éƒ¨å…ƒç´ çš„ç´¢å¼•head \u0026gt; å°¾éƒ¨å…ƒç´ çš„ç´¢å¼•tail \u0026amp;\u0026amp; å°¾éƒ¨å…ƒç´ çš„ç´¢å¼•tail == 0ï¼Œé‚£ä¹ˆå¤´éƒ¨å…ƒç´ ä¸ºelements[head]ï¼Œå°¾éƒ¨å…ƒç´ ä¸ºelements[elements.length-1]ï¼Œå…ƒç´ ç´¢å¼•ä»headåˆ°elements.length-1ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¤´éƒ¨å…ƒç´ çš„ç´¢å¼•head \u0026gt; å°¾éƒ¨å…ƒç´ çš„ç´¢å¼•tail \u0026amp;\u0026amp; å°¾éƒ¨å…ƒç´ çš„ç´¢å¼•tail != 0ï¼Œé‚£ä¹ˆå¤´éƒ¨å…ƒç´ ä¸ºelements[head]ï¼Œå°¾éƒ¨å…ƒç´ ä¸ºelements[tail-1]ï¼Œå…ƒç´ ç´¢å¼•ä»headåˆ°elements.length-1ï¼Œç„¶åå†ä»0åˆ°tail-1ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2.3ã€æ„é€ æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // æ„é€ ä¸€ä¸ªç©ºæ•°ç»„åŒç«¯é˜Ÿåˆ—ï¼Œå…¶åˆå§‹å®¹é‡è¶³ä»¥å®¹çº³16ä¸ªå…ƒç´  public ArrayDeque() { elements = new Object[16]; } // æ„é€ ä¸€ä¸ªç©ºæ•°ç»„åŒç«¯é˜Ÿåˆ—ï¼Œå…¶åˆå§‹å®¹é‡è¶³ä»¥å®¹çº³æŒ‡å®šæ•°é‡çš„å…ƒç´  public ArrayDeque(int numElements) { elements = new Object[(numElements \u0026lt; 1) ? 1 : (numElements == Integer.MAX_VALUE) ? Integer.MAX_VALUE : numElements + 1]; } // æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆå…ƒç´ çš„åŒç«¯é˜Ÿåˆ—ï¼ŒæŒ‰ç…§é›†åˆè¿­ä»£å™¨è¿”å›å…ƒç´ çš„é¡ºåºã€‚ï¼ˆé›†åˆçš„è¿­ä»£å™¨è¿”å›çš„ç¬¬ä¸€ä¸ªå…ƒç´ æˆä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæˆ–åŒç«¯é˜Ÿåˆ—çš„å‰é¢ã€‚ï¼‰ public ArrayDeque(Collection\u0026lt;? extends E\u0026gt; c) { this(c.size()); copyElements(c); } // å°†é›†åˆcçš„å…ƒç´ å¾ªç¯æ·»åŠ åˆ°é˜Ÿå°¾ private void copyElements(Collection\u0026lt;? extends E\u0026gt; c) { c.forEach(this::addLast); } æˆ‘ä»¬çœ‹ä¸‹ç¬¬äºŒä¸ªæ„é€ æ–¹æ³•ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªnumElementsï¼Œè¿™é‡Œæœ‰3ç§æƒ…å†µç¡®å®šæ•°ç»„å¤§å°ï¼š\nå¦‚æœnumElements \u0026lt; 1ï¼Œé‚£ä¹ˆæ•°ç»„å¤§å°ä¸º1ï¼›\nå¦‚æœnumElements == Integer.MAX_VALUEï¼Œé‚£ä¹ˆæ•°ç»„å¤§å°ä¸ºInteger.MAX_VALUEï¼›\nå¦‚æœnumElements \u0026gt;= 1 \u0026amp;\u0026amp; numElements \u0026lt; Integer.MAX_VALUEï¼Œé‚£ä¹ˆæ•°ç»„å¤§å°ä¸ºnumElements + 1;\nç¬¬ä¸‰ç§æƒ…å†µï¼šä¸ºä»€ä¹ˆè¦numElements + 1å‘¢ï¼Ÿ\nå› ä¸ºå¾ªç¯æ•°ç»„å¿…é¡»æ—¶åˆ»è‡³å°‘ç•™ä¸€ä¸ªç©ºä½ï¼Œtailå˜é‡æŒ‡å‘ä¸‹ä¸€ä¸ªç©ºä½ï¼Œä¸ºäº†å®¹çº³numElementsä¸ªå…ƒç´ ï¼Œè‡³å°‘éœ€è¦numElements+1ä¸ªä½ç½®ã€‚\n2.4ã€æ ¸å¿ƒæ–¹æ³• 2.4.1ã€æ’å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 // ***********å°¾éƒ¨æ’å…¥*********** // åœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾æ’å…¥æŒ‡å®šçš„å…ƒç´  public boolean add(E e) { addLast(e); return true; } // åœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾æ’å…¥æŒ‡å®šçš„å…ƒç´  public void addLast(E e) { if (e == null) throw new NullPointerException(); final Object[] es = elements; // ä¸Šé¢è¯´äº†ï¼Œtailç´¢å¼•å¯¹åº”çš„ä½ç½®æ˜¯ä¸€ä¸ªç©ºä½ï¼Œæ‰€ä»¥è¿™é‡Œç”¨æ¥å­˜æ”¾å…ƒç´ e es[tail] = e; // è®¡ç®—tailçš„æ–°ç´¢å¼•ä½ç½®ï¼Œèµ‹å€¼ç»™tailå˜é‡ï¼›å¦‚æœ(tail+1) \u0026gt;= es.lengthï¼Œé‚£ä¹ˆtail = 0ï¼Œå¦åˆ™å°±æ˜¯tail+1 // åˆ¤æ–­æ˜¯å¦head == tailï¼Œå¦‚æœæ˜¯åˆ™è¡¨ç¤ºæ•°ç»„å­˜æ»¡äº†ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹ if (head == (tail = inc(tail, es.length))) // æ‰§è¡Œæ‰©å®¹ grow(1); } static final int inc(int i, int modulus) { if (++i \u0026gt;= modulus) i = 0; return i; } // åœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾æ’å…¥æŒ‡å®šçš„å…ƒç´  public boolean offer(E e) { return offerLast(e); } // åœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾æ’å…¥æŒ‡å®šçš„å…ƒç´  public boolean offerLast(E e) { addLast(e); return true; } // å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾ï¼Œå°±åƒå¯¹æ¯ä¸ªå…ƒç´ è°ƒç”¨addLastä¸€æ ·ï¼ŒæŒ‰ç…§é›†åˆçš„è¿­ä»£å™¨è¿”å›å®ƒä»¬çš„é¡ºåºã€‚ public boolean addAll(Collection\u0026lt;? extends E\u0026gt; c) { // sï¼šåŸæ•°ç»„çš„å…ƒç´ ä¸ªæ•° // neededï¼šæ‰€éœ€çš„æœ€ä½é¢å¤–å®¹é‡ final int s, needed; // needed = åŸæ•°ç»„çš„å…ƒç´ ä¸ªæ•° + é›†åˆcçš„é•¿åº¦ + 1ï¼ˆtailç´¢å¼•å ä½ï¼‰- åŸæ•°ç»„é•¿åº¦ // å¦‚æœneeded\u0026gt;0ï¼Œè¯´æ˜æ•°ç»„å…ƒç´ ä¸ªæ•° + é›†åˆcçš„é•¿åº¦ + 1ï¼ˆtailç´¢å¼•å ä½) \u0026gt; åŸæ•°ç»„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯åŸæ•°ç»„å®¹é‡ä¸å¤Ÿè£…é›†åˆcäº†ï¼Œéœ€è¦æ‰©å®¹ if ((needed = (s = size()) + c.size() + 1 - elements.length) \u0026gt; 0) // æ‰§è¡Œæ‰©å®¹ grow(needed); // æ‰©å®¹å®Œæˆåï¼Œå°†é›†åˆcçš„å…ƒç´ å¾ªç¯æ·»åŠ åˆ°é˜Ÿå°¾ copyElements(c); // å¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—å‘ç”Ÿäº†æ›´æ”¹ï¼Œé‚£ä¹ˆè¿”å›true return size() \u0026gt; s; } // ***********å¤´éƒ¨æ’å…¥*********** // åœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„å‰é¢æ’å…¥æŒ‡å®šçš„å…ƒç´  public void addFirst(E e) { if (e == null) throw new NullPointerException(); final Object[] es = elements; // è®¡ç®—headçš„æ–°ç´¢å¼•ä½ç½®ï¼Œèµ‹å€¼ç»™headå˜é‡ï¼›å¦‚æœ(head-1) \u0026lt; 0ï¼Œé‚£ä¹ˆhead = es.length-1ï¼Œå¦åˆ™å°±æ˜¯head-1 es[head = dec(head, es.length)] = e; // åˆ¤æ–­æ˜¯å¦head==tailï¼Œå¦‚æœæ˜¯åˆ™è¡¨ç¤ºæ•°ç»„å­˜æ»¡äº†ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹ if (head == tail) // æ‰§è¡Œæ‰©å®¹ grow(1); } static final int dec(int i, int modulus) { if (--i \u0026lt; 0) i = modulus - 1; return i; } // åœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„å‰é¢æ’å…¥æŒ‡å®šçš„å…ƒç´  public boolean offerFirst(E e) { addFirst(e); return true; } // å°†ä¸€ä¸ªå…ƒç´ å‹å…¥æ­¤åŒç«¯é˜Ÿåˆ—æ‰€ä»£è¡¨çš„å †æ ˆã€‚æ¢å¥è¯è¯´ï¼Œå°†å…ƒç´ æ’å…¥åˆ°è¿™ä¸ªåŒç«¯é˜Ÿåˆ—çš„å‰é¢ public void push(E e) { addFirst(e); } 2.4.2ã€åˆ é™¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // ***********å°¾éƒ¨åˆ é™¤*********** public E removeLast() { E e = pollLast(); if (e == null) throw new NoSuchElementException(); return e; } public E pollLast() { final Object[] es; // è®°å½•tailçš„æ–°ç´¢å¼•ä½ç½® final int t; // è®¡ç®—tailçš„æ–°ç´¢å¼•ä½ç½®ï¼Œèµ‹å€¼ç»™ä¸´æ—¶å˜é‡tï¼›å¦‚æœ(tail-1) \u0026lt; 0ï¼Œé‚£ä¹ˆtail = es.length-1ï¼Œå¦åˆ™å°±æ˜¯tail-1 // åœ¨æ•°ç»„ä¸­å–å‡ºtç´¢å¼•å¯¹åº”çš„å…ƒç´  E e = elementAt(es = elements, t = dec(tail, es.length)); if (e != null) // å°†tèµ‹å€¼ç»™tailï¼Œç„¶åå°†tailç´¢å¼•ä½ç½®çš„å…ƒç´ ç½®ä¸ºnull es[tail = t] = null; return e; } // ***********å¤´éƒ¨åˆ é™¤*********** // æ£€ç´¢å¹¶åˆ é™¤ç”±æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚æ­¤æ–¹æ³•ä¸poll()çš„ä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ public E remove() { return removeFirst(); } // æ£€ç´¢å¹¶ç§»é™¤æ­¤åŒç«¯é˜Ÿåˆ—æ‰€è¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´éƒ¨ï¼ˆæ¢å¥è¯è¯´ï¼Œæ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œæˆ–è€…å¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null ã€‚ public E poll() { return pollFirst(); } public E removeFirst() { E e = pollFirst(); if (e == null) throw new NoSuchElementException(); return e; } public E pollFirst() { final Object[] es; // è®°å½•headç´¢å¼•ä½ç½® final int h; // åœ¨æ•°ç»„ä¸­å–å‡ºheadç´¢å¼•å¯¹åº”çš„å…ƒç´  E e = elementAt(es = elements, h = head); if (e != null) { // å°†headç´¢å¼•ä½ç½®çš„å…ƒç´ ç½®ä¸ºnull es[h] = null; // è®¡ç®—headçš„æ–°ç´¢å¼•ä½ç½®ï¼Œèµ‹å€¼ç»™headï¼›å¦‚æœ(head+1) \u0026gt;= es.lengthï¼Œé‚£ä¹ˆhead = 0ï¼Œå¦åˆ™å°±æ˜¯head+1 head = inc(h, es.length); } // è¿”å›headç´¢å¼•å¯¹åº”çš„å…ƒç´  return e; } // ä»æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„å †æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´ ã€‚æ¢å¥è¯è¯´ï¼Œåˆ é™¤å¹¶è¿”å›æ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ public E pop() { return removeFirst(); } 2.4.3ã€æ£€ç´¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 // ***********å¤´éƒ¨æ£€ç´¢*********** // æ£€ç´¢ä½†ä¸åˆ é™¤ç”±æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚æ­¤æ–¹æ³•ä¸peekä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ public E element() { return getFirst(); } // æ£€ç´¢ä½†ä¸åˆ é™¤ç”±æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œæˆ–è€…å¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºåˆ™è¿”å›null ã€‚ public E peek() { return peekFirst(); } public E getFirst() { // åœ¨æ•°ç»„ä¸­å–å‡ºheadç´¢å¼•å¯¹åº”çš„å…ƒç´  E e = elementAt(elements, head); if (e == null) throw new NoSuchElementException(); // è¿”å›headç´¢å¼•å¯¹åº”çš„å…ƒç´  return e; } // è¿”å›æ•°ç»„ç´¢å¼• i å¤„çš„å…ƒç´ ã€‚è¿™æ˜¯å¯¹æ³›å‹çš„è½»å¾®æ»¥ç”¨ï¼Œè¢« javac æ‰€æ¥å— static final \u0026lt;E\u0026gt; E elementAt(Object[] es, int i) { return (E) es[i]; } public E peekFirst() { // åœ¨æ•°ç»„ä¸­å–å‡ºheadç´¢å¼•å¯¹åº”çš„å…ƒç´  return elementAt(elements, head); } // ***********å°¾éƒ¨æ£€ç´¢*********** public E getLast() { final Object[] es = elements; // è®¡ç®—tailçš„æ–°ç´¢å¼•ä½ç½®ï¼Œå¦‚æœ(tail-1) \u0026lt; 0ï¼Œé‚£ä¹ˆtail = es.length-1ï¼Œå¦åˆ™å°±æ˜¯tail-1 // åœ¨æ•°ç»„ä¸­å–å‡ºtailæ–°ç´¢å¼•å¯¹åº”çš„å…ƒç´  E e = elementAt(es, dec(tail, es.length)); if (e == null) throw new NoSuchElementException(); return e; } public E peekLast() { final Object[] es; // è®¡ç®—tailçš„æ–°ç´¢å¼•ä½ç½®ï¼Œå¦‚æœ(tail-1) \u0026lt; 0ï¼Œé‚£ä¹ˆtail = es.length-1ï¼Œå¦åˆ™å°±æ˜¯tail-1 // åœ¨æ•°ç»„ä¸­å–å‡ºtailæ–°ç´¢å¼•å¯¹åº”çš„å…ƒç´  return elementAt(es = elements, dec(tail, es.length)); } 2.4.4ã€æ‰©å®¹æœºåˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 // å°†æ­¤åŒç«¯é˜Ÿåˆ—çš„å®¹é‡è‡³å°‘å¢åŠ ç»™å®šçš„æ•°é‡ // needï¼šæ‰€éœ€çš„æœ€ä½é¢å¤–å®¹é‡ private void grow(int needed) { // overflow-conscious code // è·å–æ—§å®¹é‡å¤§å° final int oldCapacity = elements.length; // è®°å½•æ–°å®¹é‡å¤§å° int newCapacity; // Double capacity if small; else grow by 50% // jumpï¼šå¯è¯‘ä¸ºè·³è·ƒï¼Œæ˜¯åŸºäºæ—§å®¹é‡è®¡ç®—çš„ä¸€ä¸ªå€¼ï¼Œå§‘ä¸”å«è·³è·ƒå®¹é‡ // å¦‚æœoldCapacity \u0026lt; 64ï¼Œé‚£ä¹ˆjump = oldCapacity + 2ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯+2ï¼Ÿ+1ä¸è¡Œå—ï¼Ÿå› ä¸º+2æœ‰ä¸¤ä¸ªå«ä¹‰ï¼Œä¸€ä¸ªæ˜¯ç»™tailå ä½ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ç»™æ–°å…ƒç´ æ’å…¥ä½¿ç”¨ // å¦‚æœoldCapacity \u0026gt;= 64ï¼Œé‚£ä¹ˆjump = oldCapacity \u0026gt;\u0026gt; 1ï¼Œå³ç§»ä¸€ä½è¡¨ç¤ºé™¤2ï¼Œç›¸å½“äºoldCapacity/2 int jump = (oldCapacity \u0026lt; 64) ? (oldCapacity + 2) : (oldCapacity \u0026gt;\u0026gt; 1); // å¦‚æœè·³è·ƒå®¹é‡ \u0026lt; æ‰€éœ€çš„æœ€ä½é¢å¤–å®¹é‡ï¼Œè¯´æ˜æ˜¯è®¡åˆ’èµ¶ä¸ä¸Šå˜æ¢ï¼Œæ¯”å¦‚è¯´è°ƒç”¨æ„é€ æ–¹æ³•æ—¶ä¼ å…¥numElementsä¸º1ï¼Œç„¶åè°ƒç”¨addAllæ–¹æ³•ï¼Œä¸€æ¬¡æ€§æ·»åŠ ä¸€ä¸ªå¾ˆå¤§çš„é›†åˆè¿›æ¥ï¼Œå°±æœ‰å¯èƒ½å‡ºç°è¿™ç§æƒ…å†µ // å¦‚æœï¼ˆè·³è·ƒå®¹é‡ + æ—§å®¹é‡ï¼‰\u0026gt; MAX_ARRAY_SIZEï¼Œè¯´æ˜è¶…è¿‡æ•°ç»„é•¿åº¦å…è®¸æœ€å¤§å€¼äº† // // newCapacityçš„å€¼æœ‰ä¸¤ä¸ªæƒ…å†µï¼š // å¦‚æœoldCapacity \u0026lt; 64ï¼Œé‚£newCapacityä¸ºoldCapacity * 2 + 2 // å¦‚æœoldCapacity \u0026gt;= 64ï¼Œé‚£newCapacityä¸ºoldCapacity * 1.5 if (jump \u0026lt; needed || (newCapacity = (oldCapacity + jump)) - MAX_ARRAY_SIZE \u0026gt; 0) // å‡ºç°ä¸Šé¢è¯´çš„ä¸¤ç§æƒ…å†µæ—¶ï¼Œéœ€è¦é‡æ–°è°ƒæ•´æ–°å®¹é‡å¤§å° newCapacity = newCapacity(needed, jump); // å°†åŸæ•°ç»„çš„å…ƒç´ å…¨éƒ¨æ‹·è´åˆ°æ–°æ•°ç»„ä¸­å» final Object[] es = elements = Arrays.copyOf(elements, newCapacity); // Exceptionally, here tail == head needs to be disambiguated // æ­¤æ—¶æ•°ç»„åªæ˜¯æ‰©å¤§äº†ï¼Œä½†æ˜¯tail==headï¼Œå³ä¾ç„¶æŒ‡å‘åŒä¸€ä½ç½®ï¼Œä¸ºé¿å…æ­§ä¹‰ï¼Œéœ€è¦è°ƒæ•´headå’Œtailçš„ä½ç½® if (tail \u0026lt; head || (tail == head \u0026amp;\u0026amp; es[head] != null)) { // wrap around; slide first leg forward to end of array // è®¡ç®—æ‰©å®¹åæ•°ç»„çš„å‰©ä½™ç©ºé—´ int newSpace = newCapacity - oldCapacity; // å°†æ—§æ•°æ®å¤åˆ¶åˆ°æ–°ä½ç½® System.arraycopy(es, head, es, head + newSpace, oldCapacity - head); // å°†æ—§ä½ç½®çš„æ—§æ•°æ®å…¨éƒ¨æ¸…ç©ºï¼Œheadæˆä¸ºæ–°ä½ç½®â¾¸å…ƒç´ çš„ä½ç½® for (int i = head, to = (head += newSpace); i \u0026lt; to; i++) es[i] = null; } } // è¾¹ç¼˜æ¡ä»¶çš„å®¹é‡è®¡ç®—ï¼Œå°¤å…¶æ˜¯æº¢å‡º private int newCapacity(int needed, int jump) { final int oldCapacity = elements.length, minCapacity; // è¾¹ç•Œå¤„ç†ï¼šåˆ¤æ–­æ—§å®¹é‡ + æ‰€éœ€çš„æœ€ä½é¢å¤–å®¹é‡æ˜¯å¦è¶…è¿‡æ•°ç»„é•¿åº¦å…è®¸æœ€å¤§å€¼ if ((minCapacity = oldCapacity + needed) - MAX_ARRAY_SIZE \u0026gt; 0) { if (minCapacity \u0026lt; 0) throw new IllegalStateException(\u0026#34;Sorry, deque too big\u0026#34;); return Integer.MAX_VALUE; } // å¦‚æœè·³è·ƒå®¹é‡ \u0026lt; æ‰€éœ€çš„æœ€ä½é¢å¤–å®¹é‡ï¼Œè¯´æ˜æ˜¯è®¡åˆ’èµ¶ä¸ä¸Šå˜æ¢ï¼Œæ¯”å¦‚è¯´è°ƒç”¨æ„é€ æ–¹æ³•æ—¶ä¼ å…¥numElementsä¸º1ï¼Œç„¶åè°ƒç”¨addAllæ–¹æ³•ï¼Œä¸€æ¬¡æ€§æ·»åŠ ä¸€ä¸ªå¾ˆå¤§çš„é›†åˆè¿›æ¥ï¼Œå°±æœ‰å¯èƒ½å‡ºç°è¿™ç§æƒ…å†µ // è¿”å›minCapacity = oldCapacity + needed if (needed \u0026gt; jump) return minCapacity; // å¦‚æœæœ€å°å®¹é‡minCapacityæ²¡æœ‰è¶…è¿‡æ•°ç»„é•¿åº¦å…è®¸æœ€å¤§å€¼ï¼Œå¹¶ä¸”need \u0026lt;= jump return (oldCapacity + jump - MAX_ARRAY_SIZE \u0026lt; 0) ? oldCapacity + jump : MAX_ARRAY_SIZE; } ä¸‹é¢é€šè¿‡ä¸€ä¸ªå°ä¾‹å­å»æ¼”ç¤ºæ‰©å®¹æœºåˆ¶çš„æ‰§è¡Œæµç¨‹ï¼Œå¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // åˆå§‹æ—¶ï¼Œæ•°ç»„â»“åº¦æ˜¯5ï¼ŒçœŸå®ç´¢å¼•æ˜¯0-4ï¼Œhead = tail = 0 ArrayDeque\u0026lt;Integer\u0026gt; arrayDeque = new ArrayDeque\u0026lt;\u0026gt;(4); // æ‰§è¡Œå®Œï¼Œhead = 0, tail = 1ï¼›æ­¤æ—¶æ•°ç»„ä¸ºï¼š[1, null, null, null, null] arrayDeque.addLast(1); // æ‰§è¡Œå®Œï¼Œhead = 4ï¼Œtail = 1ï¼›æ­¤æ—¶æ•°ç»„ä¸ºï¼š[1, null, null, null, 2] arrayDeque.addFirst(2); // æ‰§è¡Œå®Œï¼Œhead = 3ï¼Œtail = 1ï¼›æ­¤æ—¶æ•°ç»„ä¸ºï¼š[1, null, null, 3, 2] arrayDeque.addFirst(3); // æ‰§è¡Œå®Œï¼Œhead = 2ï¼Œtail = 1ï¼›æ­¤æ—¶æ•°ç»„ä¸ºï¼š[1, null, 4, 3, 2] arrayDeque.addFirst(4); // æ‰§è¡Œå®Œï¼Œhead = tail = 1ï¼Œè§¦å‘æ‰©å®¹ï¼›æ­¤æ—¶æ•°ç»„ä¸ºï¼š[1, 5, 4, 3, 2]ï¼Œæ‰©å®¹å®¹é‡ä¸º5*2+2 // ç„¶åå°†æ—§æ•°æ®å¤åˆ¶åˆ°æ–°ä½ç½®ï¼Œæ­¤æ—¶æ•°ç»„ä¸ºï¼š[1, 5, 4, 3, 2, null, null, null, 5, 4, 3, 2] // æ¥ç€æ¸…æ‰æ—§æ•°æ®ï¼Œè¿™æ—¶head = 8ï¼Œtail = 1ï¼›æ­¤æ—¶æ•°ç»„ä¸ºï¼š[1, null, null, null, null, null, null, null, 5, 4, 3, 2] arrayDeque.addFirst(5); // æ‰§è¡Œå®Œï¼Œhead = 8, tail = 2ï¼›æ­¤æ—¶æ•°ç»„ä¸ºï¼š[1, 6, null, null, null, null, null, null, 5, 4, 3 ,2] arrayDeque.addLast(6); 2.5ã€å…¶å®ƒæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 // è¿”å›æ­¤åŒç«¯é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ•° public int size() { // i = tailï¼Œj = headï¼Œmodulus = elements.length // é‚£ä¹ˆi -= jä¸ºi = i-jï¼Œä»£å…¥åæ˜¯tail = tail - headï¼Œç„¶ååˆ¤æ–­è®¡ç®—åçš„tailæ˜¯å¦ \u0026lt; 0 // å¦‚æœ \u0026lt; 0ï¼Œè¯´æ˜æ˜¯head \u0026gt; tailçš„æƒ…å†µï¼Œå¯¹åº”äºå‰é¢è®²æˆå‘˜å˜é‡æåˆ°çš„æ•°ç»„æƒ…å†µ3æˆ–4ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ tailä¼šå†æ¬¡è®¡ç®—ï¼Œtail = tail + elements.lengthï¼Œè¿™æ ·è®¡ç®—å°±å¯ä»¥æ±‚å‡ºæ•°ç»„çš„å…ƒç´ ä¸ªæ•°ï¼Œä¸æ˜ç™½å¯ä»¥å¯¹ç…§å›¾æ¥çœ‹ // å¦‚æœ \u0026gt;= 0ï¼Œè¯´æ˜æ˜¯head \u0026lt;= tailçš„æƒ…å†µï¼Œå¯¹åº”äºå‰é¢è®²æˆå‘˜å˜é‡æåˆ°çš„æ•°ç»„æƒ…å†µ1æˆ–2ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç›´æ¥æŠŠtailè¿”å›å³å¯ï¼Œå› ä¸ºifæ¡ä»¶åˆ¤æ–­æ—¶å·²ç»è®¡ç®—è¿‡äº†ï¼Œè¿™æ ·è®¡ç®—å°±å¯ä»¥æ±‚å‡ºæ•°ç»„çš„å…ƒç´ ä¸ªæ•°ï¼Œä¸æ˜ç™½å¯ä»¥å¯¹ç…§å›¾æ¥çœ‹ return sub(tail, head, elements.length); } static final int sub(int i, int j, int modulus) { if ((i -= j) \u0026lt; 0) i += modulus; return i; } ä¸‰ã€æ€»ç»“ åœ¨ArrayDequeçš„æºç ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸å¹¶å‘ç›¸å…³çš„ä»£ç ï¼Œæ‰€ä»¥è¯´ArrayDequeæ˜¯éçº¿ç¨‹å®‰å…¨ç±»ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œï¼Œä¼šå¼•å‘ä¸å¯é¢„çŸ¥çš„é”™è¯¯ã€‚\nArrayDequeæ²¡æœ‰ç´¢å¼•ä½ç½®çš„æ¦‚å¿µï¼Œä¸èƒ½æ ¹æ®ç´¢å¼•ä½ç½®è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥æ²¡æœ‰æ›´æ”¹æ“ä½œï¼Œå¦‚setæ–¹æ³•ã€‚\nå¦å¤–ï¼ŒArrayDequeç¦æ­¢æ·»åŠ ç©ºå…ƒç´ ã€‚æœ€å…³é”®ä¸€ç‚¹æ˜¯ï¼šArrayDequeç”¨ä½œå †æ ˆæ—¶å¾ˆå¯èƒ½æ¯”Stackå¿«ï¼Œç”¨ä½œé˜Ÿåˆ—æ—¶æ¯”LinkedListå¿«ã€‚\n","date":"2023-04-24T14:41:31+08:00","permalink":"https://AndDevMK.github.io/post/java%E9%9B%86%E5%90%88%E7%B3%BB%E5%88%97%E4%B8%80%E6%96%87%E8%A7%A3%E8%AF%BBarraydeque%E6%BA%90%E7%A0%81jdk11/","section":"post","tags":null,"title":"Javaé›†åˆç³»åˆ—ï¼šä¸€æ–‡è§£è¯»ArrayDequeæºç ã€ŒJDK11ã€"},{"categories":["Java"],"contents":"ä¸€ã€æ¦‚è¿° LinkedListæ˜¯Java Collections Frameworkçš„ä¸€ä¸ªæˆå‘˜ï¼Œç„¶ååº•å±‚æ˜¯åŸºäºåŒå‘é“¾è¡¨æ¥å®ç°çš„ã€‚å¯¹äºLinkedListæ¥è¯´ï¼Œå¯èƒ½å¹³å¸¸å¼€å‘ç”¨çš„é¢‘ç‡å¹¶æ²¡æœ‰ArrayListå¤šï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬ä¸å»å­¦ä¹ LinkedListåŸç†çš„ç†ç”±ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒArrayListçš„ç‰¹ç‚¹æ˜¯éšæœºè®¿é—®æ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯éå°¾éƒ¨çš„æ’å…¥å’Œåˆ é™¤æ€§èƒ½å°±æ¯”è¾ƒä½ï¼Œå› ä¸ºè¦æŒªåŠ¨å…ƒç´ ä½ç½®ã€‚LinkedListå’ŒArrayListä¸€æ ·å®ç°äº†Listæ¥å£ï¼Œå› ä¸ºä¸¤è€…åº•å±‚çš„å®ç°ä¸ä¸€æ ·ï¼Œé€ å°±äº†å®ƒçš„ç‰¹ç‚¹ä¸ArrayListå‡ ä¹æ­£å¥½ç›¸åã€‚\næ¥ä¸‹æ¥ï¼Œæœ¬æ–‡ä¼šå™è¿°LinkedListæ˜¯å¦‚ä½•ç»´æŠ¤è¿™æ ·ä¸€ä¸ªåŒå‘é“¾è¡¨çš„ï¼ŒåŸºæœ¬æ“ä½œæ˜¯æ€æ ·å®ç°çš„ï¼Œä»¥åŠå…¶å®ƒçš„ç»†èŠ‚ã€‚\näºŒã€LinkedListæºç è§£è¯» 2.1ã€ç»§æ‰¿å…³ç³» ä»UMLç±»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒLinkedListç›´æ¥æˆ–é—´æ¥å®ç°äº†Iterableã€Collectionã€Listã€Dequeã€Queueã€Cloneableã€Serializableè¿™7ä¸ªæ¥å£ï¼›LinkedListç›´æ¥æˆ–é—´æ¥ç»§æ‰¿äº†AbstractSequentialListã€AbstractListã€AbstractCollectionè¿™3ä¸ªæŠ½è±¡ç±»ã€‚\nå¯èƒ½ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œä¸ºä»€ä¹ˆAbstractListå®ç°äº†Listæ¥å£ï¼ŒLinkedListè¿˜è¦å»å†å®ç°ä¸€æ¬¡Listæ¥å£ï¼Ÿ\nå…³äºè¿™ä¸€ç‚¹ï¼Œåœ¨ä¹‹å‰çš„Javaé›†åˆç³»åˆ—ï¼šä¸€æ–‡è§£è¯»ArrayListæºç ã€ŒJDK11ã€ä¸€æ–‡ä¸­å·²æœ‰è§£ç­”ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒLinkedListå’ŒArrayListåœ¨ç»§æ‰¿å…³ç³»ä¸Šæ˜¯æ¯”è¾ƒç›¸ä¼¼çš„ï¼Œæ‰€ä»¥é’ˆå¯¹ç›¸åŒç»§æ‰¿å…³ç³»å†…å®¹çš„å™è¿°ï¼Œæœ¬æ–‡ä¸å†æ¬¡å™è¿°ï¼Œæƒ³å»äº†è§£çš„è¯ï¼Œå¯ç‚¹å‡»ä¸Šæ–‡é“¾æ¥å»äº†è§£ã€‚\n2.1.1ã€Queueæ¥å£ Queueæ¥å£æ˜¯ä¸€ä¸ªé˜Ÿåˆ—æ¥å£ï¼Œå®ƒå¯¹Collectionæ¥å£è¿›è¡Œäº†æ‰©å±•ã€‚æ‰€è°“é˜Ÿåˆ—ï¼Œå°±ç±»ä¼¼äºæ—¥å¸¸ç”Ÿæ´»ä¸­çš„å„ç§æ’é˜Ÿï¼Œç‰¹ç‚¹å°±æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œåœ¨å°¾éƒ¨æ·»åŠ å…ƒç´ ï¼Œä»å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œå®ƒçš„æ¥å£å®šä¹‰ä¸ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public interface Queue\u0026lt;E\u0026gt; extends Collection\u0026lt;E\u0026gt; { // å¦‚æœå¯ä»¥åœ¨ä¸è¿åå®¹é‡é™åˆ¶çš„æƒ…å†µä¸‹ç«‹å³å°†æŒ‡å®šçš„å…ƒç´ æ’å…¥æ­¤é˜Ÿåˆ—ï¼Œåˆ™åœ¨æˆåŠŸæ—¶è¿”å›trueå¹¶åœ¨å½“å‰æ²¡æœ‰å¯ç”¨ç©ºé—´æ—¶æŠ›å‡ºIllegalStateException boolean add(E e); // å¦‚æœå¯ä»¥åœ¨ä¸è¿åå®¹é‡é™åˆ¶çš„æƒ…å†µä¸‹ç«‹å³å°†æŒ‡å®šå…ƒç´ æ’å…¥æ­¤é˜Ÿåˆ—ï¼Œå½“ä½¿ç”¨å®¹é‡å—é™çš„é˜Ÿåˆ—æ—¶ï¼Œæ­¤æ–¹æ³•é€šå¸¸ä¼˜äºaddï¼Œåè€…å¯èƒ½ä»…é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥æ’å…¥å…ƒç´ å¤±è´¥ boolean offer(E e); // æ£€ç´¢å¹¶åˆ é™¤æ­¤é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚æ­¤æ–¹æ³•ä¸poll()çš„ä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ E remove(); // æ£€ç´¢å¹¶åˆ é™¤æ­¤é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œå¦‚æœæ­¤é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null E poll(); // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚æ­¤æ–¹æ³•ä¸peekä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ E element(); // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œå¦‚æœæ­¤é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null E peek(); } Queueé˜Ÿåˆ—æä¾›äº†æ’å…¥ã€åˆ é™¤å’Œæ£€æŸ¥æ“ä½œã€‚è¿™äº›æ–¹æ³•ä¸­çš„æ¯ä¸€ä¸ªéƒ½ä»¥ä¸¤ç§å½¢å¼å­˜åœ¨ï¼šä¸€ç§åœ¨æ“ä½œå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œå¦ä¸€ç§è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆnullæˆ–false ï¼Œå…·ä½“å–å†³äºæ“ä½œï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ³¨æ„ï¼šQueueé˜Ÿåˆ—å®ç°é€šå¸¸ä¸å…è®¸æ’å…¥nullå…ƒç´ ï¼Œå°½ç®¡æŸäº›å®ç°ï¼ˆä¾‹å¦‚ LinkedListï¼‰ä¸ç¦æ­¢æ’å…¥nullã€‚å³ä½¿åœ¨å…è®¸å®ƒçš„å®ç°ä¸­ï¼Œä¹Ÿä¸åº”å°†nullæ’å…¥åˆ°Queueé˜Ÿåˆ—ä¸­ï¼Œå› ä¸ºnullä¹Ÿè¢«pollæ–¹æ³•ç”¨ä½œç‰¹æ®Šçš„è¿”å›å€¼ï¼Œä»¥æŒ‡ç¤ºé˜Ÿåˆ—ä¸åŒ…å«ä»»ä½•å…ƒç´ ã€‚\nå®è·µä¸€ä¸‹ï¼Œæˆ‘ä»¬æŠŠLinkedListå½“ä½œQueueé˜Ÿåˆ—æ¥ä½¿ç”¨ï¼Œå¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 5 6 7 Queue\u0026lt;String\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); queue.offer(\u0026#34;Jerry\u0026#34;); queue.offer(\u0026#34;Tom\u0026#34;); queue.offer(\u0026#34;May\u0026#34;); while (queue.peek() != null) { System.out.println(queue.poll()); } 2.1.2ã€Dequeæ¥å£ Dequeæ¥å£å¯¹Queueæ¥å£è¿›è¡Œäº†æ‰©å±•ï¼ŒDequeæ˜¯â€œdouble ended queueâ€çš„ç¼©å†™ï¼Œå®ƒå®šä¹‰äº†è®¿é—®åŒç«¯é˜Ÿåˆ—ä¸¤ç«¯å…ƒç´ çš„æ–¹æ³•ï¼Œæ¥å£å®šä¹‰ä¸ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 public interface Deque\u0026lt;E\u0026gt; extends Queue\u0026lt;E\u0026gt; { // å¦‚æœå¯ä»¥åœ¨ä¸è¿åå®¹é‡é™åˆ¶çš„æƒ…å†µä¸‹ç«‹å³å°†æŒ‡å®šçš„å…ƒç´ æ’å…¥æ­¤åŒç«¯é˜Ÿåˆ—çš„å‰é¢ï¼Œå¦‚æœå½“å‰æ²¡æœ‰å¯ç”¨ç©ºé—´åˆ™æŠ›å‡ºIllegalStateException ã€‚ä½¿ç”¨å®¹é‡å—é™çš„åŒç«¯é˜Ÿåˆ—æ—¶ï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨æ–¹æ³•offerFirst void addFirst(E e); // å¦‚æœå¯ä»¥åœ¨ä¸è¿åå®¹é‡é™åˆ¶çš„æƒ…å†µä¸‹ç«‹å³æ’å…¥æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™åœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾æ’å…¥æŒ‡å®šçš„å…ƒç´ ï¼Œå¦‚æœå½“å‰æ²¡æœ‰å¯ç”¨ç©ºé—´ï¼Œåˆ™æŠ›å‡ºIllegalStateException ã€‚ä½¿ç”¨å®¹é‡å—é™çš„åŒç«¯é˜Ÿåˆ—æ—¶ï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨æ–¹æ³•offerLastã€‚æ­¤æ–¹æ³•ç­‰æ•ˆäºadd void addLast(E e); // å°†æŒ‡å®šçš„å…ƒç´ æ’å…¥æ­¤åŒç«¯é˜Ÿåˆ—çš„å‰é¢ï¼Œé™¤éå®ƒè¿åå®¹é‡é™åˆ¶ã€‚å½“ä½¿ç”¨å®¹é‡å—é™çš„åŒç«¯é˜Ÿåˆ—æ—¶ï¼Œæ­¤æ–¹æ³•é€šå¸¸ä¼˜äºaddFirstæ–¹æ³•ï¼Œåè€…ä»…é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ‰èƒ½æ’å…¥å…ƒç´ å¤±è´¥ã€‚ boolean offerFirst(E e); // é™¤éè¿åå®¹é‡é™åˆ¶ï¼Œå¦åˆ™åœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚å½“ä½¿ç”¨å®¹é‡å—é™çš„åŒç«¯é˜Ÿåˆ—æ—¶ï¼Œæ­¤æ–¹æ³•é€šå¸¸ä¼˜äºaddLastæ–¹æ³•ï¼Œåè€…ä»…é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ‰èƒ½æ’å…¥å…ƒç´ å¤±è´¥ boolean offerLast(E e); // æ£€ç´¢å¹¶åˆ é™¤æ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ­¤æ–¹æ³•ä¸pollFirstä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ E removeFirst(); // æ£€ç´¢å¹¶åˆ é™¤æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚æ­¤æ–¹æ³•ä¸pollLastä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ E removeLast(); // æ£€ç´¢å¹¶åˆ é™¤æ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null E pollFirst(); // æ£€ç´¢å¹¶åˆ é™¤æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null E pollLast(); // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ­¤æ–¹æ³•ä¸peekFirstä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ E getFirst(); // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚æ­¤æ–¹æ³•ä¸peekLastä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ E getLast(); // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null E peekFirst(); // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºåˆ™è¿”å›null E peekLast(); // *** Queue methods *** // å¦‚æœå¯ä»¥åœ¨ä¸è¿åå®¹é‡é™åˆ¶çš„æƒ…å†µä¸‹ç«‹å³å°†æŒ‡å®šå…ƒç´ æ’å…¥æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„é˜Ÿåˆ—ï¼ˆæ¢å¥è¯è¯´ï¼Œåœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„å°¾éƒ¨ï¼‰ï¼ŒæˆåŠŸæ—¶è¿”å›trueå¹¶åœ¨å½“å‰æ²¡æœ‰å¯ç”¨ç©ºé—´æ—¶æŠ›å‡ºIllegalStateException .ä½¿ç”¨å®¹é‡å—é™çš„åŒç«¯é˜Ÿåˆ—æ—¶ï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨offer ã€‚æ­¤æ–¹æ³•ç­‰æ•ˆäºaddLast boolean add(E e); // å¦‚æœå¯ä»¥åœ¨ä¸è¿åå®¹é‡é™åˆ¶çš„æƒ…å†µä¸‹ç«‹å³å°†æŒ‡å®šå…ƒç´ æ’å…¥æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„é˜Ÿåˆ—ï¼ˆæ¢å¥è¯è¯´ï¼Œåœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„å°¾éƒ¨ï¼‰ï¼ŒæˆåŠŸæ—¶è¿”å›true ï¼Œå¦‚æœå½“å‰æ²¡æœ‰å¯ç”¨ç©ºé—´åˆ™è¿”å›false ã€‚å½“ä½¿ç”¨å®¹é‡å—é™çš„åŒç«¯é˜Ÿåˆ—æ—¶ï¼Œæ­¤æ–¹æ³•é€šå¸¸ä¼˜äºaddæ–¹æ³•ï¼Œåè€…ä»…é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ‰èƒ½æ’å…¥å…ƒç´ å¤±è´¥ã€‚æ­¤æ–¹æ³•ç­‰æ•ˆäºofferLast boolean offer(E e); // æ£€ç´¢å¹¶åˆ é™¤æ­¤åŒç«¯é˜Ÿåˆ—æ‰€è¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´éƒ¨ï¼ˆæ¢å¥è¯è¯´ï¼Œæ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚æ­¤æ–¹æ³•ä¸poll()çš„ä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ­¤æ–¹æ³•ç­‰æ•ˆäºremoveFirst() E remove(); // æ£€ç´¢å¹¶ç§»é™¤æ­¤åŒç«¯é˜Ÿåˆ—æ‰€è¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´éƒ¨ï¼ˆæ¢å¥è¯è¯´ï¼Œæ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œæˆ–è€…å¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null ã€‚æ­¤æ–¹æ³•ç­‰æ•ˆäºpollFirst() E poll(); // æ£€ç´¢ä½†ä¸åˆ é™¤ç”±æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´éƒ¨ï¼ˆæ¢å¥è¯è¯´ï¼Œæ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚æ­¤æ–¹æ³•ä¸peekä¸åŒä¹‹å¤„ä»…åœ¨äºï¼Œå¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ­¤æ–¹æ³•ç­‰æ•ˆäºgetFirst() E element(); // æ£€ç´¢ä½†ä¸åˆ é™¤ç”±æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´éƒ¨ï¼ˆæ¢å¥è¯è¯´ï¼Œæ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œæˆ–è€…å¦‚æœæ­¤åŒç«¯é˜Ÿåˆ—ä¸ºç©ºåˆ™è¿”å›null ã€‚æ­¤æ–¹æ³•ç­‰æ•ˆäºpeekFirst() E peek(); // *** Stack methods *** // å¦‚æœå¯ä»¥åœ¨ä¸è¿åå®¹é‡é™åˆ¶çš„æƒ…å†µä¸‹ç«‹å³å°†å…ƒç´ æ¨å…¥æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„å †æ ˆï¼ˆæ¢å¥è¯è¯´ï¼Œåœ¨æ­¤åŒç«¯é˜Ÿåˆ—çš„å¤´éƒ¨ï¼‰ï¼Œå¦‚æœå½“å‰æ²¡æœ‰å¯ç”¨ç©ºé—´åˆ™æŠ›å‡ºIllegalStateException void push(E e); // ä»æ­¤åŒç«¯é˜Ÿåˆ—è¡¨ç¤ºçš„å †æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´ ã€‚æ¢å¥è¯è¯´ï¼Œåˆ é™¤å¹¶è¿”å›æ­¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ­¤æ–¹æ³•ç­‰æ•ˆäºremoveFirst() E pop(); } Dequeæ¥å£æä¾›äº†æ’å…¥ã€åˆ é™¤å’Œæ£€æŸ¥çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸­çš„æ¯ä¸€ä¸ªéƒ½ä»¥ä¸¤ç§å½¢å¼å­˜åœ¨ï¼šä¸€ç§åœ¨æ“ä½œå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œå¦ä¸€ç§è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆ nullæˆ–false ï¼Œå…·ä½“å–å†³äºæ“ä½œï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å½“åŒç«¯é˜Ÿåˆ—ç”¨ä½œé˜Ÿåˆ—æ—¶ï¼Œä¼šäº§ç”ŸFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰è¡Œä¸ºã€‚å…ƒç´ åœ¨åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾æ·»åŠ ï¼Œå¹¶ä»å¼€å¤´åˆ é™¤ã€‚ä»Queueæ¥å£ç»§æ‰¿çš„æ–¹æ³•ä¸Dequeæ¥å£æ–¹æ³•å®Œå…¨ç­‰ä»·ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é™¤æ­¤ä¹‹å¤–ï¼ŒåŒç«¯é˜Ÿåˆ—ä¹Ÿå¯ä»¥ç”¨ä½œLIFOï¼ˆåè¿›å…ˆå‡ºï¼‰å †æ ˆã€‚åº”ä¼˜å…ˆä½¿ç”¨æ­¤æ¥å£è€Œä¸æ˜¯ä½¿ç”¨Stackç±»ã€‚å½“åŒç«¯é˜Ÿåˆ—ç”¨ä½œå †æ ˆæ—¶ï¼Œå…ƒç´ ä»åŒç«¯é˜Ÿåˆ—çš„å¼€å¤´è¢«å‹å…¥å’Œå¼¹å‡ºã€‚Stackæ–¹æ³•ç­‰åŒäºDequeæ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å®è·µä¸€ä¸‹ï¼Œæˆ‘ä»¬æŠŠLinkedListå½“ä½œDequeå †æ ˆæ¥ä½¿ç”¨ï¼Œå¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 5 6 7 Deque\u0026lt;String\u0026gt; deque = new LinkedList\u0026lt;\u0026gt;(); deque.push(\u0026#34;Jerry\u0026#34;); deque.push(\u0026#34;Tom\u0026#34;); deque.push(\u0026#34;May\u0026#34;); while (deque.peek() != null) { System.out.println(deque.pop()); } æ³¨æ„ï¼šå½“åŒç«¯é˜Ÿåˆ—ç”¨ä½œé˜Ÿåˆ—æˆ–å †æ ˆæ—¶ï¼Œpeekæ–¹æ³•åŒæ ·æœ‰æ•ˆï¼›åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œå…ƒç´ éƒ½æ˜¯ä»åŒç«¯é˜Ÿåˆ—çš„å¼€å¤´æå–çš„ã€‚\nè™½ç„¶å¹¶æœªä¸¥æ ¼è¦æ±‚Dequeé˜Ÿåˆ—å®ç°ç¦æ­¢æ’å…¥ç©ºå…ƒç´ ï¼Œä½†å¼ºçƒˆå»ºè®®å®ƒä»¬è¿™æ ·åšã€‚å¼ºçƒˆå»ºè®®ä»»ä½•ç¡®å®å…è®¸nullå…ƒç´ çš„Dequeå®ç°çš„ç”¨æˆ·ä¸è¦åˆ©ç”¨æ’å…¥nullçš„èƒ½åŠ›ã€‚ä¹‹æ‰€ä»¥å¦‚æ­¤ï¼Œæ˜¯å› ä¸ºnullè¢«å„ç§æ–¹æ³•ç”¨ä½œç‰¹æ®Šçš„è¿”å›å€¼ï¼Œä»¥æŒ‡ç¤ºåŒç«¯é˜Ÿåˆ—ä¸ºç©ºã€‚\nDequeæ¥å£é™¤äº†ä¸Šé¢ä»‹ç»çš„æ ¸å¿ƒæ–¹æ³•å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªè¿­ä»£å™¨æ–¹æ³•ï¼Œå¯ä»¥ä»åå¾€å‰éå†ï¼Œå¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 5 Deque\u0026lt;String\u0026gt; deque = new LinkedList\u0026lt;\u0026gt;(Arrays.asList(new String[]{\u0026#34;Jerry\u0026#34;, \u0026#34;Tom\u0026#34;, \u0026#34;May\u0026#34;})); Iterator\u0026lt;String\u0026gt; iterator = deque.descendingIterator(); while (iterator.hasNext()) { System.out.println(iterator.next()); } 2.2ã€æˆå‘˜å˜é‡ 1 2 3 4 5 6 7 8 // LinkedListçš„å¤§å°ï¼ˆå®ƒåŒ…å«çš„å…ƒç´ æ•°ï¼‰ transient int size = 0; // æŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ transient Node\u0026lt;E\u0026gt; first; // æŒ‡å‘æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ transient Node\u0026lt;E\u0026gt; last; LinkedListçš„æˆå‘˜å˜é‡ä¸å¤šï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹å†…éƒ¨ç±»NodeèŠ‚ç‚¹çš„å®ç°ï¼Œå¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 private static class Node\u0026lt;E\u0026gt; { // å­˜å‚¨å…ƒç´  E item; // åç»§èŠ‚ç‚¹ Node\u0026lt;E\u0026gt; next; // å‰é©±èŠ‚ç‚¹ Node\u0026lt;E\u0026gt; prev; Node(Node\u0026lt;E\u0026gt; prev, E element, Node\u0026lt;E\u0026gt; next) { this.item = element; this.next = next; this.prev = prev; } } ä»ä¸Šé¢NodeèŠ‚ç‚¹çš„æ„é€ å‡½æ•°æ¥çœ‹ï¼ŒNodeèŠ‚ç‚¹çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š LinkedListå°±æ˜¯ç”±ä¸€ä¸ªä¸ªçš„NodeèŠ‚ç‚¹åŒå‘è¿æ¥è€Œæˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2.3ã€æ„é€ æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 // æ„é€ ä¸€ä¸ªç©ºåˆ—è¡¨ public LinkedList() { } // æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆå…ƒç´ çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§é›†åˆè¿­ä»£å™¨è¿”å›å…ƒç´ çš„é¡ºåº public LinkedList(Collection\u0026lt;? extends E\u0026gt; c) { this(); // æŒ‰ç…§æŒ‡å®šé›†åˆçš„â€‹â€‹è¿­ä»£å™¨è¿”å›çš„é¡ºåºï¼Œå°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ addAll(c); } 2.4ã€æ ¸å¿ƒæ–¹æ³• 2.4.1ã€æ’å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 // ***********å°¾éƒ¨æ’å…¥*********** // å°†æŒ‡å®šçš„å…ƒç´ é™„åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ public boolean add(E e) { linkLast(e); return true; } // å°†æŒ‡å®šçš„å…ƒç´ é™„åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ public void addLast(E e) { linkLast(e); } // æ·»åŠ æŒ‡å®šå…ƒç´ ä½œä¸ºæ­¤åˆ—è¡¨çš„å°¾éƒ¨ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ ï¼‰ public boolean offer(E e) { return add(e); } // åœ¨æ­¤åˆ—è¡¨çš„æœ«å°¾æ’å…¥æŒ‡å®šçš„å…ƒç´  public boolean offerLast(E e) { addLast(e); return true; } // æŒ‰ç…§æŒ‡å®šé›†åˆçš„â€‹â€‹è¿­ä»£å™¨è¿”å›çš„é¡ºåºï¼Œå°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ public boolean addAll(Collection\u0026lt;? extends E\u0026gt; c) { return addAll(size, c); } // ***********å¤´éƒ¨æ’å…¥*********** // åœ¨æ­¤åˆ—è¡¨çš„å¼€å¤´æ’å…¥æŒ‡å®šçš„å…ƒç´  public void addFirst(E e) { linkFirst(e); } // åœ¨æ­¤åˆ—è¡¨çš„å‰é¢æ’å…¥æŒ‡å®šçš„å…ƒç´  public boolean offerFirst(E e) { addFirst(e); return true; } // å°†ä¸€ä¸ªå…ƒç´ æ¨å…¥æ­¤åˆ—è¡¨è¡¨ç¤ºçš„å †æ ˆä¸­ã€‚æ¢å¥è¯è¯´ï¼Œå°†å…ƒç´ æ’å…¥æ­¤åˆ—è¡¨çš„å‰é¢ public void push(E e) { addFirst(e); } // ***********ä¸­é—´æ’å…¥*********** // åœ¨æ­¤åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šå…ƒç´ ã€‚å°†å½“å‰ä½äºè¯¥ä½ç½®çš„å…ƒç´ ï¼ˆå¦‚æœæœ‰ï¼‰å’Œä»»ä½•åç»­å…ƒç´ å‘å³ç§»åŠ¨ï¼ˆå°†å…¶ç´¢å¼•åŠ ä¸€ï¼‰ public void add(int index, E element) { // åˆ¤æ–­å‚æ•°æ˜¯å¦æ˜¯è¿­ä»£å™¨æˆ–æ·»åŠ æ“ä½œçš„æœ‰æ•ˆä½ç½®çš„ç´¢å¼• checkPositionIndex(index); // å¦‚æœæ’å…¥çš„ç´¢å¼•ä½ç½®ä¸ºsizeï¼Œé‚£è¯´æ˜æ˜¯å°¾éƒ¨æ’å…¥ if (index == size) // æ‰§è¡Œå°¾éƒ¨æ’å…¥ linkLast(element); else // å…ˆæ‰¾åˆ°å½“å‰é“¾è¡¨ä¸ŠæŒ‡å®šindexä½ç½®çš„nodeèŠ‚ç‚¹ï¼Œç„¶åå†æ’å…¥æ–°èŠ‚ç‚¹ linkBefore(element, node(index)); } // ***********æ’å…¥æ ¸å¿ƒå®ç°*********** // é“¾æ¥eä½œä¸ºæœ€åä¸€ä¸ªå…ƒç´  void linkLast(E e) { // è·å–å½“å‰é“¾è¡¨çš„lastèŠ‚ç‚¹ final Node\u0026lt;E\u0026gt; l = last; // åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ final Node\u0026lt;E\u0026gt; newNode = new Node\u0026lt;\u0026gt;(l, e, null); // è®©æ–°èŠ‚ç‚¹æˆä¸ºlastèŠ‚ç‚¹ last = newNode; // å¦‚æœlastèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜è¿™æ˜¯ç¬¬ä¸€æ¬¡æ’å…¥æ–°èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ–°èŠ‚ç‚¹ä¹Ÿæ˜¯firstèŠ‚ç‚¹ if (l == null) first = newNode; else // å¦åˆ™æ–°èŠ‚ç‚¹æ˜¯lastèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ l.next = newNode; // æ›´æ–°sizeï¼šå…ƒç´ ä¸ªæ•°+1 size++; modCount++; } // é“¾æ¥eä½œä¸ºç¬¬ä¸€ä¸ªå…ƒç´  private void linkFirst(E e) { // è·å–å½“å‰é“¾è¡¨çš„firstèŠ‚ç‚¹ final Node\u0026lt;E\u0026gt; f = first; // åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ final Node\u0026lt;E\u0026gt; newNode = new Node\u0026lt;\u0026gt;(null, e, f); // è®©æ–°èŠ‚ç‚¹æˆä¸ºlastèŠ‚ç‚¹ first = newNode; // å¦‚æœfirstèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜è¿™æ˜¯ç¬¬ä¸€æ¬¡æ’å…¥æ–°èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ–°èŠ‚ç‚¹ä¹Ÿæ˜¯lastèŠ‚ç‚¹ if (f == null) last = newNode; else // å¦åˆ™æ–°èŠ‚ç‚¹æ˜¯firstèŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ f.prev = newNode; // æ›´æ–°sizeï¼šå…ƒç´ ä¸ªæ•°+1 size++; modCount++; } // è¿”å›æŒ‡å®šå…ƒç´ ç´¢å¼•å¤„çš„ï¼ˆéç©ºï¼‰èŠ‚ç‚¹ã€‚ Node\u0026lt;E\u0026gt; node(int index) { // assert isElementIndex(index); // size \u0026gt;\u0026gt; 1 == size/2 // å¦‚æœindex \u0026lt; size/2ï¼Œé‚£ä¹ˆå°±ä»firstèŠ‚ç‚¹å¼€å§‹å¾€åéå†æŸ¥æ‰¾ if (index \u0026lt; (size \u0026gt;\u0026gt; 1)) { Node\u0026lt;E\u0026gt; x = first; for (int i = 0; i \u0026lt; index; i++) x = x.next; return x; } else { // å¦‚æœindex \u0026gt;= size/2ï¼Œé‚£ä¹ˆå°±ä»lastèŠ‚ç‚¹å¼€å§‹å¾€å‰éå†æŸ¥æ‰¾ Node\u0026lt;E\u0026gt; x = last; for (int i = size - 1; i \u0026gt; index; i--) x = x.prev; return x; } } // åœ¨éç©ºèŠ‚ç‚¹ succ ä¹‹å‰æ’å…¥å…ƒç´  e void linkBefore(E e, Node\u0026lt;E\u0026gt; succ) { // assert succ != null; // è·å–å½“å‰é“¾è¡¨çš„succèŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹pred final Node\u0026lt;E\u0026gt; pred = succ.prev; // åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ final Node\u0026lt;E\u0026gt; newNode = new Node\u0026lt;\u0026gt;(pred, e, succ); // è®©æ–°èŠ‚ç‚¹æˆä¸ºsuccèŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ succ.prev = newNode; // å¦‚æœpredèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜è¿™æ˜¯æ’å…¥åˆ°å¤´èŠ‚ç‚¹ä½ç½®ï¼Œæ‰€ä»¥æ–°èŠ‚ç‚¹ä¹Ÿæ˜¯firstèŠ‚ç‚¹ if (pred == null) first = newNode; else // å¦åˆ™æ–°èŠ‚ç‚¹æ˜¯predèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ pred.next = newNode; // æ›´æ–°sizeï¼šå…ƒç´ ä¸ªæ•°+1 size++; modCount++; } // å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ’å…¥æ­¤åˆ—è¡¨ï¼Œä»æŒ‡å®šä½ç½®å¼€å§‹ã€‚å°†å½“å‰ä½äºè¯¥ä½ç½®çš„å…ƒç´ ï¼ˆå¦‚æœæœ‰ï¼‰å’Œä»»ä½•åç»­å…ƒç´ å‘å³ç§»åŠ¨ï¼ˆå¢åŠ å®ƒä»¬çš„ç´¢å¼•ï¼‰ã€‚æ–°å…ƒç´ å°†æŒ‰ç…§æŒ‡å®šé›†åˆçš„â€‹â€‹è¿­ä»£å™¨è¿”å›çš„é¡ºåºå‡ºç°åœ¨åˆ—è¡¨ä¸­ã€‚ public boolean addAll(int index, Collection\u0026lt;? extends E\u0026gt; c) { // åˆ¤æ–­å‚æ•°æ˜¯å¦æ˜¯è¿­ä»£å™¨æˆ–æ·»åŠ æ“ä½œçš„æœ‰æ•ˆä½ç½®çš„ç´¢å¼• checkPositionIndex(index); // å°†é›†åˆcçš„å…ƒç´ æŒ‰é›†åˆcçš„é¡ºåºè½¬æ¢ä¸ºæ•°ç»„è¿”å› Object[] a = c.toArray(); // å¦‚æœæ•°ç»„é•¿åº¦ä¸º0ï¼Œé‚£ä¹ˆè¿”å›false int numNew = a.length; if (numNew == 0) return false; // å®šä¹‰å½“å‰é“¾è¡¨indexç´¢å¼•å¯¹åº”çš„succèŠ‚ç‚¹ï¼Œä»¥åŠsuccèŠ‚ç‚¹çš„å‰èŠ‚ç‚¹pred Node\u0026lt;E\u0026gt; pred, succ; // å¦‚æœindex == sizeï¼Œè¯´æ˜æ˜¯å°¾éƒ¨æ’å…¥ if (index == size) { // sizeä½ç½®çš„èŠ‚ç‚¹ä¸ºnull succ = null; // predèŠ‚ç‚¹ä¸ºæ’å…¥ä½ç½®çš„å‰èŠ‚ç‚¹last pred = last; } else { // å¦åˆ™æ˜¯ä¸­é—´æ’å…¥ï¼Œé‚£ä¹ˆå…ˆæ‰¾åˆ°å½“å‰é“¾è¡¨ä¸ŠæŒ‡å®šindexä½ç½®çš„nodeèŠ‚ç‚¹ï¼Œç„¶åå†æ’å…¥æ–°èŠ‚ç‚¹ succ = node(index); // predä¸ºsuccçš„å‰èŠ‚ç‚¹ pred = succ.prev; } // éå†æ•°ç»„ï¼Œè®©æ•°ç»„è½¬æ¢ä¸ºé“¾è¡¨ for (Object o : a) { @SuppressWarnings(\u0026#34;unchecked\u0026#34;) E e = (E) o; // åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ Node\u0026lt;E\u0026gt; newNode = new Node\u0026lt;\u0026gt;(pred, e, null); // å¦‚æœpredèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜è¿™æ˜¯æ’å…¥åˆ°å¤´èŠ‚ç‚¹ä½ç½®ï¼Œæ‰€ä»¥æ–°èŠ‚ç‚¹ä¹Ÿæ˜¯firstèŠ‚ç‚¹ if (pred == null) first = newNode; else // å¦åˆ™æ–°èŠ‚ç‚¹æ˜¯predèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ pred.next = newNode; // æ¯ä¸€è½®å¾ªç¯ç»“æŸï¼Œæ–°èŠ‚ç‚¹å°±æ˜¯predèŠ‚ç‚¹ pred = newNode; } // å¦‚æœsuccèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜æ˜¯å°¾éƒ¨æ’å…¥ï¼Œæ­¤æ—¶æ’å…¥å·²ç»å®Œæˆï¼Œé‚£ä¹ˆpredèŠ‚ç‚¹ä¸ºæ•°ç»„çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥ç†æ‰€åº”å½“æˆä¸ºlastèŠ‚ç‚¹ if (succ == null) { last = pred; } else { // å¦‚æœsuccèŠ‚ç‚¹ä¸ä¸ºnullï¼Œè¯´æ˜æ˜¯ä¸­é—´æ’å…¥ï¼Œæ­¤æ—¶æ’å…¥å·²ç»å®Œæˆï¼Œé‚£ä¹ˆæ•°ç»„çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘æ’å…¥ä½ç½®èŠ‚ç‚¹succ pred.next = succ; // æ•°ç»„çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹predï¼Œç†æ‰€åº”å½“æˆä¸ºæ’å…¥ä½ç½®èŠ‚ç‚¹succçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ succ.prev = pred; } // æ›´æ–°sizeï¼šå…ƒç´ ä¸ªæ•°+æ•°ç»„é•¿åº¦ size += numNew; modCount++; return true; } 2.4.2ã€åˆ é™¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 // ***********å°¾éƒ¨åˆ é™¤*********** // ä»æ­¤åˆ—è¡¨ä¸­ç§»é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´  public E removeLast() { final Node\u0026lt;E\u0026gt; l = last; if (l == null) throw new NoSuchElementException(); return unlinkLast(l); } // æ£€ç´¢å¹¶åˆ é™¤æ­¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å›null public E pollLast() { final Node\u0026lt;E\u0026gt; l = last; return (l == null) ? null : unlinkLast(l); } // ***********å¤´éƒ¨åˆ é™¤*********** // æ£€ç´¢å¹¶åˆ é™¤æ­¤åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ public E remove() { return removeFirst(); } // æ£€ç´¢å¹¶åˆ é™¤æ­¤åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ public E poll() { final Node\u0026lt;E\u0026gt; f = first; return (f == null) ? null : unlinkFirst(f); } // ä»æ­¤åˆ—è¡¨ä¸­ç§»é™¤å¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ public E removeFirst() { final Node\u0026lt;E\u0026gt; f = first; if (f == null) throw new NoSuchElementException(); return unlinkFirst(f); } // æ£€ç´¢å¹¶åˆ é™¤æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å›null public E pollFirst() { final Node\u0026lt;E\u0026gt; f = first; return (f == null) ? null : unlinkFirst(f); } // ä»æ­¤åˆ—è¡¨è¡¨ç¤ºçš„å †æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´ ã€‚æ¢å¥è¯è¯´ï¼Œåˆ é™¤å¹¶è¿”å›æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´  public E pop() { return removeFirst(); } // ***********ä¸­é—´åˆ é™¤*********** // ç§»é™¤æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚å°†ä»»ä½•åç»­å…ƒç´ å‘å·¦ç§»åŠ¨ï¼ˆä»å…¶ç´¢å¼•ä¸­å‡å»ä¸€ä¸ªï¼‰ã€‚è¿”å›ä»åˆ—è¡¨ä¸­åˆ é™¤çš„å…ƒç´ ã€‚ public E remove(int index) { checkElementIndex(index); return unlink(node(index)); } // ***********åˆ é™¤æ ¸å¿ƒå®ç°*********** // å–æ¶ˆé“¾æ¥éç©ºçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹f private E unlinkFirst(Node\u0026lt;E\u0026gt; f) { // assert f == first \u0026amp;\u0026amp; f != null; // è·å–nodeèŠ‚ç‚¹çš„å…ƒç´ element final E element = f.item; // è·å–nodeèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ final Node\u0026lt;E\u0026gt; next = f.next; // å°†nodeèŠ‚ç‚¹æŒæœ‰çš„å…ƒç´ itemç½®ä¸ºnull f.item = null; // å°†nodeèŠ‚ç‚¹æŒæœ‰çš„åç»§èŠ‚ç‚¹æŒ‡é’ˆç½®ä¸ºnull f.next = null; // help GC // nodeèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºfirstèŠ‚ç‚¹ first = next; // å¦‚æœnextèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿè¢«åˆ é™¤äº†ï¼Œé‚£ä¹ˆlastèŠ‚ç‚¹ç½®ä¸ºnull if (next == null) last = null; else // å¦åˆ™nodeèŠ‚ç‚¹ç½®ä¸ºnull next.prev = null; // æ›´æ–°sizeï¼šå…ƒç´ ä¸ªæ•°-1 size--; modCount++; return element; } // å–æ¶ˆé“¾æ¥éç©ºçš„æœ€åä¸€ä¸ªèŠ‚ç‚¹l private E unlinkLast(Node\u0026lt;E\u0026gt; l) { // assert l == last \u0026amp;\u0026amp; l != null; // è·å–nodeèŠ‚ç‚¹çš„å…ƒç´ element final E element = l.item; // è·å–nodeèŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ final Node\u0026lt;E\u0026gt; prev = l.prev; // å°†nodeèŠ‚ç‚¹æŒæœ‰çš„å…ƒç´ itemç½®ä¸ºnull l.item = null; // å°†nodeèŠ‚ç‚¹æŒæœ‰çš„å‰èº¯èŠ‚ç‚¹æŒ‡é’ˆç½®ä¸ºnull l.prev = null; // help GC // nodeèŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºlastèŠ‚ç‚¹ last = prev; // å¦‚æœprevèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿè¢«åˆ é™¤äº†ï¼Œé‚£ä¹ˆfirstèŠ‚ç‚¹ç½®ä¸ºnull if (prev == null) first = null; else // å¦åˆ™nodeèŠ‚ç‚¹ç½®ä¸ºnull prev.next = null; // æ›´æ–°sizeï¼šå…ƒç´ ä¸ªæ•°-1 size--; modCount++; return element; } // å–æ¶ˆé“¾æ¥éç©ºèŠ‚ç‚¹x E unlink(Node\u0026lt;E\u0026gt; x) { // assert x != null; // è·å–nodeèŠ‚ç‚¹çš„å…ƒç´ element final E element = x.item; // è·å–nodeèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ final Node\u0026lt;E\u0026gt; next = x.next; // è·å–nodeèŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ final Node\u0026lt;E\u0026gt; prev = x.prev; // å¦‚æœprevèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜æ˜¯å¤´éƒ¨åˆ é™¤ï¼Œé‚£ä¹ˆnextèŠ‚ç‚¹æˆä¸ºfirstèŠ‚ç‚¹ if (prev == null) { first = next; } else { // å¦‚æœprevèŠ‚ç‚¹ä¸ä¸ºnullï¼Œè¯´æ˜æ˜¯ä¸­é—´åˆ é™¤ï¼Œé‚£ä¹ˆnextèŠ‚ç‚¹æˆä¸ºå‰é©±èŠ‚ç‚¹prevçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ prev.next = next; // nodeèŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æŒ‡é’ˆç½®ä¸ºnull x.prev = null; } // å¦‚æœnextèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜æ˜¯å°¾éƒ¨åˆ é™¤ï¼Œé‚£ä¹ˆprevèŠ‚ç‚¹æˆä¸ºlastèŠ‚ç‚¹ if (next == null) { last = prev; } else { // å¦‚æœprevèŠ‚ç‚¹ä¸ä¸ºnullï¼Œè¯´æ˜æ˜¯ä¸­é—´åˆ é™¤ï¼Œé‚£ä¹ˆprevèŠ‚ç‚¹æˆä¸ºåç»§èŠ‚ç‚¹nextçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ next.prev = prev; // nodeèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æŒ‡é’ˆç½®ä¸ºnull x.next = null; } // å°†nodeèŠ‚ç‚¹æŒæœ‰çš„å…ƒç´ itemç½®ä¸ºnull x.item = null; // æ›´æ–°sizeï¼šå…ƒç´ ä¸ªæ•°-1 size--; modCount++; return element; } // ä»æ­¤åˆ—è¡¨ä¸­ç§»é™¤ç¬¬ä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚å¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™å®ƒä¿æŒä¸å˜ã€‚æ›´æ­£å¼åœ°è¯´ï¼Œåˆ é™¤å…·æœ‰æœ€ä½ç´¢å¼•iå…ƒç´  public boolean remove(Object o) { // å¦‚æœè¦åˆ é™¤çš„å…ƒç´ ä¸ºnullï¼Œé‚£ä¹ˆå°±ä»firstèŠ‚ç‚¹å¼€å§‹å¾€åéå†ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ºnullçš„å…ƒç´ ï¼Œç„¶åæ‰§è¡Œåˆ é™¤ if (o == null) { for (Node\u0026lt;E\u0026gt; x = first; x != null; x = x.next) { if (x.item == null) { unlink(x); return true; } } } else { // å¦‚æœè¦åˆ é™¤çš„å…ƒç´ ä¸ä¸ºnullï¼Œé‚£ä¹ˆå°±ä»firstèŠ‚ç‚¹å¼€å§‹å¾€åéå†ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªå’Œoç›¸åŒçš„å…ƒç´ ï¼Œç„¶åæ‰§è¡Œåˆ é™¤ for (Node\u0026lt;E\u0026gt; x = first; x != null; x = x.next) { if (o.equals(x.item)) { unlink(x); return true; } } } return false; } 2.4.3ã€æ›´æ”¹ 1 2 3 4 5 6 7 8 // ç”¨æŒ‡å®šå…ƒç´ æ›¿æ¢æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´  public E set(int index, E element) { checkElementIndex(index); Node\u0026lt;E\u0026gt; x = node(index); E oldVal = x.item; x.item = element; return oldVal; } 2.4.4ã€æ£€ç´¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // ***********å¤´éƒ¨æ£€ç´¢*********** // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ public E element() { return getFirst(); } // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ public E peek() { final Node\u0026lt;E\u0026gt; f = first; return (f == null) ? null : f.item; } // è¿”å›æ­¤åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  public E getFirst() { final Node\u0026lt;E\u0026gt; f = first; if (f == null) throw new NoSuchElementException(); return f.item; } // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å›null public E peekFirst() { final Node\u0026lt;E\u0026gt; f = first; return (f == null) ? null : f.item; } // ***********å°¾éƒ¨æ£€ç´¢*********** // è¿”å›æ­¤åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´  public E getLast() { final Node\u0026lt;E\u0026gt; l = last; if (l == null) throw new NoSuchElementException(); return l.item; } // æ£€ç´¢ä½†ä¸åˆ é™¤æ­¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å›null public E peekLast() { final Node\u0026lt;E\u0026gt; l = last; return (l == null) ? null : l.item; } // ***********ä¸­é—´æ£€ç´¢*********** // è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´  public E get(int index) { checkElementIndex(index); return node(index).item; } 2.5ã€å…¶å®ƒæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å› -1ï¼Œæ›´æ­£å¼åœ°è¯´ï¼Œè¿”å›å…·æœ‰æœ€ä½ç´¢å¼•iå…ƒç´  public int indexOf(Object o) { int index = 0; // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸ºnullï¼Œé‚£ä¹ˆå°±ä»firstèŠ‚ç‚¹å¼€å§‹å¾€åéå†ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ºnullçš„å…ƒç´ ï¼Œç„¶åè¿”å›index if (o == null) { for (Node\u0026lt;E\u0026gt; x = first; x != null; x = x.next) { if (x.item == null) return index; index++; } } else { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸ä¸ºnullï¼Œé‚£ä¹ˆå°±ä»firstèŠ‚ç‚¹å¼€å§‹å¾€åéå†ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªå’Œoç›¸åŒçš„å…ƒç´ ï¼Œç„¶åè¿”å›index for (Node\u0026lt;E\u0026gt; x = first; x != null; x = x.next) { if (o.equals(x.item)) return index; index++; } } return -1; } ä¸‰ã€æ€»ç»“ åœ¨LinkedListçš„æºç ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸å¹¶å‘ç›¸å…³çš„ä»£ç ï¼Œæ‰€ä»¥è¯´LinkedListæ˜¯éçº¿ç¨‹å®‰å…¨ç±»ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œï¼Œä¼šå¼•å‘ä¸å¯é¢„çŸ¥çš„é”™è¯¯ã€‚åº”è¯¥ä½¿ç”¨Collections.synchronizedListæ–¹æ³•åŒ…è£…åˆ—è¡¨ï¼Œæœ€å¥½åœ¨åˆ›å»ºæ—¶å®Œæˆï¼Œå¦‚ä¸‹ä»£ç ï¼š\n1 List list = Collections.synchronizedList(new LinkedList(...)); å¦å¤–ï¼ŒLinkedListè¦æ ¹æ®å®é™…çš„ä¸šåŠ¡åœºæ™¯æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚è¯´ï¼Œå¦‚æœåˆ—è¡¨é•¿åº¦æœªçŸ¥ï¼Œæ·»åŠ ã€åˆ é™¤æ“ä½œæ¯”è¾ƒå¤šï¼Œå°¤å…¶ç»å¸¸ä»ä¸¤ç«¯è¿›è¡Œæ“ä½œï¼Œè€ŒæŒ‰ç…§ç´¢å¼•ä½ç½®è®¿é—®ç›¸å¯¹æ¯”è¾ƒå°‘ï¼Œä½¿ç”¨LinkedListä¼šæœ‰æ›´å¥½çš„æ€§èƒ½ã€‚\n","date":"2023-04-19T14:41:31+08:00","permalink":"https://AndDevMK.github.io/post/java%E9%9B%86%E5%90%88%E7%B3%BB%E5%88%97%E4%B8%80%E6%96%87%E8%A7%A3%E8%AF%BBlinkedlist%E6%BA%90%E7%A0%81jdk11/","section":"post","tags":null,"title":"Javaé›†åˆç³»åˆ—ï¼šä¸€æ–‡è§£è¯»LinkedListæºç ã€ŒJDK11ã€"},{"categories":null,"contents":" æ­¤åšå®¢ä¸»è¦ç”¨æ¥å¯¹æ—¥å¸¸çš„å¼€å‘ç­‰ç›¸å…³çš„å†…å®¹è¿›è¡Œè®°å½•ï¼Œå¦‚æœéœ€è¦è½¬è½½è¯·è¡¨æ˜å‡ºå¤„ã€‚\næ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å· ğŸ‘‡ğŸ‘‡ğŸ‘‡ ","date":"2023-04-16T20:53:15+08:00","permalink":"https://AndDevMK.github.io/about/","section":"","tags":null,"title":"About"},{"categories":["Java"],"contents":"ä¸€ã€æ¦‚è¿° ArrayListæ˜¯ç»å¸¸ç”¨åˆ°çš„ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒæ˜¯Java Collections Frameworkçš„ä¸€ä¸ªæˆå‘˜ï¼Œç„¶ååº•å±‚æ˜¯åŸºäºå®šé•¿æ•°ç»„æ¥å®ç°çš„ï¼Œå¦‚æœæ•°ç»„å­˜æ”¾æ»¡äº†ï¼Œå°±ä¼šé€šè¿‡æ‰©å®¹æœºåˆ¶é‡æ–°ç”Ÿæˆä¸€ä¸ªæ›´å¤§çš„æ•°ç»„æ¥å­˜æ”¾æ•°æ®ã€‚\nå› æ­¤ï¼Œæ‰©å®¹æœºåˆ¶æ˜¯ArrayListçš„æ ¸å¿ƒæ‰€åœ¨ï¼Œè¿™ä¸€ç‚¹æ˜¯åŠ¡å¿…è¦æŒæ¡çš„ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œæœ¬æ–‡è¿˜ä¼šå™è¿°ArrayListçš„åŸºæœ¬æ“ä½œæ˜¯æ€æ ·å®ç°çš„ï¼Œä»¥åŠå…¶å®ƒçš„ç»†èŠ‚ã€‚\näºŒã€ArrayListæºç è§£è¯» 2.1ã€ç»§æ‰¿å…³ç³» ä»UMLç±»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒArrayListç›´æ¥æˆ–é—´æ¥å®ç°äº†Iterableã€Collectionã€Listã€RandomAccessã€Cloneableã€Serializableè¿™6ä¸ªæ¥å£ï¼›ArrayListç›´æ¥æˆ–é—´æ¥ç»§æ‰¿äº†AbstractListã€AbstractCollectionè¿™2ä¸ªæŠ½è±¡ç±»ã€‚\nç–‘é—®æ¥äº†ï¼šä¸ºä»€ä¹ˆAbstractListå®ç°äº†Listæ¥å£ï¼ŒArrayListè¿˜è¦å»å†å®ç°ä¸€æ¬¡Listæ¥å£ï¼Œæ˜¯åƒé¥±äº†æ’‘ç€å—ï¼Ÿ\nå¸¦ç€ç–‘é—®ï¼Œæˆ‘ç«‹é©¬å»ç½‘ä¸Šå†²æµªä¸€æ³¢ï¼Œç„¶åå‘ç°äº†3ä¸ªå¯¹æ­¤çš„è§£é‡Šã€‚\nè§‚ç‚¹1ï¼šå¦‚æœArrayListæ²¡å»å®ç°Listæ¥å£ï¼Œä¼šå¯¼è‡´classçš„getInterfacesæ–¹æ³•è¿”å›ä¸åŒçš„ç»“æœï¼Œè¿™ä¹ˆåšæ˜¯ä¸ºäº†æ–¹ä¾¿åŸºäºListæ¥å£çš„åŠ¨æ€ä»£ç†ã€‚\nè§‚ç‚¹2ï¼šè¿™å¯èƒ½æ˜¯ä¸ºäº†å¢åŠ ç»§æ‰¿ç»“æ„çš„å¯è¿½è¸ªæ€§ã€‚å½“æµè§ˆJavadocæˆ–ç±»ä¼¼çš„ä¸œè¥¿æ—¶ï¼Œå°±ä¸å¿…éå†æ•´ä¸ªç»§æ‰¿æ ‘ï¼Œå®ƒä¸ä¼šæœ‰ä»»ä½•ä¸è‰¯å½±å“ï¼Œå¹¶ä¸”å¯ä»¥å¸®åŠ©ç†è§£ä»£ç ã€‚\nè§‚ç‚¹3ï¼šArrayListçš„ä½œè€…Josh Blochæ›¾ç»è®¤ä¸ºArrayListå†å®ç°ä¸€æ¬¡Listæ¥å£æ˜¯æœ‰ä¸€äº›ä»·å€¼çš„ï¼Œä½†åæ¥å‘ç°è¿™æ˜¯ä¸ªé”™è¯¯ã€‚\nä»¥ä¸Š3ä¸ªè§‚ç‚¹å‡å‡ºè‡ªstackoverflowçš„ä¸€ä¸ªå¸–å­ï¼Œæˆ‘ä»¬äº†è§£ä¸‹å°±å¥½äº†ï¼Œæ·±ç©¶æ„ä¹‰ä¸å¤§ï¼Œå…·ä½“åŸå› è¿˜å¾—æ˜¯ä½œè€…è‡ªå·±æ‰çŸ¥é“ã€‚\n2.1.1ã€Iterableæ¥å£ 2.1.1.1ã€æ¦‚è¿° Iterableè¡¨ç¤ºå¯è¿­ä»£çš„ï¼Œå®ƒæœ‰ä¸ªiteratoræ–¹æ³•ï¼Œéœ€è¦è¿”å›Iteratorå¯¹è±¡ï¼ŒIteratoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¡¨ç¤ºä¸ºè¿­ä»£å™¨ã€‚Iterableæ¥å£çš„å®šä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 public interface Iterable\u0026lt;T\u0026gt; { Iterator\u0026lt;T\u0026gt; iterator(); // .....çœç•¥ } é‚£ä¹ˆå®ç°Iterableæ¥å£æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå…ˆè¯´ç»“è®ºï¼šåªè¦å¯¹è±¡å®ç°äº†Iterableæ¥å£ï¼Œå°±å¯ä»¥ä½¿ç”¨for-eachè¯­æ³•ï¼Œç¼–è¯‘å™¨ä¼šè½¬æ¢ä¸ºè°ƒç”¨Iterableå’ŒIteratoræ¥å£çš„æ–¹æ³•ã€‚\næˆ‘ä»¬å¹³å¸¸ç”¨for-eachè¯­æ³•éå†listæ—¶ï¼Œä½ å¯èƒ½ä¼šå†™ä¸‹å¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 5 6 7 List\u0026lt;Integer\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(3); list.add(1); list.add(2); list.add(3); for (Integer value : list) { System.out.println(\u0026#34;value: \u0026#34; + value); } è¿™ç§for-eachè¯­æ³•èƒŒåæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿå…¶å®ï¼Œç¼–è¯‘å™¨ä¼šå°†å®ƒè½¬æ¢ä¸ºç±»ä¼¼å¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 Iterator\u0026lt;Integer\u0026gt; iterator = list.iterator(); while (iterator.hasNext()){ System.out.println(\u0026#34;value: \u0026#34; + iterator.next()); } é™¤äº†Iterableæ¥å£çš„iteratoræ–¹æ³•å¤–ï¼ŒListæ¥å£ä¹Ÿæœ‰ä¸€ä¸ªlistIteratoræ–¹æ³•ï¼Œéœ€è¦è¿”å›ListIteratorå¯¹è±¡ï¼ŒListIteratoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå¯¹Iteratoræ¥å£åšäº†æ‰©å±•ã€‚æ¯”å¦‚ï¼Œå¯ä»¥ä»æœ«å°¾å¾€å‰éå†ï¼Œå¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 ListIterator\u0026lt;Integer\u0026gt; iterator = list.listIterator(list.size()); while (iterator.hasPrevious()){ System.out.println(\u0026#34;value: \u0026#34; + iterator.previous()); } 2.1.1.2ã€fail-fastæœºåˆ¶ é‚£äº›å¹´ï¼Œå¹´å°‘æ—¶æ‰€çŠ¯ä¸‹çš„é”™è¯¯ï¼Œæƒ³èµ·è‡ªå·±åˆšå…¥é—¨Javaæ—¶ï¼Œæ›¾ç»å†™è¿‡å¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 5 for (Integer value : list) { if (value \u0026lt; 3) { list.remove(value); } } å½“å¹´çš„ç›´è§‰å‘Šè¯‰ä½ ï¼Œè¿™ä¹ˆå†™ä¸å­˜åœ¨é—®é¢˜ï¼Œä½†æ˜¯è¿è¡Œå´ä¼šæŠ¥å¹¶å‘ä¿®æ”¹çš„é”™è¯¯ï¼š\n1 Exception in thread \u0026#34;main\u0026#34; java.util.ConcurrentModificationException æ˜¾ç„¶ï¼Œè¿™é‡Œæ˜¯æ²¡æœ‰å¹¶å‘çš„ä»£ç ï¼Œæˆ‘ä»¬å»çœ‹çœ‹ConcurrentModificationExceptionçš„æ³¨é‡Šæè¿°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 /** * å½“ä¸å…è®¸è¿›è¡Œæ­¤ç±»ä¿®æ”¹æ—¶ï¼Œå·²æ£€æµ‹åˆ°å¯¹è±¡çš„å¹¶å‘ä¿®æ”¹çš„æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ * This exception may be thrown by methods that have detected concurrent * modification of an object when such modification is not permissible. * \u0026lt;p\u0026gt; * ä¾‹å¦‚ï¼Œé€šå¸¸ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹åœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¿­ä»£é›†åˆæ—¶ä¿®æ”¹é›†åˆã€‚ * For example, it is not generally permissible for one thread to modify a Collection * while another thread is iterating over it. * é€šå¸¸ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹è¿­ä»£çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚ * In general, the results of the iteration are undefined under these circumstances. * å¦‚æœæ£€æµ‹åˆ°æ­¤è¡Œä¸ºï¼ŒæŸäº› Iterator å®ç°ï¼ˆåŒ…æ‹¬ JRE æä¾›çš„æ‰€æœ‰é€šç”¨é›†åˆå®ç°ï¼‰å¯èƒ½ä¼šé€‰æ‹©æŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ * Some Iterator implementations (including those of all the general purpose collection implementations * provided by the JRE) may choose to throw this exception if this behavior is * detected. * æ‰§è¡Œæ­¤æ“ä½œçš„è¿­ä»£å™¨è¢«ç§°ä¸ºfail-fastè¿­ä»£å™¨ï¼Œå› ä¸ºå®ƒä»¬å¿«é€Ÿè€Œå¹²å‡€åœ°å¤±è´¥ï¼Œè€Œä¸æ˜¯å†’ç€åœ¨æœªæ¥ä¸ç¡®å®šçš„æ—¶é—´å‡ºç°ä»»æ„çš„ã€ä¸ç¡®å®šçš„è¡Œä¸ºçš„é£é™©ã€‚ * Iterators that do this are known as \u0026lt;i\u0026gt;fail-fast\u0026lt;/i\u0026gt; iterators, * as they fail quickly and cleanly, rather that risking arbitrary, * non-deterministic behavior at an undetermined time in the future. * \u0026lt;p\u0026gt; * è¯·æ³¨æ„ï¼Œæ­¤å¼‚å¸¸å¹¶ä¸æ€»æ˜¯è¡¨ç¤ºå¯¹è±¡å·²è¢«ä¸åŒçš„çº¿ç¨‹å¹¶å‘ä¿®æ”¹ã€‚ * Note that this exception does not always indicate that an object has * been concurrently modified by a \u0026lt;i\u0026gt;different\u0026lt;/i\u0026gt; thread. * å¦‚æœå•ä¸ªçº¿ç¨‹å‘å‡ºä¸€ç³»åˆ—è¿åå¯¹è±¡å¥‘çº¦çš„æ–¹æ³•è°ƒç”¨ï¼Œåˆ™è¯¥å¯¹è±¡å¯èƒ½ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ * If a single thread issues a sequence of method invocations that violates the * contract of an object, the object may throw this exception. * ä¾‹å¦‚ï¼Œå¦‚æœçº¿ç¨‹åœ¨ä½¿ç”¨fail-fastè¿­ä»£å™¨è¿­ä»£é›†åˆæ—¶ç›´æ¥ä¿®æ”¹é›†åˆï¼Œåˆ™è¿­ä»£å™¨å°†æŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ * For example, if a thread modifies a collection directly while it is * iterating over the collection with a fail-fast iterator, the iterator * will throw this exception. * è¯·æ³¨æ„ï¼Œä¸èƒ½ä¿è¯fail-fastè¡Œä¸ºï¼Œå› ä¸ºä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å­˜åœ¨éåŒæ­¥å¹¶å‘ä¿®æ”¹çš„æƒ…å†µä¸‹ä¸å¯èƒ½åšå‡ºä»»ä½•ç¡¬æ€§ä¿è¯ã€‚ * \u0026lt;p\u0026gt;Note that fail-fast behavior cannot be guaranteed as it is, generally * speaking, impossible to make any hard guarantees in the presence of * unsynchronized concurrent modification. * ail-fastæ“ä½œä¼šå°½æœ€å¤§åŠªåŠ›æŠ›å‡ºConcurrentModificationExceptionã€‚ * Fail-fast operations throw {@code ConcurrentModificationException} on a best-effort basis. * å› æ­¤ï¼Œç¼–å†™ä¾èµ–äºæ­¤å¼‚å¸¸çš„æ­£ç¡®æ€§çš„ç¨‹åºæ˜¯é”™è¯¯çš„ï¼š ConcurrentModificationExceptionåº”è¯¥ä»…ç”¨äºæ£€æµ‹é”™è¯¯ã€‚ * Therefore, it would be wrong to write a program that depended on this * exception for its correctness: \u0026lt;i\u0026gt;{@code ConcurrentModificationException} * should be used only to detect bugs.\u0026lt;/i\u0026gt; * * @author Josh Bloch * @see Collection * @see Iterator * @see Spliterator * @see ListIterator * @see Vector * @see LinkedList * @see HashSet * @see Hashtable * @see TreeMap * @see AbstractList * @since 1.2 */ ä¸Šé¢çš„æ³¨é‡Šè¯´çš„å¾ˆæ˜æ˜¾äº†ï¼Œå¦‚æœçº¿ç¨‹åœ¨ä½¿ç”¨fail-fastè¿­ä»£å™¨è¿­ä»£é›†åˆæ—¶ç›´æ¥ä¿®æ”¹é›†åˆï¼Œåˆ™è¿­ä»£å™¨å°†æŠ›å‡ºæ­¤å¼‚å¸¸ã€‚\né‚£ä¹ˆå¦‚ä½•é¿å…å¼‚å¸¸å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨çš„removeæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n1 2 3 4 5 6 Iterator\u0026lt;Integer\u0026gt; iterator = list.iterator(); while (iterator.hasNext()) { if (iterator.next() \u0026lt; 3) { iterator.remove(); } } å®ƒè‡ªå·±çš„removeæ–¹æ³•ä¸ºä½•åˆå¯ä»¥ä½¿ç”¨å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦çœ‹ä¸‹è¿­ä»£å™¨çš„åŸç†äº†ã€‚\n2.1.1.3ã€è¿­ä»£å™¨çš„åŸç† æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ArrayListä¸­iteratoræ–¹æ³•çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 public class ArrayList\u0026lt;E\u0026gt; extends AbstractList\u0026lt;E\u0026gt; implements List\u0026lt;E\u0026gt;, RandomAccess, Cloneable, java.io.Serializable { public Iterator\u0026lt;E\u0026gt; iterator() { return new Itr(); } } iteratoræ–¹æ³•å®ç°å¾ˆç®€å•ï¼Œç›´æ¥newä¸€ä¸ªItrå¯¹è±¡è¿”å›ï¼ŒItræ˜¯ArrayListçš„ä¸€ä¸ªæˆå‘˜å†…éƒ¨ç±»ï¼Œå®ç°äº†Iteratoræ¥å£ï¼Œå®ƒçš„ä»£ç é‡å¹¶ä¸å¤šï¼Œæ‰€ä»¥ç›´æ¥è´´å‡ºæ¥äº†ï¼Œçœ‹æ³¨é‡Šåº”è¯¥å°±èƒ½æ˜ç™½ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 private class Itr implements Iterator\u0026lt;E\u0026gt; { int cursor; // index of next element to return ä¸‹ä¸€ä¸ªè¦è¿”å›çš„å…ƒç´ ä½ç½® int lastRet = -1; // index of last element returned; -1 if no such æœ€åä¸€ä¸ªè¿”å›çš„ç´¢å¼•ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¸º-1 int expectedModCount = modCount; // æœŸæœ›çš„ä¿®æ”¹æ¬¡æ•°ï¼Œåˆå§‹åŒ–ä¸ºå¤–éƒ¨ç±»å½“å‰çš„ä¿®æ”¹æ¬¡æ•°modCount // prevent creating a synthetic constructor Itr() {} public boolean hasNext() { return cursor != size; // cursorä¸æ•°ç»„å…ƒç´ æ•°é‡çš„æ¯”è¾ƒ } @SuppressWarnings(\u0026#34;unchecked\u0026#34;) public E next() { // æ ¡éªŒæ˜¯å¦å‘ç”Ÿäº†ç»“æ„æ€§å˜åŒ– checkForComodification(); int i = cursor; if (i \u0026gt;= size) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; if (i \u0026gt;= elementData.length) throw new ConcurrentModificationException(); // æ›´æ–°cursorçš„å€¼ï¼Œæ¯æ¬¡+1 cursor = i + 1; // æ›´æ–°lastRetå€¼ï¼Œè¿”å›å¯¹åº”çš„å…ƒç´  return (E) elementData[lastRet = i]; } public void remove() { // æ³¨æ„ï¼šlastRet \u0026lt; 0æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥è°ƒç”¨remove()ä¹‹å‰éœ€è¦å…ˆè°ƒç”¨next()å»æ›´æ–°lastRetçš„å€¼ if (lastRet \u0026lt; 0) throw new IllegalStateException(); // æ ¡éªŒæ˜¯å¦å‘ç”Ÿäº†ç»“æ„æ€§å˜åŒ– checkForComodification(); try { // æ‰§è¡ŒArrayListçš„removeæ–¹æ³•ï¼ŒmodCount++ ArrayList.this.remove(lastRet); // æ›´æ–°cursorçš„å€¼ï¼Œremoveåå…ƒç´ æ•°é‡å°‘äº†ä¸€ä¸ªï¼Œç›¸å½“äºcursor=cursor-1 cursor = lastRet; // é‡ç½®lastRet lastRet = -1; // æ›´æ–°expectedModCount expectedModCount = modCount; } catch (IndexOutOfBoundsException ex) { throw new ConcurrentModificationException(); } } // æ ¡éªŒæ˜¯å¦å‘ç”Ÿäº†ç»“æ„æ€§å˜åŒ–ï¼Œæ‰€è°“ç»“æ„æ€§å˜åŒ–å°±æ˜¯æ·»åŠ ã€æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œåªæ˜¯ä¿®æ”¹å…ƒç´ å†…å®¹ä¸ç®—ç»“æ„æ€§å˜åŒ–ã€‚ final void checkForComodification() { if (modCount != expectedModCount) throw new ConcurrentModificationException(); } } è¿­ä»£å™¨æºç ä¸­nextæ–¹æ³•ï¼Œremoveæ–¹æ³•éƒ½ä¼šè°ƒç”¨checkForComodificationæ–¹æ³•è¿›è¡Œæ ¡éªŒæ˜¯å¦å‘ç”Ÿäº†ç»“æ„æ€§å˜åŒ–ï¼Œç”±æ­¤å¯è§ï¼Œè¿­ä»£å™¨çš„å†…éƒ¨ç»´æŠ¤äº†ç´¢å¼•ä½ç½®ç›¸å…³çš„æ•°æ®ï¼Œè¦æ±‚åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œä¸èƒ½å‘ç”Ÿç»“æ„æ€§å˜åŒ–ï¼Œå¦åˆ™è¿™äº›ç´¢å¼•ä½ç½®åŠŸèƒ½å°±ä¼šå¤±æ•ˆã€‚\n2.1.2ã€RandomAccessæ¥å£ RandomAccesså†…éƒ¨æ˜¯æ²¡æœ‰ä»»ä½•ä»£ç çš„æ¥å£ï¼Œå®ƒå±äºæ ‡è®°æ¥å£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š\n1 2 public interface RandomAccess { } å®ç°äº†RandomAccessæ¥å£çš„ç±»è¡¨ç¤ºæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œç”¨åœ¨ä¸€äº›é€šç”¨çš„ç®—æ³•ä»£ç ä¸­ï¼Œå®ƒå¯ä»¥æ ¹æ®è¿™ä¸ªå£°æ˜è€Œé€‰æ‹©æ•ˆç‡æ›´é«˜çš„å®ç°ï¼Œæ¯”å¦‚Collectionsç±»çš„binarySearchæ–¹æ³•ï¼Œä¼šæ ¹æ®Listæ˜¯å¦å®ç°äº†RandomAccessæ¥å£è€Œé‡‡ç”¨ä¸åŒçš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 public static \u0026lt;T\u0026gt; int binarySearch(List\u0026lt;? extends Comparable\u0026lt;? super T\u0026gt;\u0026gt; list, T key) { if (list instanceof RandomAccess || list.size()\u0026lt;BINARYSEARCH_THRESHOLD) return Collections.indexedBinarySearch(list, key); else return Collections.iteratorBinarySearch(list, key); } 2.2ã€æˆå‘˜å˜é‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // é»˜è®¤åˆå§‹å®¹é‡ private static final int DEFAULT_CAPACITY = 10; // ç”¨äºç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ private static final Object[] EMPTY_ELEMENTDATA = {}; // ç”¨äºé»˜è®¤å¤§å°çš„ç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ã€‚æ³¨æ„ï¼šè¦å°†å®ƒä¸EMPTY_ELEMENTDATAåŒºåˆ†å¼€æ¥ï¼Œä»¥äº†è§£æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶è¦è†¨èƒ€å¤šå°‘ // å¯ä»¥ç†è§£ä¸ºæ ‡è®°è°ƒç©ºå‚æ•°æ„é€ æ–¹æ³• private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; // å­˜å‚¨ArrayListå…ƒç´ çš„æ•°ç»„ç¼“å†²åŒºã€‚ArrayListçš„å®¹é‡å°±æ˜¯è¿™ä¸ªæ•°ç»„ç¼“å†²åŒºçš„é•¿åº¦ã€‚æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä»»ä½•å…·æœ‰ elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA çš„ç©º ArrayList éƒ½å°†æ‰©å±•ä¸º DEFAULT_CAPACITYã€‚ transient Object[] elementData; // ArrayListçš„å¤§å°ï¼ˆå®ƒåŒ…å«çš„å…ƒç´ æ•°ï¼‰ private int size; // è¦åˆ†é…çš„æ•°ç»„çš„æœ€å¤§å¤§å°ï¼ˆé™¤éå¿…è¦ï¼‰ private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; // æ­¤åˆ—è¡¨åœ¨ç»“æ„ä¸Šè¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚ç»“æ„ä¿®æ”¹æ˜¯é‚£äº›æ”¹å˜åˆ—è¡¨å¤§å°çš„ä¿®æ”¹ï¼Œæˆ–è€…ä»¥å…¶ä»–æ–¹å¼æ‰°ä¹±åˆ—è¡¨ï¼Œä½¿å¾—æ­£åœ¨è¿›è¡Œçš„è¿­ä»£å¯èƒ½ä¼šäº§ç”Ÿä¸æ­£ç¡®çš„ç»“æœã€‚ protected transient int modCount = 0; ç–‘é—®æ¥äº†ï¼šæˆ‘ä»¬çŸ¥é“äº†ArrayListå®ç°äº†Serializableæ¥å£ï¼Œä½†æ˜¯elementDataä¸ºä½•è¦ç”¨transientä¿®é¥°ï¼Œè¿™ä¸è¡¨ç¤ºelementDataä¸èƒ½è¢«åºåˆ—åŒ–ï¼Ÿ\nå…¶å®ç„æœºåœ¨äºArrayListä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // å°†ArrayListå®ä¾‹çš„çŠ¶æ€ä¿å­˜åˆ°æµä¸­ï¼ˆå³åºåˆ—åŒ–å®ƒï¼‰ã€‚ private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException { // Write out element count, and any hidden stuff int expectedModCount = modCount; s.defaultWriteObject(); // Write out size as capacity for behavioral compatibility with clone() s.writeInt(size); // Write out all elements in the proper order. for (int i = 0; i \u0026lt; size; i++) { s.writeObject(elementData[i]); } if (modCount != expectedModCount) { throw new ConcurrentModificationException(); } } // ä»æµä¸­é‡æ„ArrayListå®ä¾‹ï¼ˆå³ååºåˆ—åŒ–ï¼‰ private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException { // Read in size, and any hidden stuff s.defaultReadObject(); // Read in capacity s.readInt(); // ignored if (size \u0026gt; 0) { // like clone(), allocate array based upon size not capacity SharedSecrets.getJavaObjectInputStreamAccess().checkArray(s, Object[].class, size); Object[] elements = new Object[size]; // Read in all elements in the proper order. for (int i = 0; i \u0026lt; size; i++) { elements[i] = s.readObject(); } elementData = elements; } else if (size == 0) { elementData = EMPTY_ELEMENTDATA; } else { throw new java.io.InvalidObjectException(\u0026#34;Invalid size: \u0026#34; + size); } } ArrayListåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨writeObjectæ–¹æ³•ï¼Œç›´æ¥å°†sizeå’Œelementå†™å…¥ObjectOutputStreamï¼›ååºåˆ—åŒ–æ—¶è°ƒç”¨readObjectæ–¹æ³•ï¼Œä»ObjectInputStreamè·å–sizeå’Œelementï¼Œå†æ¢å¤åˆ°elementDataã€‚\nelementDataæ˜¯å­˜å‚¨ArrayListå…ƒç´ çš„æ•°ç»„ç¼“å†²åŒºï¼Œé€šå¸¸æ‰©å®¹åéƒ½ä¼šé¢„ç•™ä¸€äº›ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰éƒ¨åˆ†ç©ºé—´å®é™…æ²¡æœ‰å­˜å‚¨å…ƒç´ ï¼Œåºåˆ—åŒ–æ—¶åªåºåˆ—åŒ–å®é™…å­˜å‚¨çš„é‚£äº›å…ƒç´ ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°ç»„ï¼Œä»è€Œå¯ä»¥èŠ‚çœç©ºé—´å’Œæ—¶é—´ã€‚\nç–‘é—®æ¥äº†ï¼šä¸ºä»€ä¹ˆMAX_ARRAY_SIZEçš„å€¼æ˜¯Integer.MAX_VALUE - 8è€Œä¸æ˜¯Integer.MAX_VALUEï¼Ÿ\nå› ä¸ºå­˜å‚¨äº†Arrayçš„å¤´éƒ¨ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å‡å»8ã€‚\n2.3ã€æ„é€ æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // ç©ºå‚æ„é€ æ–¹æ³• public ArrayList() { // ç”±äºæ²¡æœ‰æŒ‡å®šåˆå§‹å®¹é‡ï¼Œæ‰€ä»¥èµ‹å€¼ä¸€ä¸ªç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ï¼Œå¯ä»¥ç†è§£ä¸ºæ ‡è®°è°ƒç©ºå‚æ•°æ„é€ æ–¹æ³• this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; } // æŒ‡å®šäº†åˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³• public ArrayList(int initialCapacity) { if (initialCapacity \u0026gt; 0) { // åˆ›å»ºæŒ‡å®šå¤§å°çš„Objectæ•°ç»„ this.elementData = new Object[initialCapacity]; } else if (initialCapacity == 0) { // è¿™é‡Œå•çº¯å°±æ˜¯å…ƒç´ ä¸ªæ•°ä¸º0åï¼Œèµ‹å€¼ä¸€ä¸ªç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ this.elementData = EMPTY_ELEMENTDATA; } else { throw new IllegalArgumentException(\u0026#34;Illegal Capacity: \u0026#34;+ initialCapacity); } } public ArrayList(Collection\u0026lt;? extends E\u0026gt; c) { // c.toArray()åº•å±‚å®é™…è°ƒç”¨çš„ä¹Ÿæ˜¯Arrays.copyOf()ï¼Œæ ¹æ®é›†åˆcçš„é•¿åº¦åˆ›å»ºä¸€ä¸ªObject[]æ–°æ•°ç»„ï¼ŒæŠŠæ•°æ®æ‹·è´åˆ°æ–°æ•°ç»„ä¸Š elementData = c.toArray(); if ((size = elementData.length) != 0) { // é‡å¤è°ƒç”¨Arrays.copyOf()æ˜¯ä¸ºäº†é˜²æ­¢c.toArray()ä¸è¿”å›Object[] // defend against c.toArray (incorrectly) not returning Object[] // (see e.g. https://bugs.openjdk.java.net/browse/JDK-6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, size, Object[].class); } else { // replace with empty array. // è¿™é‡Œå•çº¯å°±æ˜¯å…ƒç´ ä¸ªæ•°ä¸º0åï¼Œèµ‹å€¼ä¸€ä¸ªç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ this.elementData = EMPTY_ELEMENTDATA; } } 2.4ã€æ ¸å¿ƒæ–¹æ³• 2.4.1ã€addæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // å°†æŒ‡å®šçš„å…ƒç´ é™„åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ public boolean add(E e) { // æ­¤åˆ—è¡¨åœ¨ç»“æ„ä¸Šè¢«ä¿®æ”¹çš„æ¬¡æ•° modCount++; add(e, elementData, size); return true; } private void add(E e, Object[] elementData, int s) { // æ•°ç»„å®¹é‡æ»¡äº†ï¼Œæ‰§è¡Œæ‰©å®¹æœºåˆ¶ if (s == elementData.length) // å¾—åˆ°ä¸€ä¸ªæ‰©å®¹åçš„æ–°æ•°ç»„ elementData = grow(); // sizeä½ç½®æ’å…¥å…ƒç´  elementData[s] = e; // æ›´æ–°sizeå¤§å°ï¼šåŸå…ƒç´ ä¸ªæ•°å¤§å°+1 size = s + 1; } // åœ¨æ­¤åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šå…ƒç´  public void add(int index, E element) { // æ ¡éªŒindexçš„èŒƒå›´ rangeCheckForAdd(index); modCount++; // å½“å‰å…ƒç´ ä¸ªæ•°å¤§å° final int s; Object[] elementData; // æ•°ç»„å®¹é‡æ»¡äº†ï¼Œæ‰§è¡Œæ‰©å®¹æœºåˆ¶ if ((s = size) == (elementData = this.elementData).length) // å¾—åˆ°ä¸€ä¸ªæ‰©å®¹åçš„æ–°æ•°ç»„ elementData = grow(); // å°†å½“å‰ä½äºè¯¥ä½ç½®çš„å…ƒç´ ï¼ˆå¦‚æœæœ‰ï¼‰å’Œä»»ä½•åç»­å…ƒç´ å‘å³ç§»åŠ¨ï¼ˆå°†å…¶ç´¢å¼•åŠ ä¸€ï¼‰ã€‚ System.arraycopy(elementData, index, elementData, index + 1, s - index); // ç§»åŠ¨åï¼Œindexä½ç½®ç©ºä½™å‡ºæ¥ï¼Œå³å¯å°†elementæ’å…¥åˆ°indexä½ç½® elementData[index] = element; // æ›´æ–°sizeå¤§å°ï¼šåŸå…ƒç´ ä¸ªæ•°å¤§å°+1 size = s + 1; } // å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ public boolean addAll(Collection\u0026lt;? extends E\u0026gt; c) { // c.toArray()åº•å±‚å®é™…è°ƒç”¨çš„ä¹Ÿæ˜¯Arrays.copyOf()ï¼Œæ ¹æ®é›†åˆcçš„é•¿åº¦åˆ›å»ºä¸€ä¸ªObject[]æ–°æ•°ç»„ï¼ŒæŠŠæ•°æ®æ‹·è´åˆ°æ–°æ•°ç»„ä¸Š Object[] a = c.toArray(); modCount++; int numNew = a.length; if (numNew == 0) return false; Object[] elementData; final int s; // åŸæ•°ç»„çš„å‰©ä½™å®¹é‡ä¸å¤Ÿæ’å…¥æ•°ç»„çš„å¤§å°æ—¶ï¼Œå°±è¿›è¡Œæ‰©å®¹ if (numNew \u0026gt; (elementData = this.elementData).length - (s = size)) // å¾—åˆ°ä¸€ä¸ªæ‰©å®¹åçš„æ–°æ•°ç»„ elementData = grow(s + numNew); // å°†æ’å…¥æ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ‰©å®¹æ•°ç»„ä¸Š System.arraycopy(a, 0, elementData, s, numNew); // æ›´æ–°sizeå¤§å°ï¼šåŸå…ƒç´ ä¸ªæ•°å¤§å°+æ’å…¥æ•°ç»„çš„é•¿åº¦ size = s + numNew; return true; } å…³äºaddæ–¹æ³•ï¼Œå¦‚æœæ˜¯æœ«å°¾æ’å…¥ï¼Œé‚£ä¹ˆå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›å¦‚æœæ˜¯éæœ«å°¾æ’å…¥ï¼Œå› ä¸ºéœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œé‚£ä¹ˆå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…åœ¨å¤§æ•°æ®é‡ä¸­è°ƒç”¨addå¸¦ç´¢å¼•å‚æ•°çš„æ–¹æ³•ã€‚\n2.4.2ã€growæ–¹æ³•ï¼ˆæ‰©å®¹æœºåˆ¶ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 private Object[] grow() { return grow(size + 1); } // å¢åŠ å®¹é‡ä»¥ç¡®ä¿å®ƒè‡³å°‘å¯ä»¥å®¹çº³æœ€å°å®¹é‡å‚æ•°æŒ‡å®šçš„å…ƒç´ æ•° private Object[] grow(int minCapacity) { // minCapacity = size + 1 // å…ˆè®¡ç®—æ–°å®¹é‡å¤§å°ï¼Œå†æ ¹æ®æ–°å®¹é‡å¤§å°åˆ›å»ºä¸€ä¸ªObject[]æ–°æ•°ç»„ï¼ŒæŠŠæ•°æ®æ‹·è´åˆ°æ–°æ•°ç»„ä¸Š return elementData = Arrays.copyOf(elementData, newCapacity(minCapacity)); } // è¿”å›è‡³å°‘ä¸ç»™å®šæœ€å°å®¹é‡ä¸€æ ·å¤§çš„å®¹é‡ã€‚å¦‚æœè¶³å¤Ÿï¼Œè¿”å›å¢åŠ  50% çš„å½“å‰å®¹é‡ã€‚é™¤éç»™å®šçš„æœ€å°å®¹é‡å¤§äº MAX_ARRAY_SIZEï¼Œå¦åˆ™ä¸ä¼šè¿”å›å¤§äº MAX_ARRAY_SIZE çš„å®¹é‡ã€‚ private int newCapacity(int minCapacity) { // overflow-conscious code // æ—§å®¹é‡ = åŸæ•°ç»„çš„é•¿åº¦ int oldCapacity = elementData.length; // æ–°å®¹é‡ = æ—§å®¹é‡ + æ—§å®¹é‡å³ç§»ä¸€ä½ï¼ˆç›¸å½“äºé™¤äº2ï¼‰ int newCapacity = oldCapacity + (oldCapacity \u0026gt;\u0026gt; 1); if (newCapacity - minCapacity \u0026lt;= 0) { // å¦‚æœæ˜¯è°ƒç”¨äº†æ— å‚æ•°æ„é€ æ–¹æ³•ï¼Œæ²¡æœ‰æŒ‡å®šåˆå§‹å®¹é‡æ—¶ if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) // é»˜è®¤åˆå§‹å®¹é‡å°±ä¸º10 return Math.max(DEFAULT_CAPACITY, minCapacity); if (minCapacity \u0026lt; 0) // overflow throw new OutOfMemoryError(); // å…¶å®ƒæƒ…å†µä¸€å¾‹size + 1 return minCapacity; } // å¦‚æœè¿˜æ²¡è¾¾åˆ°æœ€å¤§å®¹é‡ï¼Œé‚£å°±æ˜¯æ–°å®¹é‡å¤§å°ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªè¿”å›ä¸€ä¸ªå·¨å¤§çš„å®¹é‡ return (newCapacity - MAX_ARRAY_SIZE \u0026lt;= 0) ? newCapacity : hugeCapacity(minCapacity); } private static int hugeCapacity(int minCapacity) { if (minCapacity \u0026lt; 0) // overflow throw new OutOfMemoryError(); // size+1 \u0026gt; MAX_ARRAY_SIZEæ—¶ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªå·¨å¤§çš„å®¹é‡Integer.MAX_VALUEï¼Œå¦åˆ™MAX_ARRAY_SIZE return (minCapacity \u0026gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; } 2.4.3ã€removeæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 // ç§»é™¤æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´  public E remove(int index) { // æ ¡éªŒindexçš„èŒƒå›´ Objects.checkIndex(index, size); final Object[] es = elementData; // å–å‡ºè¦ç§»é™¤çš„å…ƒç´  @SuppressWarnings(\u0026#34;unchecked\u0026#34;) E oldValue = (E) es[index]; // åˆ é™¤å…ƒç´  fastRemove(es, index); // è¿”å›è¦ç§»é™¤çš„å…ƒç´  return oldValue; } // è·³è¿‡è¾¹ç•Œæ£€æŸ¥å¹¶ä¸”ä¸è¿”å›åˆ é™¤çš„å€¼çš„ç§æœ‰åˆ é™¤æ–¹æ³• private void fastRemove(Object[] es, int i) { modCount++; final int newSize; // å¦‚æœåˆ é™¤çš„å…ƒç´ ç´¢å¼•ä½ç½®éæœ€åä¸€ä¸ªå…ƒç´ ä½ç½®ï¼Œé‚£ä¹ˆå°†å½“å‰ä½äºè¯¥ä½ç½®çš„å…ƒç´ ï¼ˆå¦‚æœæœ‰ï¼‰å’Œä»»ä½•åç»­å…ƒç´ å‘å·¦ç§»åŠ¨ï¼ˆå°†å…¶ç´¢å¼•å‡ä¸€ï¼‰ã€‚ if ((newSize = size - 1) \u0026gt; i) System.arraycopy(es, i + 1, es, i, newSize - i); // ç§»åŠ¨åŸsize-1ä½ç½®å¤šä½™äº†ï¼Œéœ€è¦ç½®null es[size = newSize] = null; } // ä»æ­¤åˆ—è¡¨ä¸­ç§»é™¤ç¬¬ä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™å®ƒä¸å˜ã€‚ public boolean remove(Object o) { final Object[] es = elementData; final int size = this.size; int i = 0; // ä½¿ç”¨äº†java labelè¯­æ³• found: { // å¦‚æœä¼ å…¥nullï¼Œé‚£ä¹ˆéå†å»æŸ¥çœ‹æ˜¯å¦å­˜åœ¨nullçš„å…ƒç´ ï¼Œæ‰¾åˆ°å°±è·³å‡ºå¾ªç¯ if (o == null) { for (; i \u0026lt; size; i++) if (es[i] == null) break found; } else { // å¦‚æœä¼ å…¥ä¸ä¸ºnullï¼Œé‚£ä¹ˆéå†å»æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ç›¸åŒçš„å…ƒç´ ï¼Œæ‰¾åˆ°å°±è·³å‡ºå¾ªç¯ for (; i \u0026lt; size; i++) if (o.equals(es[i])) break found; } // ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ä¸‹éƒ½æ‰¾ä¸åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œåˆ™è¿”å›false return false; } // æ‰¾åˆ°è¦åˆ é™¤çš„å…ƒç´ åæ‰§è¡Œåˆ é™¤ fastRemove(es, i); return true; } 2.4.4ã€setæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // ç”¨æŒ‡å®šå…ƒç´ æ›¿æ¢æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´  public E set(int index, E element) { // æ ¡éªŒindexçš„èŒƒå›´ Objects.checkIndex(index, size); // è·å–ç´¢å¼•ä½ç½®å¯¹åº”çš„å…ƒç´  E oldValue = elementData(index); // è®¾ç½®ç´¢å¼•ä½ç½®å¯¹åº”çš„å…ƒç´  elementData[index] = element; // è¿”å›è¦ä¿®æ”¹çš„å…ƒç´  return oldValue; } // è¿”å›ç´¢å¼•ä½ç½®å¯¹åº”çš„å…ƒç´  E elementData(int index) { return (E) elementData[index]; } 2.4.5ã€getæ–¹æ³• 1 2 3 4 5 6 7 // è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´  public E get(int index) { // æ ¡éªŒindexçš„èŒƒå›´ Objects.checkIndex(index, size); // è¿”å›ç´¢å¼•ä½ç½®å¯¹åº”çš„å…ƒç´  return elementData(index); } 2.5ã€å…¶å®ƒæ–¹æ³• 2.5.1ã€ensureCapacityæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 // å¦‚æœ‰å¿…è¦ï¼Œå¢åŠ æ­¤ArrayListå®ä¾‹çš„å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒè‡³å°‘å¯ä»¥å®¹çº³æœ€å°å®¹é‡å‚æ•°æŒ‡å®šçš„å…ƒç´ æ•°ã€‚ // ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨åœºæ™¯æ˜¯å¦‚æœå·²ç»é¢„çŸ¥ArrayListéœ€è¦æ¯”è¾ƒå¤§çš„å®¹é‡ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å‡å°‘ArrayListå†…éƒ¨åˆ†é…å’Œæ‰©å±•çš„æ¬¡æ•° public void ensureCapacity(int minCapacity) { // æœ€å°å®¹é‡ä¸å¾—ä½äºåŸæ•°ç»„çš„é•¿åº¦ï¼ŒåŒæ—¶åŸæ•°ç»„ä¸æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ç©ºå‚æ•°æ„é€ æ–¹æ³•å’Œç¬¬ä¸€æ¬¡æ‰©å®¹ if (minCapacity \u0026gt; elementData.length \u0026amp;\u0026amp; !(elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA \u0026amp;\u0026amp; minCapacity \u0026lt;= DEFAULT_CAPACITY)) { modCount++; // è¿›è¡Œæ‰©å®¹ grow(minCapacity); } } 2.5.2ã€trimToSizeæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 // å°†æ­¤ArrayListå®ä¾‹çš„å®¹é‡ä¿®å‰ªä¸ºåˆ—è¡¨çš„å½“å‰å¤§å°ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ­¤æ“ä½œæ¥æœ€å°åŒ–ArrayListå®ä¾‹çš„å­˜å‚¨ public void trimToSize() { modCount++; // æ•°ç»„å®¹é‡æ²¡è£…æ»¡å…ƒç´  if (size \u0026lt; elementData.length) { // å¦‚æœå…ƒç´ ä¸ªæ•°ä¸º0ï¼Œé‚£ä¹ˆèµ‹å€¼ä¸€ä¸ªç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ elementData = (size == 0) ? EMPTY_ELEMENTDATA // å¦åˆ™æ‹·è´å…ƒç´ åˆ°æ–°æ•°ç»„ä¸Šï¼Œæ–°æ•°ç»„çš„å¤§å°å°±æ˜¯å…ƒç´ ä¸ªæ•°çš„æ•°é‡ : Arrays.copyOf(elementData, size); } } ä¸‰ã€æ€»ç»“ åœ¨ArrayListçš„æºç ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸å¹¶å‘ç›¸å…³çš„ä»£ç ï¼Œæ‰€ä»¥è¯´ArrayListæ˜¯éçº¿ç¨‹å®‰å…¨ç±»ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œï¼Œä¼šå¼•å‘ä¸å¯é¢„çŸ¥çš„é”™è¯¯ã€‚åº”è¯¥ä½¿ç”¨Collections.synchronizedListæ–¹æ³•åŒ…è£…åˆ—è¡¨ï¼Œæœ€å¥½åœ¨åˆ›å»ºæ—¶å®Œæˆï¼Œå¦‚ä¸‹ä»£ç ï¼š\n1 List list = Collections.synchronizedList(new ArrayList(...)); å¦å¤–ï¼ŒArrayListæ˜¯ç»å¸¸ç”¨åˆ°çš„ä¸€ä¸ªå®¹å™¨ï¼Œè¦æ ¹æ®å®é™…çš„ä¸šåŠ¡åœºæ™¯æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚è¯´ï¼Œå½“æ·»åŠ ã€åˆ é™¤æ•°æ®ä¸æ˜¯åœ¨å‰é¢æˆ–ä¸­é—´ï¼Œå¹¶ä¸”éœ€è¦éšæœºåœ°è®¿é—®å…¶ä¸­çš„å…ƒç´ æ—¶ï¼Œä½¿ç”¨ArrayListä¼šæœ‰æ›´å¥½çš„æ€§èƒ½ã€‚\n","date":"2023-04-16T14:41:31+08:00","permalink":"https://AndDevMK.github.io/post/java%E9%9B%86%E5%90%88%E7%B3%BB%E5%88%97%E4%B8%80%E6%96%87%E8%A7%A3%E8%AF%BBarraylist%E6%BA%90%E7%A0%81jdk11/","section":"post","tags":null,"title":"Javaé›†åˆç³»åˆ—ï¼šä¸€æ–‡è§£è¯»ArrayListæºç ã€ŒJDK11ã€"}]