<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Android事件分发机制 - AndDevMK&#39;s android blog site</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="AndDevMK" /><meta name="description" content="注：本文代码基于Android Sv2 一、概述 事件分发机制是View体系中一个非常重要的核心知识点，也是难点，不少Android开发者搞了几年的Android，或许也还没完全弄明白它的原理。 另外，在Android开发过程中难免会碰到滑动冲突的场景，而解决滑动冲突的理论基础就是事件分发机" /><meta name="keywords" content="Android, Java, Kotlin, C&#43;&#43;, C, Flutter, Dart, NDK" />


<meta name="baidu-site-verification" content="codeva-wQ7uOo4V09" />
<meta name="google-site-verification" content="yHzWB9BxTR74LiaUhuL5ncr89fnDYXiplTaPY565zqo" />


<meta name="generator" content="Hugo 0.111.3 with theme even" />


<link rel="canonical" href="https://anddevmk.cn/post/android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.c11aaf02bef1025d6b0813ba5e1a8a8551aee15fa8f2bcea906d41b20bdf5c69.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/codecopy.css">


<meta property="og:title" content="Android事件分发机制" />
<meta property="og:description" content="注：本文代码基于Android Sv2 一、概述 事件分发机制是View体系中一个非常重要的核心知识点，也是难点，不少Android开发者搞了几年的Android，或许也还没完全弄明白它的原理。 另外，在Android开发过程中难免会碰到滑动冲突的场景，而解决滑动冲突的理论基础就是事件分发机" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://anddevmk.cn/post/android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-06-23T14:41:31+08:00" />
<meta property="article:modified_time" content="2023-06-23T14:41:31+08:00" />
<meta itemprop="name" content="Android事件分发机制">
<meta itemprop="description" content="注：本文代码基于Android Sv2 一、概述 事件分发机制是View体系中一个非常重要的核心知识点，也是难点，不少Android开发者搞了几年的Android，或许也还没完全弄明白它的原理。 另外，在Android开发过程中难免会碰到滑动冲突的场景，而解决滑动冲突的理论基础就是事件分发机"><meta itemprop="datePublished" content="2023-06-23T14:41:31+08:00" />
<meta itemprop="dateModified" content="2023-06-23T14:41:31+08:00" />
<meta itemprop="wordCount" content="25430">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Android事件分发机制"/>
<meta name="twitter:description" content="注：本文代码基于Android Sv2 一、概述 事件分发机制是View体系中一个非常重要的核心知识点，也是难点，不少Android开发者搞了几年的Android，或许也还没完全弄明白它的原理。 另外，在Android开发过程中难免会碰到滑动冲突的场景，而解决滑动冲突的理论基础就是事件分发机"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">AndDevMK</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>

    
    <li class="mobile-menu-item-search">
      <div id="mobile_open_search" class="mobile_open_search">
        搜索
      </div>
    </li>

    
    <li class="mobile-menu-item-dark-mode">
      <div id="mobile_dark_mode_toggle" class="mobile_light_mode">
       
      </div>
    </li>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">AndDevMK</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
    
    <div id="open_search" class="open_search">
      搜索
    </div>

    
    <div id="dark_mode_toggle" class="light_mode">

    </div>
  
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Android事件分发机制</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-06-23 </span>
        <div class="post-category">
            <a href="/categories/android/"> Android </a>
            </div>
          <span class="more-meta"> 约 25430 字 </span>
          <span class="more-meta"> 预计阅读 51 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#一概述">一、概述</a></li>
    <li><a href="#二从实践的角度总结出结论">二、从实践的角度总结出结论</a>
      <ul>
        <li><a href="#21实践前的理论知识">2.1、实践前的理论知识</a></li>
        <li><a href="#22实践开始">2.2、实践开始</a>
          <ul>
            <li><a href="#221action_down的事件分发过程不包含onintercepttouchevent方法的情况">2.2.1、<em>ACTION_DOWN</em>的事件分发过程（不包含<em>onInterceptTouchEvent</em>方法的情况）</a>
              <ul>
                <li><a href="#2211在dispatchtouchevent方法中拦截action_down事件">2.2.1.1、在<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件</a></li>
                <li><a href="#2212在ontouchevent方法中拦截action_down事件">2.2.1.2、在<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件</a></li>
              </ul>
            </li>
            <li><a href="#222action_down的事件分发过程包含onintercepttouchevent方法的情况">2.2.2、<em>ACTION_DOWN</em>的事件分发过程（包含<em>onInterceptTouchEvent</em>方法的情况）</a></li>
            <li><a href="#223多个方法拦截的情况">2.2.3、多个方法拦截的情况</a></li>
            <li><a href="#224action_move和action_up的事件分发过程">2.2.4、<em>ACTION_MOVE</em>和<em>ACTION_UP</em>的事件分发过程</a>
              <ul>
                <li><a href="#2241action_move默认的事件分发过程">2.2.4.1、<em>ACTION_MOVE</em>默认的事件分发过程</a></li>
                <li><a href="#2242在dispatchtouchevent方法中拦截action_move事件">2.2.4.2、在<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_MOVE</em>事件</a>
                  <ul>
                    <li><a href="#22421仅拦截action_down事件">2.2.4.2.1、仅拦截ACTION_DOWN事件</a></li>
                    <li><a href="#22422拦截所有事件">2.2.4.2.2、拦截所有事件</a></li>
                  </ul>
                </li>
                <li><a href="#2243在ontouchevent方法中拦截action_move事件">2.2.4.3、在<em>onTouchEvent</em>方法中拦截<em>ACTION_MOVE</em>事件</a>
                  <ul>
                    <li><a href="#22431仅拦截action_down事件">2.2.4.3.1、仅拦截ACTION_DOWN事件</a></li>
                    <li><a href="#22432拦截所有事件">2.2.4.3.2、拦截所有事件</a></li>
                  </ul>
                </li>
                <li><a href="#2244多个方法拦截的情况">2.2.4.4、多个方法拦截的情况</a>
                  <ul>
                    <li><a href="#22441组合dispatchtouchevent方法和ontouchevent方法拦截action_move事件">2.2.4.4.1、组合<em>dispatchTouchEvent</em>方法和<em>onTouchEvent</em>方法拦截<em>ACTION_MOVE</em>事件</a></li>
                    <li><a href="#22442组合onintercepttouchevent方法和ontouchevent方法拦截action_move事件">2.2.4.4.2、组合<em>onInterceptTouchEvent</em>方法和<em>onTouchEvent</em>方法拦截<em>ACTION_MOVE</em>事件</a></li>
                    <li><a href="#22443一种特殊情况">2.2.4.4.3、一种特殊情况</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#三从源码的角度去看事件分发的过程">三、从源码的角度去看事件分发的过程</a>
      <ul>
        <li><a href="#31activity的事件分发过程">3.1、<em>Activity</em>的事件分发过程</a></li>
        <li><a href="#32viewgroup的事件分发过程">3.2、<em>ViewGroup</em>的事件分发过程</a></li>
        <li><a href="#33view的事件分发过程">3.3、View的事件分发过程</a></li>
      </ul>
    </li>
    <li><a href="#四解决开发中常见的滑动冲突">四、解决开发中常见的滑动冲突</a>
      <ul>
        <li><a href="#41常见的滑动冲突场景处理思路">4.1、常见的滑动冲突场景&amp;处理思路</a></li>
        <li><a href="#42解决滑动冲突的办法">4.2、解决滑动冲突的办法</a>
          <ul>
            <li><a href="#421外部拦截法">4.2.1、外部拦截法</a></li>
            <li><a href="#422内部拦截法">4.2.2、内部拦截法</a></li>
          </ul>
        </li>
        <li><a href="#43滑动冲突实战">4.3、滑动冲突实战</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p><em>注：本文代码基于Android Sv2</em></p>
</blockquote>
<h1 id="一概述">一、概述</h1>
<p>事件分发机制是<em>View</em>体系中一个非常重要的核心知识点，也是难点，不少<em>Android</em>开发者搞了几年的<em>Android</em>，或许也还没完全弄明白它的原理。</p>
<p>另外，在<em>Android</em>开发过程中难免会碰到滑动冲突的场景，而解决滑动冲突的理论基础就是事件分发机制，因此掌握事件分发机制十分必要。</p>
<p>接下来，本文会先从实践的角度总结出结论，然后从源码的角度去看事件分发的过程，最后利用前面所学知识去演示如何解决开发中常见的滑动冲突。</p>
<h1 id="二从实践的角度总结出结论">二、从实践的角度总结出结论</h1>
<h2 id="21实践前的理论知识">2.1、实践前的理论知识</h2>
<p>事件分发主要涉及3个方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Activity、ViewGroup、View都有提供该方法，该方法的作用：事件的分发
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">dispatchTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 仅ViewGroup提供该方法，该方法的作用：事件的拦截
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onInterceptTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Activity、View都有提供该方法，该方法的作用：事件的处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这3个方法有2个共同点，第一个共同点就是都有一个入参<em>MotionEvent</em>，它表示当用户触摸屏幕时所进行的每一次交互（每一次交互指的是手指在<em>UI</em>控件上从按下、滑动再到抬起的过程），都会产生一次同一序列的触摸事件，这些触摸事件被封装进了<em>MotionEvent</em>类里，通过以下方法可以获取触摸事件的类型，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">action</span> <span class="p">=</span> <span class="n">ev</span><span class="o">?.</span><span class="n">action</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在事件分发过程中，常用的触摸事件类型有以下4种：</p>
<ul>
<li>
<p><em>ACTION_DOWN</em>：表示手指按下的事件。</p>
</li>
<li>
<p><em>ACTION_MOVE</em>：表示手指移动的事件。</p>
</li>
<li>
<p><em>ACTION_UP</em>：表示手指抬起的事件。</p>
</li>
<li>
<p><em>ACTION_CANCEL</em>：表示当前触摸事件已终止。</p>
</li>
</ul>
<p>第二个共同点是都需要返回<em>boolean</em>类型的返回值，关于返回值的作用是什么后面会讲到。</p>
<p><em><strong>那么，事件分发中这3个方法之间有什么关系呢？</strong></em></p>
<p>它们之间的关系可以用以下伪代码来表示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">dispatchTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">onInterceptTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">onTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="na">dispatchTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过伪代码，先大致了解下触摸事件的传递规则：对于一个根<em>ViewGroup</em>来说，触摸事件产生后，首先会传递给它，这时它的<em>dispatchTouchEvent</em>方法就会被调用，如果这个<em>ViewGroup</em>的<em>onInterceptTouchEvent</em>方法返回<em>true</em>就表示它要拦截当前事件，接着事件就会交给这个<em>ViewGroup</em>处理，即它的<em>onTouchEvent</em>方法就会被调用；如果这个<em>ViewGroup</em>的<em>onInterceptTouchEvent</em>方法返回<em>false</em>就表示它不拦截当前事件，这时当前事件就会继续传递给它的子元素，接着子元素的<em>dispatchTouchEvent</em>方法就会被调用，如此反复直到事件被最终处理。</p>
<h2 id="22实践开始">2.2、实践开始</h2>
<p>开始前，我们先编写一个<em>UI</em>界面，本文之后的讲解都是基于该<em>UI</em>界面的层次结构，<em>UI</em>界面运行后的效果如下：</p>
<img title="" src="/img/android/Android事件分发机制/演示的UI结构.png" alt="" width="335" />
<p>从运行效果图可以知道，该<em>UI</em>界面内部嵌套了一个紫色的<em>MyViewGroup2</em>控件、一个绿色的<em>MyViewGroup1</em>控件以及一个黑色的<em>MyView</em>控件，布局文件代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span> <span class="na">xmlns:android=</span><span class="s">&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">xmlns:app=</span><span class="s">&#34;http://schemas.android.com/apk/res-auto&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">xmlns:tools=</span><span class="s">&#34;http://schemas.android.com/tools&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">tools:context=</span><span class="s">&#34;.MainActivity&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;com.pengmj.androideventdispatch.MyViewGroup2</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;300dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;300dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:background=</span><span class="s">&#34;@color/purple_200&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;com.pengmj.androideventdispatch.MyViewGroup1</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;200dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;200dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:background=</span><span class="s">&#34;@color/teal_200&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;com.pengmj.androideventdispatch.MyView</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:layout_width=</span><span class="s">&#34;100dp&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:layout_height=</span><span class="s">&#34;100dp&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:background=</span><span class="s">&#34;@color/black&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/com.pengmj.androideventdispatch.MyViewGroup1&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/com.pengmj.androideventdispatch.MyViewGroup2&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>其中</em>MyViewGroup2<em>控件和</em>MyViewGroup1控件的实现是一样的，都是继承自<em>ConstraintLayout</em>，以<em>MyViewGroup2</em>为例，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyViewGroup2</span> <span class="p">:</span> <span class="n">ConstraintLayout</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">:</span> <span class="n">AttributeSet</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">:</span> <span class="n">AttributeSet</span><span class="p">?,</span>
</span></span><span class="line"><span class="cl">        <span class="n">defStyleAttr</span><span class="p">:</span> <span class="n">Int</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">defStyleAttr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>而<em>MyView</em>继承自<em>View</em>，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyView</span> <span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">?)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">?,</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">:</span> <span class="n">AttributeSet</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">?,</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">:</span> <span class="n">AttributeSet</span><span class="p">?,</span>
</span></span><span class="line"><span class="cl">        <span class="n">defStyleAttr</span><span class="p">:</span> <span class="n">Int</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">defStyleAttr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后，<em>MainActivity</em>的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="n">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">?)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">super</span><span class="p">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">setContentView</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>   
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>之前介绍事件分发的相关方法时，代码注释里有描述过，在<em>Activity</em>、<em>ViewGroup</em>、<em>View</em>中都有<em>dispatchTouchEvent</em>方法，在<em>Activity</em>、<em>View</em>中都有<em>onTouchEvent</em>方法，对于<em>ViewGroup</em>而言，则多了一个<em>onInterceptTouchEvent</em>方法。</p>
<p>因此，本文先讲解不包含<em>onInterceptTouchEvent</em>方法时的事件分发过程，然后再讲解包含<em>onInterceptTouchEvent</em>方法时的事件分发过程。</p>
<h3 id="221action_down的事件分发过程不包含onintercepttouchevent方法的情况">2.2.1、<em>ACTION_DOWN</em>的事件分发过程（不包含<em>onInterceptTouchEvent</em>方法的情况）</h3>
<p>既然先讨论的是不包含<em>onInterceptTouchEvent</em>方法的情况，那么只需将<em>MainActivity</em>、<em>MyViewGroup2</em>、<em>MyViewGroup1</em>、<em>MyView</em>都重写<em>dispatchTouchEvent</em>方法和<em>onTouchEvent</em>方法，为了验证在这种情况下的<em>ACTION_DOWN</em>事件分发过程，都打上日志进行观察，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>                                       
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                                                            
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                                                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>                   
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                                                                                          
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                                                              
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                                                            
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                                                         
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                                                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>                         
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                                                                                          
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                                                              
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>                                                               
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                                                                                                                   
</span></span></code></pre></td></tr></table>
</div>
</div><p>为什么要加上<em>if</em> (<em>LOG_ACTION_DOWN</em>)判断条件呢？这是一个开关，用于日志过滤，方便观察。本文所有源码将在文末贴出。</p>
<h4 id="2211在dispatchtouchevent方法中拦截action_down事件">2.2.1.1、在<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件</h4>
<p>在<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件之前，我们需要知道<em>dispatchTouchEvent</em>方法需要返回<em>boolean</em>类型的返回值，它的返回值有3种情况：</p>
<ul>
<li>情况一：返回<em>super.dispatchTouchEvent</em></li>
</ul>
<p><em>dispatchTouchEvent</em>方法默认返回<em>super.dispatchTouchEvent</em>，表示不拦截任何事件，它是<em>View</em>体系中默认的事件分发过程。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在dispatchTouchEvent方法中拦截ACTION_DOWN事件/情况一/1.png" alt="" width="535" />
<ul>
<li>情况二：返回<em>true</em></li>
</ul>
<p>在<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件有两种方式：一是仅拦截<em>ACTION_DOWN</em>事件；二是拦截所有事件，这样也就包括了<em>ACTION_DOWN</em>事件。</p>
<p>仅拦截<em>ACTION_DOWN</em>事件的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                           
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>      
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span>                  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                            
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                            
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                          
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>拦截所有事件的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                           
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>                     
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                            
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                            
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span>                      
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>两种拦截<em>ACTION_DOWN</em>事件的方式有什么区别呢？</p>
<p>对于<em>ACTION_DOWN</em>事件来说没区别，最终打印结果是一样的，所以本文接下来采用仅拦截<em>ACTION_DOWN</em>事件的方式。</p>
<ol>
<li>在<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在dispatchTouchEvent方法中拦截ACTION_DOWN事件/情况二/1.png" alt="" width="535" />
<ol start="2">
<li>在<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在dispatchTouchEvent方法中拦截ACTION_DOWN事件/情况二/2.png" alt="" width="535" />
<ol start="3">
<li>在<em>MyViewGroup1</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup1</em>的<em>dispatchTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在dispatchTouchEvent方法中拦截ACTION_DOWN事件/情况二/3.png" alt="" width="535" />
<ol start="4">
<li>在<em>MyView</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyView</em>的<em>dispatchTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在dispatchTouchEvent方法中拦截ACTION_DOWN事件/情况二/4.png" alt="" width="535" />
<p>通过对日志的观察，不难看出规律，可以得出结论：</p>
<blockquote>
<p><em><strong>在dispatchTouchEvent方法中拦截ACTION_DOWN事件并返回true之后，ACTION_DOWN事件就会直接停止传递，后面的子控件都不会接收到这个事件。</strong></em></p>
</blockquote>
<ul>
<li>情况三：返回<em>false</em></li>
</ul>
<p>和之前返回<em>true</em>的情况一样，这里返回<em>false</em>的情况也有两种方式拦截<em>ACTION_DOWN</em>事件，并且两种情况下的表现对于<em>ACTION_DOWN</em>事件来说是没区别的，最终打印结果是一样的，所以这里演示的是仅拦截<em>ACTION_DOWN</em>事件。</p>
<ol>
<li>在<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>false</em></li>
</ol>
<p>修改<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                           
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>       
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span>                  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                            
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                            
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                          
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在dispatchTouchEvent方法中拦截ACTION_DOWN事件/情况三/1.png" alt="" width="535" />
<ol start="2">
<li>在<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>false</em></li>
</ol>
<p>修改<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法的代码为同上述MainActivity。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在dispatchTouchEvent方法中拦截ACTION_DOWN事件/情况三/2.png" alt="" width="535" />
<ol start="3">
<li>在<em>MyViewGroup1</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>false</em></li>
</ol>
<p>修改<em>MyViewGroup1</em>的<em>dispatchTouchEvent</em>方法的代码为同上述MainActivity。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在dispatchTouchEvent方法中拦截ACTION_DOWN事件/情况三/3.png" alt="" width="535" />
<ol start="4">
<li>在<em>MyView</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>false</em></li>
</ol>
<p>修改<em>MyView</em>的<em>dispatchTouchEvent</em>方法的代码为同上述MainActivity。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在dispatchTouchEvent方法中拦截ACTION_DOWN事件/情况三/4.png" alt="" width="535" />
<p>通过对日志的观察，不难看出规律，可以得出结论：</p>
<blockquote>
<p><em><strong>在dispatchTouchEvent方法中返回false拦截事件之后，事件并不会直接停止传递，而是向父控件的onTouchEvent方法回传。</strong></em></p>
</blockquote>
<h4 id="2212在ontouchevent方法中拦截action_down事件">2.2.1.2、在<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件</h4>
<p>在<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件之前，我们需要知道<em>onTouchEvent</em>方法需要返回<em>boolean</em>类型的返回值，它有3种情况：</p>
<ul>
<li>
<p>情况一：返回<em>super.onTouchEvent</em></p>
</li>
<li>
<p>情况二：返回true</p>
</li>
<li>
<p>情况三：返回false</p>
</li>
</ul>
<p>其中，情况一和情况三都表示不拦截<em>ACTION_DOWN</em>事件，所以它们的事件分发过程和<em>View</em>体系中默认的事件分发过程是一毛一样的，所以这里只分析情况二，下面的结论也是针对情况二来讲。</p>
<p>在<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件有两种方式：一是仅拦截<em>ACTION_DOWN</em>事件；二是拦截所有事件，这样也就包括了<em>ACTION_DOWN</em>事件。</p>
<p>仅拦截<em>ACTION_DOWN</em>事件的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>    
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                   
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                       
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>       
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                         
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                        
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>                         
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>拦截所有事件的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>    
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                   
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                       
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                         
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                        
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span>                       
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>两种拦截<em>ACTION_DOWN</em>事件的方式有什么区别呢？</p>
<p>对于<em>ACTION_DOWN</em>事件来说没区别，最终打印结果是一样的，所以本文接下来采用仅拦截<em>ACTION_DOWN</em>事件的方式。</p>
<ol>
<li>在<em>MainActivity</em>的<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MainActivity</em>的<em>onTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在onTouchEvent方法中拦截ACTION_DOWN事件/情况二/1.png" alt="" width="535" />
<ol start="2">
<li>在<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在onTouchEvent方法中拦截ACTION_DOWN事件/情况二/2.png" alt="" width="535" />
<ol start="3">
<li>在<em>MyViewGroup1</em>的<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup1</em>的<em>onTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在onTouchEvent方法中拦截ACTION_DOWN事件/情况二/3.png" alt="" width="535" />
<ol start="4">
<li>在<em>MyView</em>的<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyView</em>的<em>onTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/不包含onInterceptTouchEvent方法的情况/在onTouchEvent方法中拦截ACTION_DOWN事件/情况二/4.png" alt="" width="535" />
<p>通过对日志的观察，不难看出规律，可以得出结论：</p>
<blockquote>
<p><em><strong>无论在哪个控件的onTouchEvent方法中拦截ACTION_DOWN事件并返回true，事件都会直接停止传递，后面的父控件都不会接收到这个事件。</strong></em></p>
</blockquote>
<h3 id="222action_down的事件分发过程包含onintercepttouchevent方法的情况">2.2.2、<em>ACTION_DOWN</em>的事件分发过程（包含<em>onInterceptTouchEvent</em>方法的情况）</h3>
<p>在<em>onInterceptTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件之前，我们需要知道<em>onInterceptTouchEvent</em>方法需要返回<em>boolean</em>类型的返回值，它有3种情况：</p>
<ul>
<li>
<p>情况一：返回<em>super.onInterceptTouchEvent</em></p>
</li>
<li>
<p>情况二：返回<em>true</em></p>
</li>
<li>
<p>情况三：返回<em>false</em></p>
</li>
</ul>
<p>其中，情况一和情况三都表示不拦截<em>ACTION_DOWN</em>事件，所以它们的事件分发过程和默认的事件分发过程是一毛一样的，所以这里只分析情况二，下面结论也是针对情况二来讲。</p>
<p>在<em>onInterceptTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件有两种方式：一是仅拦截<em>ACTION_DOWN</em>事件；二是拦截所有事件，这样也就包括了<em>ACTION_DOWN</em>事件。</p>
<p>仅拦截<em>ACTION_DOWN</em>事件的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onInterceptTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>    
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                   
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                       
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>       
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                         
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                        
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>                         
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>拦截所有事件的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onInterceptTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>    
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                   
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                       
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                         
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                        
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span>                       
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>两种拦截<em>ACTION_DOWN</em>事件的方式有什么区别呢？</p>
<p>对于<em>ACTION_DOWN</em>事件来说没区别，最终打印结果是一样的，所以本文接下来采用仅拦截<em>ACTION_DOWN</em>事件的方式。</p>
<ol>
<li>在<em>MyViewGroup2</em>的<em>onInterceptTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup2</em>的<em>onInterceptTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/包含onInterceptTouchEvent方法的情况/情况二/1.png" alt="" width="535" />
<ol start="2">
<li>在<em>MyViewGroup1</em>的<em>onInterceptTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup1</em>的<em>onInterceptTouchEvent</em>方法为上面所说的仅拦截<em>ACTION_DOWN</em>事件的代码。</p>
<p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/包含onInterceptTouchEvent方法的情况/情况二/2.png" alt="" width="535" />
<p>通过对日志的观察，不难看出规律，可以得出结论：</p>
<blockquote>
<p><em><strong>若在ViewGroup的onInterceptTouchEvent方法中拦截ACTION_DOWN事件，只会改变ACTION_DOWN事件的正常流向，事件会直接流向自己的onTouchEvent方法中，并不会截断事件。</strong></em></p>
</blockquote>
<h3 id="223多个方法拦截的情况">2.2.3、多个方法拦截的情况</h3>
<p>一般我们在拦截事件时，都是共同使用<em>onInterceptTouchEvent</em>方法和<em>onTouchEvent</em>方法的，通过在<em>onInterceptTouchEvent</em>方法中返回true，将<em>ACTION_DOWN</em>消息流向自己的<em>onTouchEvent</em>方法中，然后在该<em>onTouchEvent</em>方法中返回<em>true</em>拦截事件。</p>
<p>下面以<em>MyViewGroup1</em>为例，在<em>MyViewGroup1</em>的<em>onInterceptTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em>，在<em>MyViewGroup1</em>的<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em>。</p>
<p>修改<em>MyViewGroup1</em>的<em>onInterceptTouchEvent</em>方法和<em>onTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>    
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                            
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_INTERCEPT_TOUCH_EVENT</span> <span class="o">&amp;&amp;</span> <span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                           
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                              
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                         
</span></span><span class="line"><span class="cl"><span class="p">}</span>    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>    
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                   
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span>   <span class="o">-&gt;</span> <span class="p">{</span>                       
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>       
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                         
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                        
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>                         
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                            
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，点击<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_DOWN</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_DOWN的事件分发过程/多个方法拦截的情况/1.png" alt="" width="535" />
<h3 id="224action_move和action_up的事件分发过程">2.2.4、<em>ACTION_MOVE</em>和<em>ACTION_UP</em>的事件分发过程</h3>
<p><em>ACTION_MOVE</em>和<em>ACTION_UP</em>事件的分发过程与之前所讲的<em>ACTION_DOWN</em>事件并不是完全一样的，为了对比两者，我会用黑色箭头表示<em>ACTION_DOWN</em>的事件分发过程，用红色箭头合并表示<em>ACTION_MOVE</em>和<em>ACTION_UP</em>的事件分发过程，为什么两者都用红色箭头表示呢？这是因为<em>ACTION_MOVE</em>和<em>ACTION_UP</em>的事件流向是完全相同的，后面都以<em>ACTION_MOVE</em>事件来讲解。</p>
<h4 id="2241action_move默认的事件分发过程">2.2.4.1、<em>ACTION_MOVE</em>默认的事件分发过程</h4>
<p><em>ACTION_MOVE</em>默认的事件分发过程，和之前所讲的<em>ACTION_DOWN</em>事件默认的事件分发过程是一样的，也就是所有的事件分发方法都不做拦截处理。</p>
<p>修改<em>MainActivity</em>、<em>MyView</em>的<em>dispatchTouchEvent</em>方法、<em>onTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                       
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                          
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                     
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                          
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                     
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                         
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                       
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                             
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                    
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                          
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                     
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                          
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                     
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                         
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>                          
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                          
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改<em>MyViewGroup2</em>、<em>MyViewGroup1</em>的<em>dispatchTouchEvent</em>方法、<em>onInterceptTouchEvent</em>方法、<em>onTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                       
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                          
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                     
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                          
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                     
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                         
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                       
</span></span><span class="line"><span class="cl"><span class="p">}</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                             
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                                
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_INTERCEPT_TOUCH_EVENT</span> <span class="o">&amp;&amp;</span> <span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>      
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                           
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                                
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_INTERCEPT_TOUCH_EVENT</span> <span class="o">&amp;&amp;</span> <span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>      
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                       
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                               
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                          
</span></span><span class="line"><span class="cl"><span class="p">}</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                    
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                          
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                     
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                          
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                     
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                         
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>                          
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/默认情况下的ACTION_MOVE事件分发过程.png" alt="" width="535" />
<h4 id="2242在dispatchtouchevent方法中拦截action_move事件">2.2.4.2、在<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_MOVE</em>事件</h4>
<p>按照之前在<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件的写法，同样地，在<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_MOVE</em>事件，比如说修改<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法，你可能会写下如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                                                                                
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>      
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span>                                          
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                      
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                            
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                          
</span></span></code></pre></td></tr></table>
</div>
</div><p>然而代码运行后，发现并不能如愿地看到想要的<em>ACTION_MOVE</em>日志，也就是说代码没有起作用，这是因为<em>ACTION_MOVE</em>事件根本就不会流到<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法中，前面讲过，默认情况下，<em>ACTION_MOVE</em>事件的流向是从<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法直接到<em>MainActivity</em>的<em>onTouchEvent</em>方法。</p>
<p><em><strong>那如何让ACTION_MOVE事件继续往子控件流向呢？</strong></em></p>
<p>解决办法有3种：仅拦截ACTION_DOWN事件、同时拦截ACTION_DOWN事件和<em>ACTION_MOVE</em>事件、拦截所有事件。其中前一种方式与后两种方式对于<em>ACTION_MOVE</em>事件的流向，它们的表现形式是不一样的；后两种方式对于<em>ACTION_MOVE</em>事件来说没区别，最终打印结果是一样的，所以本文后面会介绍第一种方式和第三种方式。</p>
<h5 id="22421仅拦截action_down事件">2.2.4.2.1、仅拦截ACTION_DOWN事件</h5>
<ol>
<li>在<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                        
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                        
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                            
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                       
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                                                                                              
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在dispatchTouchEvent方法中拦截/情况一/1.png" alt="" width="535" />
<ol start="2">
<li>在<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法为同上面MainActivity代码。                                                  <br>
运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在dispatchTouchEvent方法中拦截/情况一/2.png" alt="" width="535" />
<ol start="3">
<li>在<em>MyViewGroup1</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup1</em>的<em>dispatchTouchEvent</em>方法为同上面MainActivity代码。                                                                                 <br>
运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在dispatchTouchEvent方法中拦截/情况一/3.png" alt="" width="535" />
<ol start="4">
<li>在<em>MyView</em>的<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyView</em>的<em>dispatchTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在dispatchTouchEvent方法中拦截/情况一/4.png" alt="" width="535" />
<p>通过对日志的观察，不难看出规律，可以得出结论：</p>
<blockquote>
<p><em><strong>如果View不消耗除ACTION_DOWN以外的其他事件，那么这个点击事件会消失，此时父元素的onTouchEvent并不会被调用，并且当前View可以持续收到后续的事件，最终这些消失的点击事件会传递给Activity处理。</strong></em></p>
</blockquote>
<h5 id="22422拦截所有事件">2.2.4.2.2、拦截所有事件</h5>
<ol>
<li>在<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法中拦截所有事件并返回<em>true</em></li>
</ol>
<p>修改<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                        
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                        
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                            
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span>                   
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                                                                                              
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在dispatchTouchEvent方法中拦截/情况二/1.png" alt="" width="535" />
<ol start="2">
<li>在<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法中拦截所有事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup2</em>的<em>dispatchTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在dispatchTouchEvent方法中拦截/情况二/2.png" alt="" width="535" />
<ol start="3">
<li>在<em>MyViewGroup1</em>的<em>dispatchTouchEvent</em>方法中拦截所有事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup1</em>的<em>dispatchTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在dispatchTouchEvent方法中拦截/情况二/3.png" alt="" width="535" />
<ol start="4">
<li>在<em>MyView</em>的<em>dispatchTouchEvent</em>方法中拦截所有事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyView</em>的<em>dispatchTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在dispatchTouchEvent方法中拦截/情况二/4.png" alt="" width="535" />
<p>通过对日志的观察，不难看出规律，可以得出结论：</p>
<blockquote>
<p><em><strong>在dispatchTouchEvent方法中返回true拦截事件之后，ACTION_MOVE事件的流向与ACTION_DOWN事件的完全相同，事件会直接停止传递，后面的子控件都不会接收到这个事件。</strong></em></p>
</blockquote>
<h4 id="2243在ontouchevent方法中拦截action_move事件">2.2.4.3、在<em>onTouchEvent</em>方法中拦截<em>ACTION_MOVE</em>事件</h4>
<p>和在<em>dispatchTouchEvent</em>方法中拦截<em>ACTION_MOVE</em>事件相似，对于希望在<em>onTouchEvent</em>方法中拦截<em>ACTION_MOVE</em>事件，解决办法有3种：仅拦截ACTION_DOWN事件、同时拦截ACTION_DOWN事件和<em>ACTION_MOVE</em>事件、拦截所有事件。又因为这里只有仅拦截ACTION_DOWN事件和拦截所有事件的表现是不一样的，所以本文只会演示这2种。</p>
<h5 id="22431仅拦截action_down事件">2.2.4.3.1、仅拦截ACTION_DOWN事件</h5>
<ol>
<li>在<em>MainActivity</em>的<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MainActivity</em>的<em>onTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_DOWN</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                        
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                             
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">LOG_ACTION_MOVE</span><span class="p">)</span> <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                        
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                            
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                       
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                                                                                              
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在onTouchEvent方法中拦截/情况一/1.png" alt="" width="535" />
<ol start="2">
<li>在<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在onTouchEvent方法中拦截/情况一/2.png" alt="" width="535" />
<ol start="3">
<li>在<em>MyViewGroup1</em>的<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup1</em>的<em>onTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在onTouchEvent方法中拦截/情况一/3.png" alt="" width="535" />
<ol start="4">
<li>在<em>MyView</em>的<em>onTouchEvent</em>方法中拦截<em>ACTION_DOWN</em>事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyView</em>的<em>onTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在onTouchEvent方法中拦截/情况一/4.png" alt="" width="535" />
<p>通过对日志的观察，不难看出规律，可以得出结论：</p>
<blockquote>
<p><em><strong>此处结论同2.2.4.2.1小节。</strong></em></p>
</blockquote>
<h5 id="22432拦截所有事件">2.2.4.3.2、拦截所有事件</h5>
<ol>
<li>在<em>MainActivity</em>的<em>onTouchEvent</em>方法中拦截所有事件并返回<em>true</em></li>
</ol>
<p>修改<em>MainActivity</em>的<em>onTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>          
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                         
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                               
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>                                                        
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                               
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>              
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                               
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                              
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span>                           
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                                                                                                                                                                                                                               
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MainActivity: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在onTouchEvent方法中拦截/情况二/1.png" alt="" width="535" />
<ol start="2">
<li>在<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法中拦截所有事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在onTouchEvent方法中拦截/情况二/2.png" alt="" width="535" />
<ol start="3">
<li>在<em>MyViewGroup1</em>的<em>onTouchEvent</em>方法中拦截所有事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyViewGroup1</em>的<em>onTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在onTouchEvent方法中拦截/情况二/3.png" alt="" width="535" />
<ol start="4">
<li>在<em>MyView</em>的<em>onTouchEvent</em>方法中拦截所有事件并返回<em>true</em></li>
</ol>
<p>修改<em>MyView</em>的<em>onTouchEvent</em>方法为同上面MainActivity代码。</p>
<p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/在onTouchEvent方法中拦截/情况二/4.png" alt="" width="535" />
<p>通过对日志的观察，不难看出规律，可以得出结论：</p>
<blockquote>
<p><em><strong>无论ACTION_DOWN消息的流向是怎样的，只要最终流到onTouchEvent函数中就行。假设控件A最终在onTouchEvent函数中消费了ACTION_DOWN消息，那么ACTION_MOVE消息的流向就是先流到控件A的dispatchTouchEvent函数中，最终直接流到控件A的onTouchEvent函数中，进而消息停止传递。</strong></em></p>
</blockquote>
<h4 id="2244多个方法拦截的情况">2.2.4.4、多个方法拦截的情况</h4>
<p><em><strong>注：下面演示都是拦截所有事件</strong></em></p>
<h5 id="22441组合dispatchtouchevent方法和ontouchevent方法拦截action_move事件">2.2.4.4.1、组合<em>dispatchTouchEvent</em>方法和<em>onTouchEvent</em>方法拦截<em>ACTION_MOVE</em>事件</h5>
<p>在<em>MyView</em>的<em>dispatchTouchEvent</em>方法中返回<em>false</em>，而在<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法中返回<em>true</em>拦截<em>ACTION_MOVE</em>事件。</p>
<p>修改<em>MyView</em>的<em>dispatchTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>                    
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                                         
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                                            
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>                     
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                       
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                                            
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;dispatchTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>                     
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                                                
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                                           
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">false</span>                                                                
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                               
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>           
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                                
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>               
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                           
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                                
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>               
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                             
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                               
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                     
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/多个方法拦截的情况/1.png" alt="" width="535" />
<h5 id="22442组合onintercepttouchevent方法和ontouchevent方法拦截action_move事件">2.2.4.4.2、组合<em>onInterceptTouchEvent</em>方法和<em>onTouchEvent</em>方法拦截<em>ACTION_MOVE</em>事件</h5>
<p>在<em>MyViewGroup1</em>的<em>onInterceptTouchEvent</em>方法中返回<em>true</em>，而在<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法中返回<em>true</em>拦截<em>ACTION_MOVE</em>事件。</p>
<p>修改<em>MyViewGroup1</em>的<em>onInterceptTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>                
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                                        
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                                           
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>                 
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                      
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                                           
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>                 
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                                                    
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                                          
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                                              
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改<em>MyViewGroup2</em>的<em>onTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>           
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                                
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>               
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                           
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                                
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>               
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                             
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                               
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span>   
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                  
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onTouchEvent -&gt; ACTION_MOVE
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/多个方法拦截的情况/2.png" alt="" width="535" />
<h5 id="22443一种特殊情况">2.2.4.4.3、一种特殊情况</h5>
<p>在<em>MyViewGroup2</em>的<em>onInterceptTouchEvent</em>方法中拦截<em>ACTION_MOVE</em>事件返回<em>true</em>，而在<em>MyView的</em>onTouchEvent<em>方法中返回</em>true*。</p>
<p>修改<em>MyViewGroup2</em>的<em>onInterceptTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>                   
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                                           
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                                              
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>                    
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                         
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                                              
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>                    
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span>                                                           
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                                                            
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_CANCEL</span> <span class="o">-&gt;</span> <span class="p">{</span>                                            
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_CANCEL&#34;</span><span class="p">)</span>                  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                         
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                                             
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                                        
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                                                                                                                              
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改<em>MyView</em>的<em>onTouchEvent</em>方法为如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>           
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="o">?.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                                
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_DOWN&#34;</span><span class="p">)</span>               
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                           
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                                
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onTouchEvent -&gt; ACTION_MOVE&#34;</span><span class="p">)</span>               
</span></span><span class="line"><span class="cl">        <span class="p">}</span>   
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_CANCEL</span> <span class="o">-&gt;</span> <span class="p">{</span>                                            
</span></span><span class="line"><span class="cl">            <span class="nc">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&#34;onInterceptTouchEvent -&gt; ACTION_CANCEL&#34;</span><span class="p">)</span>                  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                                           
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                               
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span>   
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                  
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行起来后，触摸<em>MyView</em>控件时，日志打印如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_DOWN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MainActivity: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: dispatchTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">E/MyViewGroup2: onInterceptTouchEvent -&gt; ACTION_MOVE
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E/MyViewGroup1: dispatchTouchEvent -&gt; ACTION_CANCEL
</span></span><span class="line"><span class="cl">E/MyViewGroup1: onInterceptTouchEvent -&gt; ACTION_CANCEL
</span></span><span class="line"><span class="cl">E/MyView: dispatchTouchEvent -&gt; ACTION_CANCEL
</span></span><span class="line"><span class="cl">E/MyView: onTouchEvent -&gt; ACTION_CANCEL
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ACTION_MOVE</em>事件分发过程如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/ACTION_MOVE的事件分发过程/多个方法拦截的情况/3.png" alt="" width="535" />
<p>本来<em>ACTION_MOVE</em>事件依然会从<em>MainActivity</em>的<em>dispatchTouchEvent</em>方法流向子控件，但是在到达<em>MyViewGroup2</em>的<em>onInterceptTouchEvent</em>方法时，<em>ACTION_MOVE</em>事件被拦截了。到这里，这次的<em>ACTION_MOVE</em>事件就没有了，变成了<em>ACTION_CANCEL</em>事件继续向子控件传递，一直传递到<em>ACTION_MOVE</em>事件原本要传递的位置，通知所有被截断的子控件，它们的事件取消了，后面没有事件再传递过来。</p>
<h1 id="三从源码的角度去看事件分发的过程">三、从源码的角度去看事件分发的过程</h1>
<h2 id="31activity的事件分发过程">3.1、<em>Activity</em>的事件分发过程</h2>
<p>当用户触摸屏幕的时候，触摸事件就会传递给当前的<em>Activity</em>，由<em>Activity</em>的<em>dispatchTouchEvent</em>方法进行事件分发，所以先从该方法进行分析。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.app.Activity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">dispatchTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// 分析1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">ev</span><span class="o">.</span><span class="na">getAction</span><span class="o">()</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">onUserInteraction</span><span class="o">();</span>                        
</span></span><span class="line"><span class="cl">    <span class="o">}</span>             
</span></span><span class="line"><span class="cl">    <span class="c1">// 分析2                                
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">getWindow</span><span class="o">().</span><span class="na">superDispatchTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">))</span> <span class="o">{</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>                                
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 分析3                                               
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">onTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">);</span>                        
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                   
</span></span></code></pre></td></tr></table>
</div>
</div><p>分析1：这里是个if条件判断，如果触摸事件的类型是<em>ACTION_DOWN</em>，那么调用<em>onUserInteraction</em>方法，<em>onUserInteraction</em>方法的解释如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.app.Activity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 当用户与屏幕交互（例如触摸、键盘输入或轨迹球滚动）时，系统会调用该方法
</span></span></span><span class="line"><span class="cl"><span class="c1">// 此回调和onUserLeaveHint方法旨在帮助Activity智能管理状态栏通知；具体来说，用于帮助Activity确定取消通知的适当时间
</span></span></span><span class="line"><span class="cl"><span class="c1">// 所有对Activity的onUserLeaveHint回调的调用都将伴随对onUserInteraction调用。这确保Activity将被告知相关的用户活动，例如下拉通知窗格并触摸那里的项目
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onUserInteraction</span><span class="o">()</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                 
</span></span></code></pre></td></tr></table>
</div>
</div><p>分析2：这里有也是个if条件判断，它调用了<em>getWindow</em>的<em>superDispatchTouchEvent</em>方法，一旦if条件为<em>true</em>成立，那么直接<em>return true</em>，整个<em>dispatchTouchEvent</em>方法便会执行完毕，后面的<em>onTouchEvent</em>方法不会被触发。</p>
<p>继续看getWindow方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.app.Activity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">Window</span> <span class="nf">getWindow</span><span class="o">()</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mWindow</span><span class="o">;</span>         
</span></span><span class="line"><span class="cl"><span class="o">}</span>                           
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>getWindow</em>方法返回的是一个<em>mWindow</em>，而<em>mWindow</em>的初始化在<em>Activity</em>的<em>attach</em>方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.app.Activity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">final</span> <span class="kt">void</span> <span class="nf">attach</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">ActivityThread</span> <span class="n">aThread</span><span class="o">,</span>                                               
</span></span><span class="line"><span class="cl">        <span class="n">Instrumentation</span> <span class="n">instr</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">token</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ident</span><span class="o">,</span>                                                 
</span></span><span class="line"><span class="cl">        <span class="n">Application</span> <span class="n">application</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="n">ActivityInfo</span> <span class="n">info</span><span class="o">,</span>                                       
</span></span><span class="line"><span class="cl">        <span class="n">CharSequence</span> <span class="n">title</span><span class="o">,</span> <span class="n">Activity</span> <span class="n">parent</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">,</span>                                                  
</span></span><span class="line"><span class="cl">        <span class="n">NonConfigurationInstances</span> <span class="n">lastNonConfigurationInstances</span><span class="o">,</span>                                         
</span></span><span class="line"><span class="cl">        <span class="n">Configuration</span> <span class="n">config</span><span class="o">,</span> <span class="n">String</span> <span class="n">referrer</span><span class="o">,</span> <span class="n">IVoiceInteractor</span> <span class="n">voiceInteractor</span><span class="o">,</span>                         
</span></span><span class="line"><span class="cl">        <span class="n">Window</span> <span class="n">window</span><span class="o">,</span> <span class="n">ActivityConfigCallback</span> <span class="n">activityConfigCallback</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">assistToken</span><span class="o">,</span>               
</span></span><span class="line"><span class="cl">        <span class="n">IBinder</span> <span class="n">shareableActivityToken</span><span class="o">)</span> <span class="o">{</span>                                                                
</span></span><span class="line"><span class="cl">    <span class="n">attachBaseContext</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>                                      
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mFragments</span><span class="o">.</span><span class="na">attachHost</span><span class="o">(</span><span class="kc">null</span> <span class="cm">/*parent*/</span><span class="o">);</span>                          
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mWindow</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PhoneWindow</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">window</span><span class="o">,</span> <span class="n">activityConfigCallback</span><span class="o">);</span>                                     
</span></span><span class="line"><span class="cl">    <span class="n">mWindow</span><span class="o">.</span><span class="na">setWindowControllerCallback</span><span class="o">(</span><span class="n">mWindowControllerCallback</span><span class="o">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">mWindow</span><span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>                                      
</span></span><span class="line"><span class="cl">    <span class="n">mWindow</span><span class="o">.</span><span class="na">setOnWindowDismissedCallback</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>                     
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，<em>mWindow</em>是一个<em>PhoneWindow</em>对象，也就是说之前if条件中<em>getWindow</em>的<em>superDispatchTouchEvent</em>方法实际上是调用了<em>PhoneWindow</em>对象的<em>superDispatchTouchEvent</em>方法，那么继续看<em>PhoneWindow</em>对象的<em>superDispatchTouchEvent</em>方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// com.android.internal.policy.PhoneWindow
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>                                                  
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">superDispatchTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mDecor</span><span class="o">.</span><span class="na">superDispatchTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>          
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                          
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>PhoneWindow</em>对象的<em>superDispatchTouchEvent</em>方法又转接给了<em>mDecor</em>的<em>superDispatchTouchEvent</em>方法，而<em>mDecor</em>是一个<em>DecorView</em>对象，它是窗口的顶层视图，包含窗口装饰，<em>DecorView</em>初始化的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// com.android.internal.policy.PhoneWindow
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>                                                  
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContentView</span><span class="o">(</span><span class="kt">int</span> <span class="n">layoutResID</span><span class="o">)</span> <span class="o">{</span>              
</span></span><span class="line"><span class="cl">    <span class="c1">// Note: FEATURE_CONTENT_TRANSITIONS may be set in the 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// decor, when theme attributes and the like are crysta
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// before this happens.                                
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">mContentParent</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                          
</span></span><span class="line"><span class="cl">        <span class="n">installDecor</span><span class="o">();</span>                                    
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">hasFeature</span><span class="o">(</span><span class="n">FEATURE_CONTENT_TRANSITIONS</span><span class="o">))</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">mContentParent</span><span class="o">.</span><span class="na">removeAllViews</span><span class="o">();</span>                   
</span></span><span class="line"><span class="cl">    <span class="o">}</span>  
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>                                                    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">installDecor</span><span class="o">()</span> <span class="o">{</span>                                                    
</span></span><span class="line"><span class="cl">    <span class="n">mForceDecorInstall</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                                                  
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">mDecor</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                                        
</span></span><span class="line"><span class="cl">        <span class="n">mDecor</span> <span class="o">=</span> <span class="n">generateDecor</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span>                                              
</span></span><span class="line"><span class="cl">        <span class="n">mDecor</span><span class="o">.</span><span class="na">setDescendantFocusability</span><span class="o">(</span><span class="n">ViewGroup</span><span class="o">.</span><span class="na">FOCUS_AFTER_DESCENDANTS</span><span class="o">);</span>     
</span></span><span class="line"><span class="cl">        <span class="n">mDecor</span><span class="o">.</span><span class="na">setIsRootNamespace</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>                                         
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">mInvalidatePanelMenuPosted</span> <span class="o">&amp;&amp;</span> <span class="n">mInvalidatePanelMenuFeatures</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>  
</span></span><span class="line"><span class="cl">            <span class="n">mDecor</span><span class="o">.</span><span class="na">postOnAnimation</span><span class="o">(</span><span class="n">mInvalidatePanelMenuRunnable</span><span class="o">);</span>                
</span></span><span class="line"><span class="cl">        <span class="o">}</span>                                                                        
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>                                                                     
</span></span><span class="line"><span class="cl">        <span class="n">mDecor</span><span class="o">.</span><span class="na">setWindow</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>                                                  
</span></span><span class="line"><span class="cl">    <span class="o">}</span>  
</span></span><span class="line"><span class="cl">    <span class="c1">// ...    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">protected</span> <span class="n">DecorView</span> <span class="nf">generateDecor</span><span class="o">(</span><span class="kt">int</span> <span class="n">featureId</span><span class="o">)</span> <span class="o">{</span>                                          
</span></span><span class="line"><span class="cl">    <span class="c1">// System process doesn&#39;t have application context and in that case we need to directly 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// the context we have. Otherwise we want the application context, so we don&#39;t cling to 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// activity.                                                                            
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ...                                                                                      
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="k">new</span> <span class="n">DecorView</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">featureId</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="n">getAttributes</span><span class="o">());</span>                        
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                                                                                                                                                                                                   
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>DecorView</em>是在<em>installDecor</em>方法中被初始化的，此处代码和<em>Activity</em>的<em>setContentView</em>方法的源码相关联，只是这里的分析不是本文的重点，所以不会展开讲解。</p>
<p>OK，回到之前流程，那么调用的是<em>DecorView</em>的<em>superDispatchTouchEvent</em>方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// com.android.internal.policy.DecorView
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DecorView</span> <span class="kd">extends</span> <span class="n">FrameLayout</span> <span class="kd">implements</span> <span class="n">RootViewSurfaceTaker</span><span class="o">,</span> <span class="n">WindowCallbacks</span> <span class="o">{</span>               
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">superDispatchTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">dispatchTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                          
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>DecorView</em>继承自<em>FrameLayout</em>，<em>FrameLayout</em>继承自<em>ViewGroup</em>，而<em>FrameLayout</em>没有重写<em>dispatchTouchEvent</em>方法，那么<em>super.dispatchTouchEvent</em>调用的就是<em>ViewGroup</em>的<em>dispatchTouchEvent</em>方法了。</p>
<p>至此，<em>getWindow</em>的<em>superDispatchTouchEvent</em>方法让触摸事件的分发从<em>Activity</em>流转到了<em>ViewGroup</em>。</p>
<p>分析3：如果<em>getWindow</em>的<em>superDispatchTouchEvent</em>方法返回false，那么if条件判断不成立，就会继续执行<em>Activity</em>的<em>onTouchEvent</em>方法。</p>
<p>继续看<em>Activity</em>的<em>onTouchEvent</em>方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.app.Activity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">mWindow</span><span class="o">.</span><span class="na">shouldCloseOnTouch</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">event</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">finish</span><span class="o">();</span>                                 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>                              
</span></span><span class="line"><span class="cl">    <span class="o">}</span>                                             
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>                                 
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                 
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里调用了<em>mWindow</em>的<em>shouldCloseOnTouch</em>方法，我们知道，<em>mWindow</em>的实现类是<em>PhoneWindow</em>，所以<em>shouldCloseOnTouch</em>方法的具体实现应该就在<em>PhoneWindow</em>对象里，可惜<em>PhoneWindow</em>中并没有实现该方法，所以只能找<em>Window</em>对象本身了，果然<em>Window</em>类下有<em>shouldCloseOnTouch</em>方法的实现，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.Window
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nd">@UnsupportedAppUsage</span><span class="o">(</span><span class="n">maxTargetSdk</span> <span class="o">=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">P</span><span class="o">,</span> <span class="n">trackingBug</span> <span class="o">=</span> <span class="mi">115609023</span><span class="o">)</span>               
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldCloseOnTouch</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>                           
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">isOutside</span> <span class="o">=</span>                                                                     
</span></span><span class="line"><span class="cl">            <span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">()</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span> <span class="o">&amp;&amp;</span> <span class="n">isOutOfBounds</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">event</span><span class="o">)</span>           
</span></span><span class="line"><span class="cl">            <span class="o">||</span> <span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">()</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_OUTSIDE</span><span class="o">;</span>                                   
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">mCloseOnTouchOutside</span> <span class="o">&amp;&amp;</span> <span class="n">peekDecorView</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">isOutside</span><span class="o">)</span> <span class="o">{</span>                           
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>                                                                              
</span></span><span class="line"><span class="cl">    <span class="o">}</span>                                                                                             
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>                                                                                 
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                                                 
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>isOutside</em>表示触摸位置是否在<em>DecorView</em>的外部，它的判断逻辑为：如果触摸事件为<em>ACTION_UP</em>事件并且触摸事件的坐标<em>x</em>，<em>y</em>超出了DecorView边界时，则认为触摸位置在<em>DecorView</em>的外部；如果触摸事件为<em>ACTION_OUTSIDE</em>，那么也认为触摸位置在<em>DecorView</em>的外部。</p>
<p>然后来到<em>if</em>条件的判断了，第一个条件是一个<em>mCloseOnTouchOutside</em>布尔值，它表示点击<em>DecorView</em>外部时是否可以关闭。如果将<em>Activity</em>设置成<em>Dialog</em>样式的时候，可以通过<em>setCloseOnTouchOutside</em>方法设置<em>mCloseOnTouchOutside</em>布尔值为<em>true</em>；第二个条件是一个<em>peekDecorView</em>方法，它返回的是<em>mDecor</em>对象，也就是判断<em>mDecor</em>对象是否为null；第三个条件就是我们的<em>isOutside</em>值了。</p>
<p>如果同时满足上面所说的3个条件，那么整个<em>shouldCloseOnTouch</em>方法就会返回<em>true</em>，否则返回<em>false</em>。但是一般情况下很少将<em>Activity</em>设置为<em>Dialog</em>样式，所以也就用不到<em>setCloseOnTouchOutside</em>方法，所以<em>mCloseOnTouchOutside</em>的值<em>false</em>，那么<em>if</em>条件判断为false，整个<em>shouldCloseOnTouch</em>方法返回<em>false</em>，所以最终<em>onTouchEvent</em>方法也是返回<em>false</em>。</p>
<h2 id="32viewgroup的事件分发过程">3.2、<em>ViewGroup</em>的事件分发过程</h2>
<p>上面分析了<em>Activity</em>的事件分发过程，可以知道，<em>getWindow</em>的<em>superDispatchTouchEvent</em>方法让触摸事件的分发从<em>Activity</em>流转到了<em>ViewGroup</em>，那么继续看<em>ViewGroup</em>的<em>dispatchTouchEvent</em>方法，因为<em>ViewGroup</em>的<em>dispatchTouchEvent</em>方法很长，所以我们先分析前面一部分代码，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.ViewGroup
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>                                                                                        
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">dispatchTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> <span class="o">{</span>                                              
</span></span><span class="line"><span class="cl">    <span class="c1">// ...                                                                                   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 分析1                                                                                             
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">boolean</span> <span class="n">handled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                                                                     
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">onFilterTouchEventForSecurity</span><span class="o">(</span><span class="n">ev</span><span class="o">))</span> <span class="o">{</span>                                                     
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="kt">int</span> <span class="n">action</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>                                                       
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="kt">int</span> <span class="n">actionMasked</span> <span class="o">=</span> <span class="n">action</span> <span class="o">&amp;</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_MASK</span><span class="o">;</span>                               
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 分析2                                                                   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Handle an initial down.                                                               
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">actionMasked</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">)</span> <span class="o">{</span>                                           
</span></span><span class="line"><span class="cl">            <span class="c1">// Throw away all previous state when starting a new touch gesture.                  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// The framework may have dropped the up or cancel event for the previous gesture    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// due to an app switch, ANR, or some other state change.                            
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">cancelAndClearTouchTargets</span><span class="o">(</span><span class="n">ev</span><span class="o">);</span>                                                      
</span></span><span class="line"><span class="cl">            <span class="n">resetTouchState</span><span class="o">();</span>                                                                   
</span></span><span class="line"><span class="cl">        <span class="o">}</span>                                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 分析3                                                                                  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Check for interception.                                                               
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">intercepted</span><span class="o">;</span>                                                               
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">actionMasked</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span>                                              
</span></span><span class="line"><span class="cl">                <span class="o">||</span> <span class="n">mFirstTouchTarget</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 分析3.1                                                  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">disallowIntercept</span> <span class="o">=</span> <span class="o">(</span><span class="n">mGroupFlags</span> <span class="o">&amp;</span> <span class="n">FLAG_DISALLOW_INTERCEPT</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">;</span>      
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(!</span><span class="n">disallowIntercept</span><span class="o">)</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">                <span class="c1">// 分析3.1.1                                                           
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">intercepted</span> <span class="o">=</span> <span class="n">onInterceptTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">);</span>                                         
</span></span><span class="line"><span class="cl">                <span class="n">ev</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="n">action</span><span class="o">);</span> <span class="c1">// restore action in case it was changed                   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>       
</span></span><span class="line"><span class="cl">                <span class="c1">// 分析3.1.2                                                                             
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">intercepted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                                                             
</span></span><span class="line"><span class="cl">            <span class="o">}</span>                                                                                    
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>                                                                                 
</span></span><span class="line"><span class="cl">            <span class="c1">// There are no touch targets and this action is not an initial down                 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// so this view group continues to intercept touches.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// 分析3.2                                      
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">intercepted</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>                                                                  
</span></span><span class="line"><span class="cl">        <span class="o">}</span>  
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">handled</span><span class="o">;</span>     
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                                                                                                                              
</span></span></code></pre></td></tr></table>
</div>
</div><p>分析1：<em>handled</em>布尔值用来标记事件分发的处理结果，并最终作为<em>dispatchTouchEvent</em>方法的返回值；<em>onFilterTouchEventForSecurity</em>方法是做一个安全性检查，默认返回<em>true</em>；但是在我们执行敏感控件的点击事件时，有可能会被恶意软件在此之上加上一个不可接受事件的窗口，骗取我们的点击，那么解决办法是调用<em>View</em>的<em>setFilterTouchesWhenObscured</em>方法设置<em>true</em>，它会往View的setFlags方法中添加<em>FILTER_TOUCHES_WHEN_OBSCURED</em>，表示当视图的窗口被另一个可见窗口遮挡时框架丢弃触摸事件，这时<em>onFilterTouchEventForSecurity</em>方法就会返回<em>false</em>，从而<em>dispatchTouchEvent</em>方法返回<em>false</em>。</p>
<p>分析2：if判断如果触摸事件的类型为<em>ACTION_DOWN</em>，表示新的<em>ACTION_DOWN</em>事件来了，也就是同一序列的触摸事件的起点，所以需要调用cancelAndClearTouchTargets方法来取消并清除所有触摸目标，以及调用resetTouchState方法来重置所有触摸状态以准备新的循环。这两方法里面的重点是清空<em>mFirstTouchTarget</em>，重置<em>FLAG_DISALLOW_INTERCEPT</em>标记，这里<em>cancelAndClearTouchTargets</em>方法和<em>resetTouchState</em>方法的源码就不列出来了，可自行查阅。</p>
<p>分析3：<em>intercepted</em>布尔值用来表示是否拦截事件；接下来是一个<em>if</em>判断，条件一是触摸事件的类型为<em>ACTION_DOWN</em>，条件二是<em>mFirstTouchTarget != null</em>。<em>mFirstTouchTarget</em>和后面的代码逻辑有关，它的作用就是当<em>ViewGroup</em>不拦截事件并将事件交由子元素处理时，<em>mFirstTouchTarget</em>会被赋值并指向子元素，这时<em>mFirstTouchTarget != null</em>成立。</p>
<ul>
<li><em><strong>如果if判断为true</strong></em></li>
</ul>
<p>接下来，如果触摸事件的类型为ACTION_DOWN，或者<em>mFirstTouchTarget != null</em>时，就会进入分析3.1，布尔值<em>disallowIntercept</em>用来表示不允许父<em>View</em>拦截事件，它和<em>FLAG_DISALLOW_INTERCEPT</em>这个标志位有关，并且该标志位的位运算可以通过<em>requestDisallowInterceptTouchEvent</em>方法设置，从而改变<em>disallowIntercept</em>的值。</p>
<p>默认情况下，也就是没设置<em>FLAG_DISALLOW_INTERCEPT</em>标志位时，<em>disallowIntercept</em>的值为<em>false</em>，此时就会进入分析3.1.1，接着调用<em>onInterceptTouchEvent</em>方法拦截事件，如果<em>onInterceptTouchEvent</em>方法返回true，表示<em>ViewGroup</em>会拦截当前事件，那么<em>intercepted</em>被赋值为true，反之赋值为<em>false</em>。来看下<em>onInterceptTouchEvent</em>方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.ViewGroup
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onInterceptTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> <span class="o">{</span>        
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">ev</span><span class="o">.</span><span class="na">isFromSource</span><span class="o">(</span><span class="n">InputDevice</span><span class="o">.</span><span class="na">SOURCE_MOUSE</span><span class="o">)</span>             
</span></span><span class="line"><span class="cl">            <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="o">.</span><span class="na">getAction</span><span class="o">()</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span>      
</span></span><span class="line"><span class="cl">            <span class="o">&amp;&amp;</span> <span class="n">ev</span><span class="o">.</span><span class="na">isButtonPressed</span><span class="o">(</span><span class="n">MotionEvent</span><span class="o">.</span><span class="na">BUTTON_PRIMARY</span><span class="o">)</span> 
</span></span><span class="line"><span class="cl">            <span class="o">&amp;&amp;</span> <span class="n">isOnScrollbarThumb</span><span class="o">(</span><span class="n">ev</span><span class="o">.</span><span class="na">getX</span><span class="o">(),</span> <span class="n">ev</span><span class="o">.</span><span class="na">getY</span><span class="o">()))</span> <span class="o">{</span>    
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>                                          
</span></span><span class="line"><span class="cl">    <span class="o">}</span>                                                         
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>                                             
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                             
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>onInterceptTouchEvent</em>方法比较简单，if条件第一个判断触摸事件是否来自鼠标设备；第二个判断触摸事件的类型是否是ACTION_DOWN；第三个检查是否按下了鼠标按键；第四个判断触摸位置是否在滚动条上。在大多数情况下if条件不会成立，也就是可以认为默认情况下<em>onInterceptTouchEvent</em>方法返回false。</p>
<p>如果通过<em>requestDisallowInterceptTouchEvent</em>方法设置<em>FLAG_DISALLOW_INTERCEPT</em>标志位，此时<em>disallowIntercept</em>为<em>true</em>，那么就不满足<em>if</em>(!<em>disallowIntercept</em>)条件了，所以不会再调用<em>onInterceptTouchEvent</em>方法，而是走的<em>else</em>逻辑，从而进入分析3.1.2，将<em>intercepted</em>赋值为false。</p>
<p><em><strong>注意：FLAG_DISALLOW_INTERCEPT一旦设置后，ViewGroup将无法拦截除了ACTION_DOWN以外的其他点击事件。</strong></em></p>
<p>为什么？</p>
<p>因为前面说过，<em>ViewGroup</em>在分发事件时，如果是<em>ACTION_DOWN</em>就会重置<em>FLAG_DISALLOW_INTERCEPT</em>这个标记位，将导致子<em>View</em>中设置的这个标记位无效。当面对<em>ACTION_DOWN</em>事件时，<em>ViewGroup</em>总是会调用自己的<em>onInterceptTouchEvent</em>方法来询问自己是否要拦截事件。因此，子<em>View</em>调用<em>requestDisallowInterceptTouchEvent</em>方法并不能影响<em>ViewGroup</em>对<em>ACTION_DOWN</em>事件的处理。</p>
<ul>
<li><em><strong>如果if判断为false</strong></em></li>
</ul>
<p>如果<em>ViewGroup</em>拦截事件，那么子<em>View</em>就无法获得事件，当<em>ACTION_MOVE</em>和<em>ACTION_UP</em>事件到来时，由于(<em>actionMasked</em> == <em>MotionEvent.ACTION_DOWN</em> ||<em>mFirstTouchTarget</em> ! = <em>null</em>)这个条件为<em>false</em>，将导致<em>ViewGroup</em>的<em>onInterceptTouchEvent</em>不会再被调用，然后走的是<em>else</em>逻辑，也就是进入分析3.2，将<em>intercepted</em>赋值为<em>true</em>。</p>
<p>到这里，我们已经知道，<em>intercepted</em>的值如果为<em>true</em>，表示<em>ViewGroup</em>要拦截事件，反之不拦截，接下来，继续看<em>ViewGroup</em>的不拦截事件的逻辑，剩余的<em>dispatchTouchEvent</em>方法代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.ViewGroup
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>                                                                                                               
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">dispatchTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> <span class="o">{</span>                                                                     
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ...                                                                                                                    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">boolean</span> <span class="n">handled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                                                                                            
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">onFilterTouchEventForSecurity</span><span class="o">(</span><span class="n">ev</span><span class="o">))</span> <span class="o">{</span>                                                                            
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ...                                                                                                  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Check for cancelation.                                                                                       
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">canceled</span> <span class="o">=</span> <span class="n">resetCancelNextUpFlag</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>                                                            
</span></span><span class="line"><span class="cl">                <span class="o">||</span> <span class="n">actionMasked</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_CANCEL</span><span class="o">;</span>                                                           
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Update list of touch targets for pointer down, if needed.                                                    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">isMouseEvent</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="na">getSource</span><span class="o">()</span> <span class="o">==</span> <span class="n">InputDevice</span><span class="o">.</span><span class="na">SOURCE_MOUSE</span><span class="o">;</span>                                        
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">split</span> <span class="o">=</span> <span class="o">(</span><span class="n">mGroupFlags</span> <span class="o">&amp;</span> <span class="n">FLAG_SPLIT_MOTION_EVENTS</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span>                                             
</span></span><span class="line"><span class="cl">                <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isMouseEvent</span><span class="o">;</span>                                                                                       
</span></span><span class="line"><span class="cl">        <span class="n">TouchTarget</span> <span class="n">newTouchTarget</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>                                                                              
</span></span><span class="line"><span class="cl">        <span class="kt">boolean</span> <span class="n">alreadyDispatchedToNewTouchTarget</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                                                             
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">canceled</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">intercepted</span><span class="o">)</span> <span class="o">{</span>                                                                                
</span></span><span class="line"><span class="cl">            <span class="c1">// If the event is targeting accessibility focus we give it to the                                          
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// view that has accessibility focus and if it does not handle it                                           
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// we clear the flag and dispatch the event to all children as usual.                                       
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// We are looking up the accessibility focused host to avoid keeping                                        
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// state since these events are very rare.                                                                  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">View</span> <span class="n">childWithAccessibilityFocus</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="na">isTargetAccessibilityFocus</span><span class="o">()</span>                                          
</span></span><span class="line"><span class="cl">                    <span class="o">?</span> <span class="n">findChildWithAccessibilityFocus</span><span class="o">()</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>                                                         
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">actionMasked</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span>                                                                 
</span></span><span class="line"><span class="cl">                    <span class="o">||</span> <span class="o">(</span><span class="n">split</span> <span class="o">&amp;&amp;</span> <span class="n">actionMasked</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_POINTER_DOWN</span><span class="o">)</span>                                       
</span></span><span class="line"><span class="cl">                    <span class="o">||</span> <span class="n">actionMasked</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_HOVER_MOVE</span><span class="o">)</span> <span class="o">{</span>                                                 
</span></span><span class="line"><span class="cl">                <span class="kd">final</span> <span class="kt">int</span> <span class="n">actionIndex</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="na">getActionIndex</span><span class="o">();</span> <span class="c1">// always 0 for down                                       
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kd">final</span> <span class="kt">int</span> <span class="n">idBitsToAssign</span> <span class="o">=</span> <span class="n">split</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ev</span><span class="o">.</span><span class="na">getPointerId</span><span class="o">(</span><span class="n">actionIndex</span><span class="o">)</span>                                    
</span></span><span class="line"><span class="cl">                        <span class="o">:</span> <span class="n">TouchTarget</span><span class="o">.</span><span class="na">ALL_POINTER_IDS</span><span class="o">;</span>                                                                  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// Clean up earlier touch targets for this pointer id in case they                                      
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// have become out of sync.                                                                             
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">removePointersFromTouchTargets</span><span class="o">(</span><span class="n">idBitsToAssign</span><span class="o">);</span>                                                         
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="kd">final</span> <span class="kt">int</span> <span class="n">childrenCount</span> <span class="o">=</span> <span class="n">mChildrenCount</span><span class="o">;</span>                                                               
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">newTouchTarget</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">childrenCount</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>                                                     
</span></span><span class="line"><span class="cl">                    <span class="kd">final</span> <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span>                                                                                     
</span></span><span class="line"><span class="cl">                            <span class="n">isMouseEvent</span> <span class="o">?</span> <span class="n">ev</span><span class="o">.</span><span class="na">getXCursorPosition</span><span class="o">()</span> <span class="o">:</span> <span class="n">ev</span><span class="o">.</span><span class="na">getX</span><span class="o">(</span><span class="n">actionIndex</span><span class="o">);</span>                              
</span></span><span class="line"><span class="cl">                    <span class="kd">final</span> <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span>                                                                                     
</span></span><span class="line"><span class="cl">                            <span class="n">isMouseEvent</span> <span class="o">?</span> <span class="n">ev</span><span class="o">.</span><span class="na">getYCursorPosition</span><span class="o">()</span> <span class="o">:</span> <span class="n">ev</span><span class="o">.</span><span class="na">getY</span><span class="o">(</span><span class="n">actionIndex</span><span class="o">);</span>                              
</span></span><span class="line"><span class="cl">                    <span class="c1">// Find a child that can receive the event.                                                         
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="c1">// Scan children from front to back.                                                                
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="kd">final</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">View</span><span class="o">&gt;</span> <span class="n">preorderedList</span> <span class="o">=</span> <span class="n">buildTouchDispatchChildList</span><span class="o">();</span>                               
</span></span><span class="line"><span class="cl">                    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">customOrder</span> <span class="o">=</span> <span class="n">preorderedList</span> <span class="o">==</span> <span class="kc">null</span>                                                  
</span></span><span class="line"><span class="cl">                            <span class="o">&amp;&amp;</span> <span class="n">isChildrenDrawingOrderEnabled</span><span class="o">();</span>                                                         
</span></span><span class="line"><span class="cl">                    <span class="kd">final</span> <span class="n">View</span><span class="o">[]</span> <span class="n">children</span> <span class="o">=</span> <span class="n">mChildren</span><span class="o">;</span>                                                                  
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">childrenCount</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>                                                      
</span></span><span class="line"><span class="cl">                        <span class="kd">final</span> <span class="kt">int</span> <span class="n">childIndex</span> <span class="o">=</span> <span class="n">getAndVerifyPreorderedIndex</span><span class="o">(</span>                                             
</span></span><span class="line"><span class="cl">                                <span class="n">childrenCount</span><span class="o">,</span> <span class="n">i</span><span class="o">,</span> <span class="n">customOrder</span><span class="o">);</span>                                                         
</span></span><span class="line"><span class="cl">                        <span class="kd">final</span> <span class="n">View</span> <span class="n">child</span> <span class="o">=</span> <span class="n">getAndVerifyPreorderedView</span><span class="o">(</span>                                                  
</span></span><span class="line"><span class="cl">                                <span class="n">preorderedList</span><span class="o">,</span> <span class="n">children</span><span class="o">,</span> <span class="n">childIndex</span><span class="o">);</span>                                                  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="c1">// If there is a view that has accessibility focus we want it                                   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="c1">// to get the event first and if not handled we will perform a                                  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="c1">// normal dispatch. We may do a double iteration but this is                                    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="c1">// safer given the timeframe.                                                                   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="k">if</span> <span class="o">(</span><span class="n">childWithAccessibilityFocus</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                                      
</span></span><span class="line"><span class="cl">                            <span class="k">if</span> <span class="o">(</span><span class="n">childWithAccessibilityFocus</span> <span class="o">!=</span> <span class="n">child</span><span class="o">)</span> <span class="o">{</span>                                                 
</span></span><span class="line"><span class="cl">                                <span class="k">continue</span><span class="o">;</span>                                                                               
</span></span><span class="line"><span class="cl">                            <span class="o">}</span>                                                                                           
</span></span><span class="line"><span class="cl">                            <span class="n">childWithAccessibilityFocus</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>                                                         
</span></span><span class="line"><span class="cl">                            <span class="n">i</span> <span class="o">=</span> <span class="n">childrenCount</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>                                                                      
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>                                                                                               
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="o">(!</span><span class="n">child</span><span class="o">.</span><span class="na">canReceivePointerEvents</span><span class="o">()</span>                                                            
</span></span><span class="line"><span class="cl">                                <span class="o">||</span> <span class="o">!</span><span class="n">isTransformedTouchPointInView</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">child</span><span class="o">,</span> <span class="kc">null</span><span class="o">))</span> <span class="o">{</span>                                 
</span></span><span class="line"><span class="cl">                            <span class="n">ev</span><span class="o">.</span><span class="na">setTargetAccessibilityFocus</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>                                                      
</span></span><span class="line"><span class="cl">                            <span class="k">continue</span><span class="o">;</span>                                                                                   
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>                                                                                               
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="n">newTouchTarget</span> <span class="o">=</span> <span class="n">getTouchTarget</span><span class="o">(</span><span class="n">child</span><span class="o">);</span>                                                         
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="o">(</span><span class="n">newTouchTarget</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                                                   
</span></span><span class="line"><span class="cl">                            <span class="c1">// Child is already receiving touch within its bounds.                                      
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="c1">// Give it the new pointer in addition to the ones it is handling.                          
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="n">newTouchTarget</span><span class="o">.</span><span class="na">pointerIdBits</span> <span class="o">|=</span> <span class="n">idBitsToAssign</span><span class="o">;</span>                                             
</span></span><span class="line"><span class="cl">                            <span class="k">break</span><span class="o">;</span>                                                                                      
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>                                                                                               
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="n">resetCancelNextUpFlag</span><span class="o">(</span><span class="n">child</span><span class="o">);</span>                                                                   
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="o">(</span><span class="n">dispatchTransformedTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">child</span><span class="o">,</span> <span class="n">idBitsToAssign</span><span class="o">))</span> <span class="o">{</span>                          
</span></span><span class="line"><span class="cl">                            <span class="c1">// Child wants to receive touch within its bounds.                                          
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="n">mLastTouchDownTime</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="na">getDownTime</span><span class="o">();</span>                                                      
</span></span><span class="line"><span class="cl">                            <span class="k">if</span> <span class="o">(</span><span class="n">preorderedList</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                                               
</span></span><span class="line"><span class="cl">                                <span class="c1">// childIndex points into presorted list, find original index                           
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">childrenCount</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>                                               
</span></span><span class="line"><span class="cl">                                    <span class="k">if</span> <span class="o">(</span><span class="n">children</span><span class="o">[</span><span class="n">childIndex</span><span class="o">]</span> <span class="o">==</span> <span class="n">mChildren</span><span class="o">[</span><span class="n">j</span><span class="o">])</span> <span class="o">{</span>                                         
</span></span><span class="line"><span class="cl">                                        <span class="n">mLastTouchDownIndex</span> <span class="o">=</span> <span class="n">j</span><span class="o">;</span>                                                        
</span></span><span class="line"><span class="cl">                                        <span class="k">break</span><span class="o">;</span>                                                                          
</span></span><span class="line"><span class="cl">                                    <span class="o">}</span>                                                                                   
</span></span><span class="line"><span class="cl">                                <span class="o">}</span>                                                                                       
</span></span><span class="line"><span class="cl">                            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>                                                                                    
</span></span><span class="line"><span class="cl">                                <span class="n">mLastTouchDownIndex</span> <span class="o">=</span> <span class="n">childIndex</span><span class="o">;</span>                                                       
</span></span><span class="line"><span class="cl">                            <span class="o">}</span>                                                                                           
</span></span><span class="line"><span class="cl">                            <span class="n">mLastTouchDownX</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>                                                                
</span></span><span class="line"><span class="cl">                            <span class="n">mLastTouchDownY</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>                                                                
</span></span><span class="line"><span class="cl">                            <span class="n">newTouchTarget</span> <span class="o">=</span> <span class="n">addTouchTarget</span><span class="o">(</span><span class="n">child</span><span class="o">,</span> <span class="n">idBitsToAssign</span><span class="o">);</span>                                     
</span></span><span class="line"><span class="cl">                            <span class="n">alreadyDispatchedToNewTouchTarget</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>                                                   
</span></span><span class="line"><span class="cl">                            <span class="k">break</span><span class="o">;</span>                                                                                      
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>                                                                                               
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="c1">// The accessibility focus didn&#39;t handle the event, so clear                                    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="c1">// the flag and do a normal dispatch to all children.                                           
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="n">ev</span><span class="o">.</span><span class="na">setTargetAccessibilityFocus</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>                                                          
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>                                                                                                   
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="o">(</span><span class="n">preorderedList</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">preorderedList</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>                                                 
</span></span><span class="line"><span class="cl">                <span class="o">}</span>                                                                                                       
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">newTouchTarget</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">mFirstTouchTarget</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                              
</span></span><span class="line"><span class="cl">                    <span class="c1">// Did not find a child to receive the event.                                                       
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="c1">// Assign the pointer to the least recently added target.                                           
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">newTouchTarget</span> <span class="o">=</span> <span class="n">mFirstTouchTarget</span><span class="o">;</span>                                                                 
</span></span><span class="line"><span class="cl">                    <span class="k">while</span> <span class="o">(</span><span class="n">newTouchTarget</span><span class="o">.</span><span class="na">next</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                                               
</span></span><span class="line"><span class="cl">                        <span class="n">newTouchTarget</span> <span class="o">=</span> <span class="n">newTouchTarget</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>                                                           
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>                                                                                                   
</span></span><span class="line"><span class="cl">                    <span class="n">newTouchTarget</span><span class="o">.</span><span class="na">pointerIdBits</span> <span class="o">|=</span> <span class="n">idBitsToAssign</span><span class="o">;</span>                                                     
</span></span><span class="line"><span class="cl">                <span class="o">}</span>                                                                                                       
</span></span><span class="line"><span class="cl">            <span class="o">}</span>                                                                                                           
</span></span><span class="line"><span class="cl">        <span class="o">}</span> 
</span></span><span class="line"><span class="cl">    <span class="o">}</span>   
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                                                          
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果不是<em>ACTION_CANCEL</em>事件或者<em>ViewGroup</em>不拦截事件时，倒叙遍历子<em>View</em>，然后调用<em>dispatchTransformedTouchEvent</em>方法进行分发事件，注意该方法第三个参数<em>child</em>，此时<em>child</em>不为<em>null</em>，继续看<em>dispatchTransformedTouchEvent</em>方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.ViewGroup
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">dispatchTransformedTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">cancel</span><span class="o">,</span>             
</span></span><span class="line"><span class="cl">        <span class="n">View</span> <span class="n">child</span><span class="o">,</span> <span class="kt">int</span> <span class="n">desiredPointerIdBits</span><span class="o">)</span> <span class="o">{</span>                                              
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">handled</span><span class="o">;</span>                                                                   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ...                                                                          
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Perform any necessary transformations and dispatch.                                   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">child</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                                                     
</span></span><span class="line"><span class="cl">        <span class="n">handled</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">dispatchTouchEvent</span><span class="o">(</span><span class="n">transformedEvent</span><span class="o">);</span>                                
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>                                                                                 
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="kt">float</span> <span class="n">offsetX</span> <span class="o">=</span> <span class="n">mScrollX</span> <span class="o">-</span> <span class="n">child</span><span class="o">.</span><span class="na">mLeft</span><span class="o">;</span>                                        
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="kt">float</span> <span class="n">offsetY</span> <span class="o">=</span> <span class="n">mScrollY</span> <span class="o">-</span> <span class="n">child</span><span class="o">.</span><span class="na">mTop</span><span class="o">;</span>                                         
</span></span><span class="line"><span class="cl">        <span class="n">transformedEvent</span><span class="o">.</span><span class="na">offsetLocation</span><span class="o">(</span><span class="n">offsetX</span><span class="o">,</span> <span class="n">offsetY</span><span class="o">);</span>                                   
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span> <span class="n">child</span><span class="o">.</span><span class="na">hasIdentityMatrix</span><span class="o">())</span> <span class="o">{</span>                                                   
</span></span><span class="line"><span class="cl">            <span class="n">transformedEvent</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">child</span><span class="o">.</span><span class="na">getInverseMatrix</span><span class="o">());</span>                            
</span></span><span class="line"><span class="cl">        <span class="o">}</span>                                                                                    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">handled</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="na">dispatchTouchEvent</span><span class="o">(</span><span class="n">transformedEvent</span><span class="o">);</span>                                
</span></span><span class="line"><span class="cl">    <span class="o">}</span>                                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Done.                                                                                 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">transformedEvent</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>                                                              
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">handled</span><span class="o">;</span>                                                                          
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                                            
</span></span></code></pre></td></tr></table>
</div>
</div><p>前面说过，此时<em>child</em>不为<em>null</em>，那么就会调用<em>child</em>的<em>dispatchTouchEvent</em>方法进行事件的分发，如果<em>child</em>的<em>dispatchTouchEvent</em>方法返回<em>true</em>，那么<em>if</em>(<em>dispatchTransformedTouchEvent</em>)条件成立，就会执行后面的<em>addTouchTarget</em>方法，给<em>mFirstTouchTarget</em>赋值，<em>addTouchTarget</em>方法代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.ViewGroup
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">TouchTarget</span> <span class="nf">addTouchTarget</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">View</span> <span class="n">child</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pointerIdBits</span><span class="o">)</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="n">TouchTarget</span> <span class="n">target</span> <span class="o">=</span> <span class="n">TouchTarget</span><span class="o">.</span><span class="na">obtain</span><span class="o">(</span><span class="n">child</span><span class="o">,</span> <span class="n">pointerIdBits</span><span class="o">);</span>     
</span></span><span class="line"><span class="cl">    <span class="n">target</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">mFirstTouchTarget</span><span class="o">;</span>                                         
</span></span><span class="line"><span class="cl">    <span class="n">mFirstTouchTarget</span> <span class="o">=</span> <span class="n">target</span><span class="o">;</span>                                              
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">target</span><span class="o">;</span>                                                           
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                            
</span></span></code></pre></td></tr></table>
</div>
</div><p>从上面的<em>addTouchTarget</em>方法的内部结构可以看出，<em>mFirstTouchTarget</em>其实是一种单链表结构。那么如果子元素的<em>dispatchTouchEvent</em>返回<em>false</em>，<em>ViewGroup</em>就会把事件分发给下一个子元素（如果还有下一个子元素的话）。</p>
<p>接下来，继续看<em>ViewGroup</em>拦截事件的逻辑，剩余的<em>dispatchTouchEvent</em>方法代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.ViewGroup
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>                                                                             
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">dispatchTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> <span class="o">{</span>                                   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="n">handled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                                                          
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">onFilterTouchEventForSecurity</span><span class="o">(</span><span class="n">ev</span><span class="o">))</span> <span class="o">{</span>                                          
</span></span><span class="line"><span class="cl">        <span class="c1">// ...                                                                        
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Dispatch to touch targets.                                                 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">mFirstTouchTarget</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                              
</span></span><span class="line"><span class="cl">            <span class="c1">// No touch targets so treat this as an ordinary view.                    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">handled</span> <span class="o">=</span> <span class="n">dispatchTransformedTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">,</span> <span class="n">canceled</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span>               
</span></span><span class="line"><span class="cl">                    <span class="n">TouchTarget</span><span class="o">.</span><span class="na">ALL_POINTER_IDS</span><span class="o">);</span>                                     
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>   
</span></span><span class="line"><span class="cl"><span class="err">        </span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="err">    </span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="err">    </span><span class="k">return</span> <span class="n">handled</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                   
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果遍历所有的子元素后事件都没有被合适地处理，这包含两种情况：第一种是<em>ViewGroup</em>没有子元素；第二种是子元素处理了点击事件，但是在<em>dispatchTouchEvent</em>中返回了<em>false</em>，这一般是因为子元素在<em>onTouchEvent</em>中返回了<em>false</em>。在这两种情况下，<em>ViewGroup</em>会自己处理点击事件。注意<em>dispatchTransformedTouchEvent</em>方法的第三个参数<em>child</em>，此时<em>child</em>为<em>null</em>，从前面的分析可以知道，它会调用<em>super.dispatchTouchEvent</em>(<em>event</em>)，很显然，这里就转到了<em>View</em>的<em>dispatchTouchEvent</em>方法，即点击事件开始交由<em>View</em>来处理。</p>
<h2 id="33view的事件分发过程">3.3、View的事件分发过程</h2>
<p>上面分析了<em>ViewGroup</em>的事件分发过程，可以知道，ViewGroup拦截事件后，让触摸事件的分发从<em>ViewGroup</em>流转到了<em>View</em>，那么继续看<em>View</em>的<em>dispatchTouchEvent</em>方法，这里省略了一些不重要的代码，剩余代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.View
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">dispatchTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>                                    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                                                               
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">onFilterTouchEventForSecurity</span><span class="o">(</span><span class="n">event</span><span class="o">))</span> <span class="o">{</span>                                           
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//noinspection SimplifiableIfStatement                                            
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ListenerInfo</span> <span class="n">li</span> <span class="o">=</span> <span class="n">mListenerInfo</span><span class="o">;</span>                                                  
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">li</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">li</span><span class="o">.</span><span class="na">mOnTouchListener</span> <span class="o">!=</span> <span class="kc">null</span>                                     
</span></span><span class="line"><span class="cl">                <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mViewFlags</span> <span class="o">&amp;</span> <span class="n">ENABLED_MASK</span><span class="o">)</span> <span class="o">==</span> <span class="n">ENABLED</span>                                 
</span></span><span class="line"><span class="cl">                <span class="o">&amp;&amp;</span> <span class="n">li</span><span class="o">.</span><span class="na">mOnTouchListener</span><span class="o">.</span><span class="na">onTouch</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">event</span><span class="o">))</span> <span class="o">{</span>                            
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>                                                                
</span></span><span class="line"><span class="cl">        <span class="o">}</span>                                                                                 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">result</span> <span class="o">&amp;&amp;</span> <span class="n">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">))</span> <span class="o">{</span>                                             
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>                                                                
</span></span><span class="line"><span class="cl">        <span class="o">}</span>                                                                                 
</span></span><span class="line"><span class="cl">    <span class="o">}</span>                                                                                                                                                                
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>                                                                        
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                                         
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到<em>View</em>的<em>dispatchTouchEvent</em>方法处理比较简单，首先会判断有没有设置<em>OnTouchListener</em>，如果<em>OnTouchListener</em>中的<em>onTouch</em>方法返回<em>true</em>，那么<em>onTouchEvent</em>就不会被调用，可见<em>OnTouchListener</em>的优先级高于<em>onTouchEvent</em>，如果没有设置<em>mOnTouchListener</em>监听器，或者<em>onTouch</em>方法返回<em>false</em>时，那么就会调用<em>View</em>的<em>onTouchEvent</em>方法，继续看<em>onTouchEvent</em>方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.View
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>                                                  
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>                                                                 
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>                                                                 
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">int</span> <span class="n">viewFlags</span> <span class="o">=</span> <span class="n">mViewFlags</span><span class="o">;</span>                                                             
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">int</span> <span class="n">action</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>                                                         
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">clickable</span> <span class="o">=</span> <span class="o">((</span><span class="n">viewFlags</span> <span class="o">&amp;</span> <span class="n">CLICKABLE</span><span class="o">)</span> <span class="o">==</span> <span class="n">CLICKABLE</span>                               
</span></span><span class="line"><span class="cl">            <span class="o">||</span> <span class="o">(</span><span class="n">viewFlags</span> <span class="o">&amp;</span> <span class="n">LONG_CLICKABLE</span><span class="o">)</span> <span class="o">==</span> <span class="n">LONG_CLICKABLE</span><span class="o">)</span>                                    
</span></span><span class="line"><span class="cl">            <span class="o">||</span> <span class="o">(</span><span class="n">viewFlags</span> <span class="o">&amp;</span> <span class="n">CONTEXT_CLICKABLE</span><span class="o">)</span> <span class="o">==</span> <span class="n">CONTEXT_CLICKABLE</span><span class="o">;</span>                              
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">((</span><span class="n">viewFlags</span> <span class="o">&amp;</span> <span class="n">ENABLED_MASK</span><span class="o">)</span> <span class="o">==</span> <span class="n">DISABLED</span>                                                    
</span></span><span class="line"><span class="cl">            <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mPrivateFlags4</span> <span class="o">&amp;</span> <span class="n">PFLAG4_ALLOW_CLICK_WHEN_DISABLED</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>                        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">action</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mPrivateFlags</span> <span class="o">&amp;</span> <span class="n">PFLAG_PRESSED</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>            
</span></span><span class="line"><span class="cl">            <span class="n">setPressed</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>                                                                    
</span></span><span class="line"><span class="cl">        <span class="o">}</span>                                                                                         
</span></span><span class="line"><span class="cl">        <span class="n">mPrivateFlags3</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PFLAG3_FINGER_DOWN</span><span class="o">;</span>                                                    
</span></span><span class="line"><span class="cl">        <span class="c1">// A disabled view that is clickable still consumes the touch                             
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// events, it just doesn&#39;t respond to them.                                               
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">clickable</span><span class="o">;</span>                                                                         
</span></span><span class="line"><span class="cl">    <span class="o">}</span>                                                                                             
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">mTouchDelegate</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                                                 
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">mTouchDelegate</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">))</span> <span class="o">{</span>                                                 
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>                                                                          
</span></span><span class="line"><span class="cl">        <span class="o">}</span>                                                                                         
</span></span><span class="line"><span class="cl">    <span class="o">}</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                                                                                                                                        
</span></span></code></pre></td></tr></table>
</div>
</div><p>从上面代码可以知道，<em>View</em>处于不可用时依然会消耗事件。如果<em>View</em>设置有代理，那么还会执行<em>TouchDelegate</em>的<em>onTouchEvent</em>方法。好了，继续看<em>onTouchEvent</em>对事件的处理，剩余代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.View
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>                                                    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">clickable</span> <span class="o">||</span> <span class="o">(</span><span class="n">viewFlags</span> <span class="o">&amp;</span> <span class="n">TOOLTIP</span><span class="o">)</span> <span class="o">==</span> <span class="n">TOOLTIP</span><span class="o">)</span> <span class="o">{</span>                                            
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="o">(</span><span class="n">action</span><span class="o">)</span> <span class="o">{</span>                                                                           
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span><span class="o">:</span>                                                             
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="kt">boolean</span> <span class="n">prepressed</span> <span class="o">=</span> <span class="o">(</span><span class="n">mPrivateFlags</span> <span class="o">&amp;</span> <span class="n">PFLAG_PREPRESSED</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">;</span>                       
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">((</span><span class="n">mPrivateFlags</span> <span class="o">&amp;</span> <span class="n">PFLAG_PRESSED</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">prepressed</span><span class="o">)</span> <span class="o">{</span>                                                                                                      
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="o">(!</span><span class="n">mHasPerformedLongPress</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mIgnoreNextUpEvent</span><span class="o">)</span> <span class="o">{</span>                           
</span></span><span class="line"><span class="cl">                        <span class="c1">// This is a tap, so remove the longpress check                             
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="n">removeLongPressCallback</span><span class="o">();</span>                                                  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="c1">// Only perform take click actions if we were in the pressed state          
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="k">if</span> <span class="o">(!</span><span class="n">focusTaken</span><span class="o">)</span> <span class="o">{</span>                                                          
</span></span><span class="line"><span class="cl">                            <span class="c1">// Use a Runnable and post this rather than calling                     
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="c1">// performClick directly. This lets other visual state                  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="c1">// of the view update before click actions start.                       
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="k">if</span> <span class="o">(</span><span class="n">mPerformClick</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                            
</span></span><span class="line"><span class="cl">                                <span class="n">mPerformClick</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PerformClick</span><span class="o">();</span>                                 
</span></span><span class="line"><span class="cl">                            <span class="o">}</span>                                                                       
</span></span><span class="line"><span class="cl">                            <span class="k">if</span> <span class="o">(!</span><span class="n">post</span><span class="o">(</span><span class="n">mPerformClick</span><span class="o">))</span> <span class="o">{</span>                                             
</span></span><span class="line"><span class="cl">                                <span class="n">performClickInternal</span><span class="o">();</span>                                             
</span></span><span class="line"><span class="cl">                            <span class="o">}</span>                                                                       
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>                                                                           
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>                                                                                                                                        
</span></span><span class="line"><span class="cl">                <span class="o">}</span>                                                                                   
</span></span><span class="line"><span class="cl">                <span class="n">mIgnoreNextUpEvent</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                                                         
</span></span><span class="line"><span class="cl">                <span class="k">break</span><span class="o">;</span>                                                                                                                                                                                                                                                                                                                                                                                                                  
</span></span><span class="line"><span class="cl">        <span class="o">}</span>                                                                                                                                                                                               
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>                                                                                
</span></span><span class="line"><span class="cl">    <span class="o">}</span>                    
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>  
</span></span><span class="line"><span class="cl"> <span class="o">}</span>                                                                                                                 
</span></span></code></pre></td></tr></table>
</div>
</div><p>只要<em>View</em>满足<em>clickable</em>，当<em>ACTION_UP</em>事件发生时，最终会触发<em>performClick</em>方法，如果<em>View</em>设置了<em>OnClickListener</em>，那么<em>performClick</em>方法内部会调用它的<em>onClick</em>方法，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// android.view.View
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">performClick</span><span class="o">()</span> <span class="o">{</span>                                     
</span></span><span class="line"><span class="cl">    <span class="c1">// We still need to call this method to handle the cases where p
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// externally, instead of through performClickInternal()        
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">notifyAutofillManagerOnClick</span><span class="o">();</span>                                 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">result</span><span class="o">;</span>                                           
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="n">ListenerInfo</span> <span class="n">li</span> <span class="o">=</span> <span class="n">mListenerInfo</span><span class="o">;</span>                          
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">li</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">li</span><span class="o">.</span><span class="na">mOnClickListener</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                
</span></span><span class="line"><span class="cl">        <span class="n">playSoundEffect</span><span class="o">(</span><span class="n">SoundEffectConstants</span><span class="o">.</span><span class="na">CLICK</span><span class="o">);</span>                
</span></span><span class="line"><span class="cl">        <span class="n">li</span><span class="o">.</span><span class="na">mOnClickListener</span><span class="o">.</span><span class="na">onClick</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>                          
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>                                              
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>                                                        
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                                             
</span></span><span class="line"><span class="cl">    <span class="o">}</span>                                                               
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sendAccessibilityEvent</span><span class="o">(</span><span class="n">AccessibilityEvent</span><span class="o">.</span><span class="na">TYPE_VIEW_CLICKED</span><span class="o">);</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">notifyEnterOrExitForAutoFillIfNeeded</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>                     
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>                                                  
</span></span><span class="line"><span class="cl"><span class="o">}</span>                                                                   
</span></span></code></pre></td></tr></table>
</div>
</div><p>至此，事件分发机制的源码就分析完成了。</p>
<h1 id="四解决开发中常见的滑动冲突">四、解决开发中常见的滑动冲突</h1>
<p>经过前面理论知识的准备，下面就要进入解决开发中常见的滑动冲突的实战环节。</p>
<h2 id="41常见的滑动冲突场景处理思路">4.1、常见的滑动冲突场景&amp;处理思路</h2>
<p>当内外两层View都可以滑动的时候，就会产生滑动冲突，常见的滑动冲突场景如下图所示：</p>
<img title="" src="/img/android/Android事件分发机制/常见的滑动冲突场景.png" alt="" width="535" />
<ul>
<li>场景一：外部滑动方向和内部滑动方向不一致</li>
</ul>
<p>此种场景可以根据当前滑动方向是横向还是纵向来判断事件到底该交给谁来处理。</p>
<p>那滑动方向怎么判断呢？</p>
<p>在滑动过程中会有两个点的坐标，通过两个点的坐标就可以计算手指的移动距离，如图所示：</p>
<img title="" src="/img/android/Android事件分发机制/手指的距离.png" alt="" width="535" />
<p>手指移动后横向距离变化为<em>dx</em>，纵向距离变化为<em>dy</em>，如果<em>dx</em>＞<em>dy</em>，那么此次滑动就算作横向滑动；相反，则认为此次滑动是纵向滑动。</p>
<ul>
<li>场景二：外部滑动方向和内部滑动方向不致</li>
</ul>
<p>当内外两层都在同一个方向可以滑动的时候，显然存在逻辑问题。因为当手指开始滑动的时候，系统无法知道用户到底是想让哪一层滑动，所以当手指滑动的时候就会出现问题，要么只有一层能滑动，要么就是内外两层都滑动得很卡顿。</p>
<p>这种得根据业务需求，通过下面的拦截与禁止拦截的方法，决定在什么情况下滑动哪个<em>View</em>。</p>
<ul>
<li>场景三：上面两种情况的嵌套</li>
</ul>
<p>上面图中没放出来，是场景一和场景二都存在的情况，也就是它们之间互相嵌套，或者多层嵌套，然而不管多么复杂，解决思路都是一毛一样的，按照上面提的解决思路一层一层处理即可。</p>
<h2 id="42解决滑动冲突的办法">4.2、解决滑动冲突的办法</h2>
<h3 id="421外部拦截法">4.2.1、外部拦截法</h3>
<p>所谓外部拦截法是指点击事情都先经过父容器的拦截处理，如果父容器需要此事件就拦截，如果不需要此事件就不拦截，这样就可以解决滑动冲突的问题。</p>
<p>外部拦截法需要重写父容器的<em>onInterceptTouchEvent</em>方法，在内部做相应的拦截即可，这种方法的伪代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">):</span> <span class="n">Boolean</span> <span class="p">{</span>           
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="py">intercepted</span> <span class="p">=</span> <span class="k">super</span><span class="p">.</span><span class="n">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>                    
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                                   
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>                                                                             
</span></span><span class="line"><span class="cl">            <span class="n">intercepted</span> <span class="p">=</span> <span class="k">false</span>                                          
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                                     
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">父控件需要当前点击事件</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">              <span class="n">intercepted</span> <span class="p">=</span> <span class="k">true</span>      
</span></span><span class="line"><span class="cl">            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">intercepted</span> <span class="p">=</span> <span class="k">false</span>        
</span></span><span class="line"><span class="cl">            <span class="p">}</span>                         
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_UP</span>   <span class="o">-&gt;</span> <span class="p">{</span>                                     
</span></span><span class="line"><span class="cl">            <span class="n">intercepted</span> <span class="p">=</span> <span class="k">false</span>                                          
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                                    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">intercepted</span>                                                   
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                                                                         
</span></span></code></pre></td></tr></table>
</div>
</div><p>解释下上面代码，在<em>onInterceptTouchEvent</em>方法中，首先是<em>ACTION_DOWN</em>这个事件，父容器必须返回<em>false</em>，即不拦截<em>ACTION_DOWN</em>事件，这是因为一旦父容器拦截了<em>ACTION_DOWN</em>，那么后续的<em>ACTION_MOVE</em>和<em>ACTION_UP</em>事件都会直接交由父容器处理，这个时候事件没法再传递给子元素了；</p>
<p>其次是<em>ACTION_MOVE</em>事件，这个事件可以根据需要来决定是否拦截，如果父容器需要拦截就返回<em>true</em>，否则返回<em>false</em>；</p>
<p>最后是<em>ACTION_UP</em>事件，这里必须要返回<em>false</em>，因为<em>ACTION_UP</em>事件本身没有太多意义。考虑一种情况，假设事件交由子元素处理，如果父容器在<em>ACTION_UP</em>时返回了<em>true</em>，就会导致子元素无法接收到<em>ACTION_UP</em>事件，这个时候子元素中的<em>onClick</em>事件就无法触发，但是父容器比较特殊，一旦它开始拦截任何一个事件，那么后续的事件都会交给它来处理，而<em>ACTION_UP</em>作为最后一个事件也必定可以传递给父容器，即便父容器的<em>onInterceptTouchEvent</em>方法在<em>ACTION_UP</em>时返回了<em>false</em>。</p>
<h3 id="422内部拦截法">4.2.2、内部拦截法</h3>
<p>内部拦截法是指父容器不拦截任何事件，所有的事件都传递给子元素，如果子元素需要此事件就直接消耗掉，否则就交由父容器进行处理，需要配合<em>requestDisallowInterceptTouchEvent</em>方法才能正常工作，这种方法的伪代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">):</span> <span class="n">Boolean</span> <span class="p">{</span>                              
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>                                                                   
</span></span><span class="line"><span class="cl">        <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>                                                        
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">自己需要当前点击事件</span><span class="p">){</span>                                                                 
</span></span><span class="line"><span class="cl">                <span class="n">parent</span><span class="p">.</span><span class="n">requestDisallowInterceptTouchEvent</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>                             
</span></span><span class="line"><span class="cl">            <span class="p">}</span><span class="k">else</span><span class="p">{</span>                                                                          
</span></span><span class="line"><span class="cl">                <span class="n">parent</span><span class="p">.</span><span class="n">requestDisallowInterceptTouchEvent</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>                            
</span></span><span class="line"><span class="cl">            <span class="p">}</span>                                                                               
</span></span><span class="line"><span class="cl">        <span class="p">}</span>                                                                                   
</span></span><span class="line"><span class="cl">    <span class="p">}</span>                                                                                       
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">dispatchTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>                                                  
</span></span><span class="line"><span class="cl"><span class="p">}</span>                                                                                           
</span></span></code></pre></td></tr></table>
</div>
</div><p>解释下上面代码，我留意到一些文章中会写到在子控件的<em>ACTION_DOWN</em>消息中使用<em>getParent</em>().<em>requestDisallowInterceptTouchEvent</em>(<em>true</em>)；，这是无效的，因为如果父控件拦截了<em>ACTION_DOWN</em>消息，则这里写的函数根本不会执行。</p>
<h2 id="43滑动冲突实战">4.3、滑动冲突实战</h2>
<p>先上布局文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;layout</span> <span class="na">xmlns:android=</span><span class="s">&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">xmlns:app=</span><span class="s">&#34;http://schemas.android.com/apk/res-auto&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;data&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/data&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;androidx.core.widget.NestedScrollView</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;androidx.appcompat.widget.AppCompatEditText</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:id=</span><span class="s">&#34;@+id/edit_text&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:layout_height=</span><span class="s">&#34;@dimen/edit_text_height&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:text=</span><span class="s">&#34;@string/edit_text_content&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;View</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:layout_height=</span><span class="s">&#34;1000dp&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:background=</span><span class="s">&#34;@color/teal_200&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:gravity=</span><span class="s">&#34;center&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">&#34;@id/edit_text&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/androidx.core.widget.NestedScrollView&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/layout&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面是一个<em>EditText</em>，但是这个<em>EditText</em>的内容超出了显示区域，所以它的内容是可以上下滑动的，下面是一个<em>View</em>，高度给得非常大，用来支撑外部的<em>NestedScrollView</em>足够可以滑动，因为<em>NestedScrollView</em>也可以上下滑动，由于双方都可以上下滑动，导致冲突了，运行效果图如下：</p>
<img title="" src="/img/android/Android事件分发机制/滑动冲突.gif" alt="" width="335" />
<p>可以看到，在没有处理滑动冲突，在<em>EditText</em>向上滑动时，依然是整体<em>NestedScrollView</em>在滑动，这属于常见的滑动冲突场景里的情况二了，<em>OK</em>，下面就来解决冲突。</p>
<ul>
<li>用外部拦截法解决滑动冲突问题</li>
</ul>
<p>使用外部拦截法来解决滑动冲突问题的话，需要重写<em>NestedScrollView</em>，它的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyNestedScrollView</span> <span class="p">:</span> <span class="n">NestedScrollView</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">doInit</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">:</span> <span class="n">AttributeSet</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">doInit</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">:</span> <span class="n">AttributeSet</span><span class="p">?,</span>
</span></span><span class="line"><span class="cl">        <span class="n">defStyleAttr</span><span class="p">:</span> <span class="n">Int</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">defStyleAttr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">doInit</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">var</span> <span class="py">editTextHeight</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">doInit</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">editTextHeight</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="p">.</span><span class="n">resources</span><span class="p">.</span><span class="n">getDimensionPixelSize</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">dimen</span><span class="p">.</span><span class="n">edit_text_height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">var</span> <span class="py">downY</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">):</span> <span class="n">Boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">intercepted</span> <span class="p">=</span> <span class="k">super</span><span class="p">.</span><span class="n">onInterceptTouchEvent</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">when</span> <span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_DOWN</span> <span class="o">-&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">downY</span> <span class="p">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">y</span><span class="p">.</span><span class="n">toInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">intercepted</span> <span class="p">=</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">intercepted</span> <span class="p">=</span> <span class="n">downY</span> <span class="p">&gt;</span> <span class="n">editTextHeight</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_UP</span>   <span class="o">-&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">intercepted</span> <span class="p">=</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">intercepted</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>解释下上面代码，因为<em>EditText</em>的高度是固定的，在这个高度之前触摸的位置都是<em>EditText</em>的内容区域，此时让<em>NestedScrollView</em>不要拦截事件，在这个内容区域值之外的位置，让<em>NestedScrollView</em>拦截事件。</p>
<p>可以看到，在使用外部拦截法时，需要提前知道不拦截消息的区域，这样才能做好消息处理，所以也只有在子控件的位置和大小是固定的并且能获取到的情况下，外部拦截法才是有用的。</p>
<p>将自定义的<em>MyNestedScrollView</em>替换布局文件里的<em>NestedScrollView</em>即可，运行后效果如下：</p>
<img title="" src="/img/android/Android事件分发机制/解决滑动冲突.gif" alt="" width="335" />
<ul>
<li>用内部拦截法解决滑动冲突问题</li>
</ul>
<p>使用内部拦截法来解决滑动冲突问题的话，需要重写<em>EditText</em>，它的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyEditText</span> <span class="p">:</span> <span class="n">AppCompatEditText</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">:</span> <span class="n">AttributeSet</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">:</span> <span class="n">AttributeSet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">defStyleAttr</span><span class="p">:</span> <span class="n">Int</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">defStyleAttr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">dispatchTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">):</span> <span class="n">Boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nc">MotionEvent</span><span class="p">.</span><span class="n">ACTION_MOVE</span> <span class="o">-&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">parent</span><span class="p">.</span><span class="n">requestDisallowInterceptTouchEvent</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="n">dispatchTouchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为在<em>ACTION_MOVE</em>消息到来时，<em>EditText</em>需要自己处理消息，所以这里并没有内部拦截法中判断是否需要该事件的if（自己需要这类点击事件）代码。</p>
<p>将自定义的<em>MyEditText</em>替换布局文件里的<em>EditText</em>即可，运行后效果同用外部拦截法解决滑动冲突。</p>
<blockquote>
<p>本文源码地址： <a href="https://github.com/AndDevMK/AndroidEventDispatch"><em>AndroidEventDispatch</em></a></p>
</blockquote>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">AndDevMK</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2023-06-23
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="/img/reward/wechat-qr-code.JPG">
        <span>微信打赏</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="/img/reward/alipay-qr-code.JPG">
        <span>支付宝打赏</span>
      </label>
  </div>
</div><footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/%E8%A7%A3%E8%AF%BBkotlin%E5%8D%8F%E7%A8%8B%E5%90%AF%E5%8A%A8%E6%BA%90%E7%A0%81/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">解读Kotlin协程启动源码</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/android%E8%A7%A3%E6%9E%90xml%E6%95%B0%E6%8D%AE/">
            <span class="next-text nav-default">Android解析XML数据</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="AndDevMK/blog-utterances"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    
    <div id="search_mask" class="search_mask">
    <div class="search_modal">
        <div id="close_search" class="close_search">关闭</div>
        <div class="search_divider"></div>
        <input id="input_search_key" class="input_search_key" placeholder="请输入你要搜索的内容" tabindex="0">
        <ul id="search_list">
        </ul>
    </div>
</div>

<script src="/js/fuse.js"></script> 
<script src="/js/fastsearch.js"></script>

    <footer id="footer" class="footer">
      

<div class="copyright">
  <span class="power-by">
    由 <a id="hexo-link" class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    
    <span id="run-time" class="run-time"></span> 
    <span class="heart"><i class="iconfont icon-heart"></i></span>
    &copy; 
    2023&nbsp;
    <span>AndDevMK</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.11a4ba15caf2d921d57eaf6568c4ad21eafd5d2c001cbcb31693586c63f93005.js"></script>

<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?6db179fb88e600cf326b0515a8aa1de3";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>




<script src="/js/codecopy.js"></script>



<link disabled id="dark-mode-theme" rel="stylesheet" href="/css/dark.css"></link>
<script src="/js/dark.js"></script>


<script src="/js/site_runtime.js"></script>




</body>
</html>
